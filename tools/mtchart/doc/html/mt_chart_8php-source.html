<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>mtChart: U:/Reference/Workspace/mtChartGoogle/trunk/mtChart.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>U:/Reference/Workspace/mtChartGoogle/trunk/mtChart.php</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00014"></a>00014 <span class="comment">/*</span>
<a name="l00015"></a>00015 <span class="comment"> ORIGINAL HEADER</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment"> pChart - a PHP class to build charts!</span>
<a name="l00018"></a>00018 <span class="comment"> Copyright (C) 2008 Jean-Damien POGOLOTTI</span>
<a name="l00019"></a>00019 <span class="comment"> Version  1.27d last updated on 09/30/08</span>
<a name="l00020"></a>00020 <span class="comment"></span>
<a name="l00021"></a>00021 <span class="comment"> http://pchart.sourceforge.net</span>
<a name="l00022"></a>00022 <span class="comment"></span>
<a name="l00023"></a>00023 <span class="comment"> This program is free software: you can redistribute it and/or modify</span>
<a name="l00024"></a>00024 <span class="comment"> it under the terms of the GNU General Public License as published by</span>
<a name="l00025"></a>00025 <span class="comment"> the Free Software Foundation, either version 1,2,3 of the License, or</span>
<a name="l00026"></a>00026 <span class="comment"> (at your option) any later version.</span>
<a name="l00027"></a>00027 <span class="comment"></span>
<a name="l00028"></a>00028 <span class="comment"> This program is distributed in the hope that it will be useful,</span>
<a name="l00029"></a>00029 <span class="comment"> but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00030"></a>00030 <span class="comment"> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00031"></a>00031 <span class="comment"> GNU General Public License for more details.</span>
<a name="l00032"></a>00032 <span class="comment"></span>
<a name="l00033"></a>00033 <span class="comment"> You should have received a copy of the GNU General Public License</span>
<a name="l00034"></a>00034 <span class="comment"> along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00035"></a>00035 <span class="comment"> */</span>
<a name="l00036"></a>00036 
<a name="l00040"></a>00040 define(<span class="stringliteral">'SCALE_NORMAL'</span>,1);
<a name="l00041"></a>00041 define(<span class="stringliteral">'SCALE_ADDALL'</span>,2);
<a name="l00042"></a>00042 define(<span class="stringliteral">'SCALE_START0'</span>,3);
<a name="l00043"></a>00043 define(<span class="stringliteral">'SCALE_ADDALLSTART0'</span>,4);
<a name="l00044"></a>00044 define(<span class="stringliteral">'PIE_PERCENTAGE'</span>, 1);
<a name="l00045"></a>00045 define(<span class="stringliteral">'PIE_LABELS'</span>,2);
<a name="l00046"></a>00046 define(<span class="stringliteral">'PIE_NOLABEL'</span>,3);
<a name="l00047"></a>00047 define(<span class="stringliteral">'PIE_PERCENTAGE_LABEL'</span>, 4);
<a name="l00048"></a>00048 define(<span class="stringliteral">'TARGET_GRAPHAREA'</span>,1);
<a name="l00049"></a>00049 define(<span class="stringliteral">'TARGET_BACKGROUND'</span>,2);
<a name="l00050"></a>00050 define(<span class="stringliteral">'ALIGN_TOP_LEFT'</span>,1);
<a name="l00051"></a>00051 define(<span class="stringliteral">'ALIGN_TOP_CENTER'</span>,2);
<a name="l00052"></a>00052 define(<span class="stringliteral">'ALIGN_TOP_RIGHT'</span>,3);
<a name="l00053"></a>00053 define(<span class="stringliteral">'ALIGN_LEFT'</span>,4);
<a name="l00054"></a>00054 define(<span class="stringliteral">'ALIGN_CENTER'</span>,5);
<a name="l00055"></a>00055 define(<span class="stringliteral">'ALIGN_RIGHT'</span>,6);
<a name="l00056"></a>00056 define(<span class="stringliteral">'ALIGN_BOTTOM_LEFT'</span>,7);
<a name="l00057"></a>00057 define(<span class="stringliteral">'ALIGN_BOTTOM_CENTER'</span>,8);
<a name="l00058"></a>00058 define(<span class="stringliteral">'ALIGN_BOTTOM_RIGHT'</span>,9);
<a name="l00059"></a>00059 define(<span class="stringliteral">'GRADIENT_VERTICAL'</span>, 1);
<a name="l00060"></a>00060 define(<span class="stringliteral">'GRADIENT_HORIZONTAL'</span>, 2);
<a name="l00061"></a>00061 
<a name="l00065"></a><a class="code" href="classmt_chart.html">00065</a> <span class="keyword">class </span><a class="code" href="classmt_chart.html">mtChart</a> {
<a name="l00069"></a>00069     <span class="comment">// Standard palette definition (Greenish)</span>
<a name="l00070"></a><a class="code" href="classmt_chart.html#b9d730f172d6c649a9ed78d987219b03">00070</a>     <span class="keyword">protected</span> <a class="code" href="classmt_chart.html#b9d730f172d6c649a9ed78d987219b03">$Palette</a> = array(
<a name="l00071"></a>00071                         <span class="charliteral">'0'</span> =&gt; array(<span class="charliteral">'R'</span> =&gt; 188, <span class="charliteral">'G'</span> =&gt; 224, <span class="charliteral">'B'</span> =&gt; 46),
<a name="l00072"></a>00072                         <span class="charliteral">'1'</span> =&gt; array(<span class="charliteral">'R'</span> =&gt; 224, <span class="charliteral">'G'</span> =&gt; 100, <span class="charliteral">'B'</span> =&gt; 46),
<a name="l00073"></a>00073                         <span class="charliteral">'2'</span> =&gt; array(<span class="charliteral">'R'</span> =&gt; 224, <span class="charliteral">'G'</span> =&gt; 214, <span class="charliteral">'B'</span> =&gt; 46),
<a name="l00074"></a>00074                         <span class="charliteral">'3'</span> =&gt; array(<span class="charliteral">'R'</span> =&gt; 46,  <span class="charliteral">'G'</span> =&gt; 151, <span class="charliteral">'B'</span> =&gt; 224),
<a name="l00075"></a>00075                         <span class="charliteral">'4'</span> =&gt; array(<span class="charliteral">'R'</span> =&gt; 176, <span class="charliteral">'G'</span> =&gt; 46,  <span class="charliteral">'B'</span> =&gt; 224),
<a name="l00076"></a>00076                         <span class="charliteral">'5'</span> =&gt; array(<span class="charliteral">'R'</span> =&gt; 224, <span class="charliteral">'G'</span> =&gt; 46,  <span class="charliteral">'B'</span> =&gt; 117),
<a name="l00077"></a>00077                         <span class="charliteral">'6'</span> =&gt; array(<span class="charliteral">'R'</span> =&gt; 92,  <span class="charliteral">'G'</span> =&gt; 224, <span class="charliteral">'B'</span> =&gt; 46),
<a name="l00078"></a>00078                         <span class="charliteral">'7'</span> =&gt; array(<span class="charliteral">'R'</span> =&gt; 224, <span class="charliteral">'G'</span> =&gt; 176, <span class="charliteral">'B'</span> =&gt; 46)
<a name="l00079"></a>00079     );
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="comment">// Image information and static variables</span>
<a name="l00082"></a>00082     <span class="keyword">public</span>    $Picture        = NULL;     <span class="comment">// Image resource</span>
<a name="l00083"></a>00083     <span class="keyword">protected</span> $XSize          = NULL;     <span class="comment">// Total image size x in pixels</span>
<a name="l00084"></a>00084     <span class="keyword">protected</span> $YSize          = NULL;     <span class="comment">// Total image size y in pixels</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <span class="comment">// Error management configuration</span>
<a name="l00087"></a>00087     <span class="keyword">protected</span> $ErrorReporting = FALSE;    <span class="comment">// Error reporting flag</span>
<a name="l00088"></a>00088     <span class="keyword">protected</span> $ErrorInterface = <span class="stringliteral">'CLI'</span>;    <span class="comment">// Error output interface (Either 'CLI' or 'GD')</span>
<a name="l00089"></a>00089     <span class="keyword">protected</span> $Errors         = array();  <span class="comment">// Error array collection of warning and errors</span>
<a name="l00090"></a>00090     <span class="keyword">protected</span> $ErrorFontName  = <span class="stringliteral">'Fonts/DejaVuSansMono-Bold.ttf'</span>; <span class="comment">// Error font filename</span>
<a name="l00091"></a>00091     <span class="keyword">protected</span> $ErrorFontSize  = 6;        <span class="comment">// Error font size in pixels</span>
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <span class="comment">// Graphing area information</span>
<a name="l00094"></a>00094     <span class="keyword">protected</span> $GArea_X1        = 70;      <span class="comment">// Graphing area left X in pixels</span>
<a name="l00095"></a>00095     <span class="keyword">protected</span> $GArea_Y1        = 30;      <span class="comment">// Graphing area top Y in pixels</span>
<a name="l00096"></a>00096     <span class="keyword">protected</span> $GArea_X2        = 680;     <span class="comment">// Graphing area right X in pixels</span>
<a name="l00097"></a>00097     <span class="keyword">protected</span> $GArea_Y2        = 200;     <span class="comment">// Graphing area lower Y in pixels</span>
<a name="l00098"></a>00098     <span class="keyword">protected</span> $GAreaXOffset    = NULL;    <span class="comment">// X-offset for graphs when margin is enabled</span>
<a name="l00099"></a>00099     <span class="keyword">protected</span> $VMax            = NULL;    <span class="comment">// Maximum value of the y-scale</span>
<a name="l00100"></a>00100     <span class="keyword">protected</span> $VMin            = NULL;    <span class="comment">// Minimum value of the y-scale</span>
<a name="l00101"></a>00101     <span class="keyword">protected</span> $VXMax           = NULL;    <span class="comment">// Maximum value of the x-scale</span>
<a name="l00102"></a>00102     <span class="keyword">protected</span> $VXMin           = NULL;    <span class="comment">// Minimum value of the x-scale</span>
<a name="l00103"></a>00103     <span class="keyword">protected</span> $Divisions       = NULL;    <span class="comment">// Manually set number of divisions of the y-scale</span>
<a name="l00104"></a>00104     <span class="keyword">protected</span> $XDivisions      = NULL;    <span class="comment">// Manually set number of divisions of the x-scale</span>
<a name="l00105"></a>00105     <span class="keyword">protected</span> $DivisionHeight  = NULL;    <span class="comment">// Pixel height of a division on the y-scale</span>
<a name="l00106"></a>00106     <span class="keyword">protected</span> $XDivisionHeight = NULL;    <span class="comment">// Pixel width of a division on the x-scale</span>
<a name="l00107"></a>00107     <span class="keyword">protected</span> $DivisionCount   = NULL;    <span class="comment">// Effective number of divisions on the y-axis</span>
<a name="l00108"></a>00108     <span class="keyword">protected</span> $XDivisionCount  = NULL;    <span class="comment">// Effective number of divisions on the x-axis</span>
<a name="l00109"></a>00109     <span class="keyword">protected</span> $DivisionRatio   = NULL;    <span class="comment">// Value-to-pixel ratio on the y-scale</span>
<a name="l00110"></a>00110     <span class="keyword">protected</span> $XDivisionRatio  = NULL;    <span class="comment">// Value-to-pixel ratio on the x-scale</span>
<a name="l00111"></a>00111     <span class="keyword">protected</span> $DivisionWidth   = NULL;    <span class="comment">// Pixel width of a division on the y-axis</span>
<a name="l00112"></a>00112     <span class="keyword">protected</span> $XInterval       = 1;       <span class="comment">// Interval for skipping labels and grid lines on the x-axis</span>
<a name="l00113"></a>00113     <span class="keyword">protected</span> $DataCount       = NULL;    <span class="comment">// Number of items in the data array</span>
<a name="l00114"></a>00114     <span class="keyword">protected</span> $Currency        = <span class="charliteral">'$'</span>;     <span class="comment">// Current currency symbol</span>
<a name="l00115"></a>00115     <span class="keyword">protected</span> $MinDivHeight    = 25;      <span class="comment">// Minimum pixel heigth of a division</span>
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="comment">// Text configuration</span>
<a name="l00118"></a>00118     <span class="keyword">protected</span> $FontName       = NULL;     <span class="comment">// Font filename</span>
<a name="l00119"></a>00119     <span class="keyword">protected</span> $DefaultFont    = <span class="stringliteral">'Fonts/DejaVuSansCondensed.ttf'</span>; <span class="comment">// Default font filename</span>
<a name="l00120"></a>00120     <span class="keyword">protected</span> $FontSize       = 8;        <span class="comment">// Font size in pixels</span>
<a name="l00121"></a>00121     <span class="keyword">protected</span> $DateFormat     = <span class="stringliteral">'m/d/Y'</span>;  <span class="comment">// Current date format string</span>
<a name="l00122"></a>00122     <span class="keyword">protected</span> $UseStrftime    = FALSE;    <span class="comment">// Flag to switch between the date function and strftime for dates</span>
<a name="l00123"></a>00123     <span class="keyword">protected</span> $TimeFormat     = <span class="stringliteral">'H:i:s'</span>;  <span class="comment">// Current time format string</span>
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <span class="comment">// Line configuration</span>
<a name="l00126"></a>00126     <span class="keyword">protected</span> $LineWidth      = 1;        <span class="comment">// Line width in pixels</span>
<a name="l00127"></a>00127     <span class="keyword">protected</span> $LineDotSize    = 0;        <span class="comment">// Dot length in pixels for dotted lines</span>
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     <span class="comment">// Layer configuration</span>
<a name="l00130"></a>00130     <span class="keyword">protected</span> $Layers         = array();  <span class="comment">// Image layers for composite images array</span>
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="comment">// Antialiasing configuration</span>
<a name="l00133"></a>00133     <span class="keyword">protected</span> $AntialiasQuality = 0;         <span class="comment">// Quality of the anti aliasing, 0 is maxmimum, 100 is minimum</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     <span class="comment">// Shadows configuration</span>
<a name="l00136"></a>00136     <span class="keyword">protected</span> $ShadowActive    = FALSE;   <span class="comment">// Flag to activate shadows</span>
<a name="l00137"></a>00137     <span class="keyword">protected</span> $ShadowXDistance = 1;       <span class="comment">// x-offset of the shadow in pixels</span>
<a name="l00138"></a>00138     <span class="keyword">protected</span> $ShadowYDistance = 1;       <span class="comment">// y-offset of the shadow in pixels</span>
<a name="l00139"></a>00139     <span class="keyword">protected</span> $ShadowRColor    = 60;      <span class="comment">// Shadow color R component</span>
<a name="l00140"></a>00140     <span class="keyword">protected</span> $ShadowGColor    = 60;      <span class="comment">// Shadow color G component</span>
<a name="l00141"></a>00141     <span class="keyword">protected</span> $ShadowBColor    = 60;      <span class="comment">// Shadow color B component</span>
<a name="l00142"></a>00142     <span class="keyword">protected</span> $ShadowAlpha     = 50;      <span class="comment">// Shadow alpha component</span>
<a name="l00143"></a>00143     <span class="keyword">protected</span> $ShadowBlur      = 0;       <span class="comment">// Shadow blur radius in pixels (Warning: Performance hog)</span>
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <span class="comment">// Image map settings</span>
<a name="l00146"></a>00146     <span class="keyword">protected</span> $BuildMap         = FALSE;  <span class="comment">// Flag to enable image map building</span>
<a name="l00147"></a>00147     <span class="keyword">protected</span> $ImageMap         = array(); <span class="comment">// Image map points array</span>
<a name="l00148"></a>00148     <span class="keyword">protected</span> $MapFunction      = NULL;   <span class="comment">// Used internally to identify the currently built image map</span>
<a name="l00149"></a>00149     <span class="keyword">protected</span> $tmpFolder        = <span class="stringliteral">'Cache/'</span>; <span class="comment">// Directory to save image maps to</span>
<a name="l00150"></a>00150     <span class="keyword">protected</span> $MapID            = NULL;   <span class="comment">// Current image map name</span>
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     <span class="comment">// Data arrays</span>
<a name="l00153"></a>00153     <span class="keyword">protected</span> $Data = array();            <span class="comment">// Main data array</span>
<a name="l00154"></a>00154     <span class="keyword">protected</span> $DataDescription = array(); <span class="comment">// Main data description array</span>
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     <span class="comment">// Caching settings</span>
<a name="l00157"></a>00157     <span class="keyword">protected</span> $CacheFolder = <span class="stringliteral">'Cache/'</span>;    <span class="comment">// Current cache directory</span>
<a name="l00158"></a>00158     <span class="keyword">protected</span> $ScriptID = NULL;           <span class="comment">// Current script ID</span>
<a name="l00159"></a>00159     <span class="keyword">protected</span> $CacheEnabled = FALSE;      <span class="comment">// Flag to enable caching</span>
<a name="l00160"></a>00160     <span class="keyword">protected</span> $Hash = NULL;               <span class="comment">// Current hash</span>
<a name="l00161"></a>00161 
<a name="l00172"></a><a class="code" href="classmt_chart.html#b07f1cff4f6bd29b8720701c20cfe9c2">00172</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#b07f1cff4f6bd29b8720701c20cfe9c2">__construct</a>($XSize = 700, $YSize = 230) {
<a name="l00173"></a>00173         $this-&gt;XSize   = $XSize;
<a name="l00174"></a>00174         $this-&gt;YSize   = $YSize;
<a name="l00175"></a>00175         $this-&gt;Picture = imagecreatetruecolor($XSize, $YSize);
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         $C_White = $this-&gt;AllocateColor($this-&gt;Picture, 255, 255, 255);
<a name="l00178"></a>00178         imagefilledrectangle($this-&gt;Picture, 0, 0, $XSize, $YSize, $C_White);
<a name="l00179"></a>00179         imagecolortransparent($this-&gt;Picture, $C_White);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181         $this-&gt;<a class="code" href="classmt_chart.html#d479a5cfabb90b1177e0ba0663cc879e">setFontProperties</a>($this-&gt;DefaultFont, $this-&gt;FontSize);
<a name="l00182"></a>00182         $this-&gt;<a class="code" href="classmt_chart.html#4b6a59c989d54d4676acc6e63380bf08">setGraphArea</a>(70, 30, $XSize - 20, $YSize - 30);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184         <span class="comment">// Set up default data descriptions</span>
<a name="l00185"></a>00185         $this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]    = <span class="stringliteral">'Name'</span>;
<a name="l00186"></a>00186         $this-&gt;DataDescription[<span class="stringliteral">'Format'</span>][<span class="charliteral">'X'</span>] = <span class="stringliteral">'number'</span>;
<a name="l00187"></a>00187         $this-&gt;DataDescription[<span class="stringliteral">'Format'</span>][<span class="charliteral">'Y'</span>] = <span class="stringliteral">'number'</span>;
<a name="l00188"></a>00188         $this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'X'</span>]   = NULL;
<a name="l00189"></a>00189         $this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'Y'</span>]   = NULL;
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 
<a name="l00205"></a><a class="code" href="classmt_chart.html#c30952b0900164b039a989da2928239d">00205</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#c30952b0900164b039a989da2928239d">reportWarnings</a>($Interface = <span class="stringliteral">'CLI'</span>) {
<a name="l00206"></a>00206         $this-&gt;ErrorReporting = TRUE;
<a name="l00207"></a>00207         $this-&gt;ErrorInterface = $Interface;
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209 
<a name="l00231"></a><a class="code" href="classmt_chart.html#d479a5cfabb90b1177e0ba0663cc879e">00231</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#d479a5cfabb90b1177e0ba0663cc879e">setFontProperties</a>($FontName, $FontSize = NULL) {
<a name="l00232"></a>00232         $currentDir = realpath(dirname(__FILE__)) . <span class="charliteral">'/'</span>;
<a name="l00233"></a>00233         $FontFound = FALSE;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235         <span class="keywordflow">if</span>(strtolower(substr($FontName, -4)) == <span class="stringliteral">'.ttf'</span>) {
<a name="l00236"></a>00236             <span class="comment">// A file name has been given</span>
<a name="l00237"></a>00237             <span class="keywordflow">if</span>(file_exists($FontName)) {
<a name="l00238"></a>00238                 <span class="comment">// Absolute file name has been given</span>
<a name="l00239"></a>00239                 $this-&gt;FontName = realpath($FontName);
<a name="l00240"></a>00240                 $FontFound = TRUE;
<a name="l00241"></a>00241             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(file_exists($currentDir . $FontName)) {
<a name="l00242"></a>00242                 <span class="comment">// Relative file name has been given</span>
<a name="l00243"></a>00243                 $this-&gt;FontName = realpath($currentDir . $FontName);
<a name="l00244"></a>00244                 $FontFound = TRUE;
<a name="l00245"></a>00245             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(file_exists($currentDir . <span class="stringliteral">'Fonts/'</span> . $FontName)) {
<a name="l00246"></a>00246                 <span class="comment">// File name for Fonts directory has been given</span>
<a name="l00247"></a>00247                 $this-&gt;FontName = realpath($currentDir . <span class="stringliteral">'Fonts/'</span> . $FontName);
<a name="l00248"></a>00248                 $FontFound = TRUE;
<a name="l00249"></a>00249             }  <span class="keywordflow">else</span> {
<a name="l00250"></a>00250                 <span class="comment">// Font file not found</span>
<a name="l00251"></a>00251                 $this-&gt;Errors[] = <span class="stringliteral">'[Warning] setFontProperties - Font file '</span> . $FontName . <span class="stringliteral">' not found.'</span>;
<a name="l00252"></a>00252                 $this-&gt;FontName = realpath($currentDir . $this-&gt;DefaultFont);
<a name="l00253"></a>00253             }
<a name="l00254"></a>00254         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(file_exists($currentDir . <span class="stringliteral">'Fonts/'</span> . $FontName . <span class="stringliteral">'.ttf'</span>)) {
<a name="l00255"></a>00255             <span class="comment">// Only font name has been given</span>
<a name="l00256"></a>00256             $this-&gt;FontName = realpath($currentDir . <span class="stringliteral">'Fonts/'</span> . $FontName . <span class="stringliteral">'.ttf'</span>);
<a name="l00257"></a>00257             $FontFound = TRUE;
<a name="l00258"></a>00258         } <span class="keywordflow">else</span> {
<a name="l00259"></a>00259             <span class="comment">// Font not found</span>
<a name="l00260"></a>00260             $this-&gt;Errors[] = <span class="stringliteral">'[Warning] setFontProperties - Font '</span> . $FontName . <span class="stringliteral">' not found.'</span>;
<a name="l00261"></a>00261             $this-&gt;FontName = realpath($currentDir . $this-&gt;DefaultFont);
<a name="l00262"></a>00262         }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264         <span class="keywordflow">if</span>(isset($FontSize)) {
<a name="l00265"></a>00265             $this-&gt;FontSize = $FontSize;
<a name="l00266"></a>00266         }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268         <span class="keywordflow">return</span> $FontFound;
<a name="l00269"></a>00269     }
<a name="l00270"></a>00270 
<a name="l00292"></a><a class="code" href="classmt_chart.html#542628f7bb31b219d4b5a2f89df90f8b">00292</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#542628f7bb31b219d4b5a2f89df90f8b">setShadowProperties</a>($XDistance = 1, $YDistance = 1, $R = 60, $G = 60, $B = 60, $Alpha = 50, $Blur = 0) {
<a name="l00293"></a>00293         $this-&gt;ShadowActive    = TRUE;
<a name="l00294"></a>00294         $this-&gt;ShadowXDistance = $XDistance;
<a name="l00295"></a>00295         $this-&gt;ShadowYDistance = $YDistance;
<a name="l00296"></a>00296         $this-&gt;ShadowRColor    = $R;
<a name="l00297"></a>00297         $this-&gt;ShadowGColor    = $G;
<a name="l00298"></a>00298         $this-&gt;ShadowBColor    = $B;
<a name="l00299"></a>00299         $this-&gt;ShadowAlpha     = $Alpha;
<a name="l00300"></a>00300         $this-&gt;ShadowBlur      = $Blur;
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302 
<a name="l00307"></a><a class="code" href="classmt_chart.html#c25cd8a8d5c43e25991bdc8a369c512a">00307</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#c25cd8a8d5c43e25991bdc8a369c512a">clearShadow</a>() {
<a name="l00308"></a>00308         $this-&gt;ShadowActive = FALSE;
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 
<a name="l00322"></a><a class="code" href="classmt_chart.html#012a084924d4bd438048296485e10e5c">00322</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#012a084924d4bd438048296485e10e5c">setColorPalette</a>($ID, $R, $G, $B) {
<a name="l00323"></a>00323         <span class="keywordflow">if</span>($R &lt; 0) { $R = 0; } <span class="keywordflow">if</span>($R &gt; 255) { $R = 255; }
<a name="l00324"></a>00324         <span class="keywordflow">if</span>($G &lt; 0) { $G = 0; } <span class="keywordflow">if</span>($G &gt; 255) { $G = 255; }
<a name="l00325"></a>00325         <span class="keywordflow">if</span>($B &lt; 0) { $B = 0; } <span class="keywordflow">if</span>($B &gt; 255) { $B = 255; }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327         $this-&gt;Palette[$ID][<span class="charliteral">'R'</span>] = $R;
<a name="l00328"></a>00328         $this-&gt;Palette[$ID][<span class="charliteral">'G'</span>] = $G;
<a name="l00329"></a>00329         $this-&gt;Palette[$ID][<span class="charliteral">'B'</span>] = $B;
<a name="l00330"></a>00330     }
<a name="l00331"></a>00331 
<a name="l00349"></a><a class="code" href="classmt_chart.html#b1b6ea6bb0b52835517b9a8d0fb4b5e8">00349</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#b1b6ea6bb0b52835517b9a8d0fb4b5e8">createColorGradientPalette</a>($R1, $G1, $B1, $R2, $G2, $B2, $Shades = 8) {
<a name="l00350"></a>00350         <span class="keywordflow">if</span>($Shades &lt; 1) { $Shades = 1; }
<a name="l00351"></a>00351         <span class="keywordflow">if</span>($R1 &lt; 0) { $R1 = 0; } <span class="keywordflow">if</span>($R1 &gt; 255) { $R1 = 255; }
<a name="l00352"></a>00352         <span class="keywordflow">if</span>($G1 &lt; 0) { $G1 = 0; } <span class="keywordflow">if</span>($G1 &gt; 255) { $G1 = 255; }
<a name="l00353"></a>00353         <span class="keywordflow">if</span>($B1 &lt; 0) { $B1 = 0; } <span class="keywordflow">if</span>($B1 &gt; 255) { $B1 = 255; }
<a name="l00354"></a>00354         <span class="keywordflow">if</span>($R2 &lt; 0) { $R2 = 0; } <span class="keywordflow">if</span>($R2 &gt; 255) { $R2 = 255; }
<a name="l00355"></a>00355         <span class="keywordflow">if</span>($G2 &lt; 0) { $G2 = 0; } <span class="keywordflow">if</span>($G2 &gt; 255) { $G2 = 255; }
<a name="l00356"></a>00356         <span class="keywordflow">if</span>($B2 &lt; 0) { $B2 = 0; } <span class="keywordflow">if</span>($B2 &gt; 255) { $B2 = 255; }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358         $RFactor = ($R2 - $R1) / $Shades;
<a name="l00359"></a>00359         $GFactor = ($G2 - $G1) / $Shades;
<a name="l00360"></a>00360         $BFactor = ($B2 - $B1) / $Shades;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362         <span class="keywordflow">for</span>($i = 0; $i &lt; $Shades; ++$i) {
<a name="l00363"></a>00363             $this-&gt;Palette[$i][<span class="charliteral">'R'</span>] = (int) $R1 + ($RFactor * $i);
<a name="l00364"></a>00364             $this-&gt;Palette[$i][<span class="charliteral">'G'</span>] = (int) $G1 + ($GFactor * $i);
<a name="l00365"></a>00365             $this-&gt;Palette[$i][<span class="charliteral">'B'</span>] = (int) $B1 + ($BFactor * $i);
<a name="l00366"></a>00366         }
<a name="l00367"></a>00367     }
<a name="l00368"></a>00368 
<a name="l00386"></a><a class="code" href="classmt_chart.html#592cabf22867bc3b16828796e185cc5a">00386</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#592cabf22867bc3b16828796e185cc5a">loadColorPalette</a>($FileName, $Delimiter = <span class="charliteral">','</span>) {
<a name="l00387"></a>00387         $success = FALSE;
<a name="l00388"></a>00388         $handle  = @fopen($FileName, <span class="charliteral">'r'</span>);
<a name="l00389"></a>00389         $ColorID = 0;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         <span class="keywordflow">if</span>($handle) {
<a name="l00392"></a>00392             $success = TRUE;
<a name="l00393"></a>00393             <span class="keywordflow">while</span>($buffer = fgets($handle)) {
<a name="l00394"></a>00394                 $Values = split($Delimiter, trim($buffer));
<a name="l00395"></a>00395                 <span class="keywordflow">if</span>(count($Values) == 3) {
<a name="l00396"></a>00396                     $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>] = $Values[0];
<a name="l00397"></a>00397                     $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>] = $Values[1];
<a name="l00398"></a>00398                     $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>] = $Values[2];
<a name="l00399"></a>00399                     ++$ColorID;
<a name="l00400"></a>00400                 }
<a name="l00401"></a>00401             }
<a name="l00402"></a>00402         } <span class="keywordflow">else</span> {
<a name="l00403"></a>00403             <span class="comment">// File not readable</span>
<a name="l00404"></a>00404             $this-&gt;Errors[] = <span class="stringliteral">'[Warning] loadColorPalette - File '</span> . $FileName . <span class="stringliteral">' not found or not readable.'</span>;
<a name="l00405"></a>00405         }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407         <span class="keywordflow">return</span> $success;
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409 
<a name="l00425"></a><a class="code" href="classmt_chart.html#071db8e7b915876b9840df3fe47a2ce2">00425</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#071db8e7b915876b9840df3fe47a2ce2">setLineStyle</a>($Width = 1, $DotSize = 0) {
<a name="l00426"></a>00426         $this-&gt;LineWidth   = $Width;
<a name="l00427"></a>00427         $this-&gt;LineDotSize = $DotSize;
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429 
<a name="l00437"></a><a class="code" href="classmt_chart.html#3f4263115cfe20e23d3afda8af6fa73c">00437</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#3f4263115cfe20e23d3afda8af6fa73c">setCurrency</a>($Currency) {
<a name="l00438"></a>00438         $this-&gt;Currency = $Currency;
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440 
<a name="l00454"></a><a class="code" href="classmt_chart.html#4b6a59c989d54d4676acc6e63380bf08">00454</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#4b6a59c989d54d4676acc6e63380bf08">setGraphArea</a>($X1 = 70, $Y1 = 30, $X2 = 680, $Y2 = 200) {
<a name="l00455"></a>00455         $this-&gt;GArea_X1 = $X1;
<a name="l00456"></a>00456         $this-&gt;GArea_Y1 = $Y1;
<a name="l00457"></a>00457         $this-&gt;GArea_X2 = $X2;
<a name="l00458"></a>00458         $this-&gt;GArea_Y2 = $Y2;
<a name="l00459"></a>00459     }
<a name="l00460"></a>00460 
<a name="l00475"></a><a class="code" href="classmt_chart.html#031f1d40dc9a76228f2a686ab3271b5c">00475</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#031f1d40dc9a76228f2a686ab3271b5c">drawGraphArea</a>($R = 250, $G = 250, $B = 250, $Stripe = FALSE, $StripeDistance = 4) {
<a name="l00476"></a>00476         <span class="comment">// Draw background</span>
<a name="l00477"></a>00477         $this-&gt;<a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">drawFilledRectangle</a>($this-&gt;GArea_X1, $this-&gt;GArea_Y1, $this-&gt;GArea_X2, $this-&gt;GArea_Y2, $R, $G, $B, FALSE);
<a name="l00478"></a>00478         $this-&gt;<a class="code" href="classmt_chart.html#616537ed8f9f5b76ce8cd7c19c07eecc">drawRectangle</a>($this-&gt;GArea_X1, $this-&gt;GArea_Y1, $this-&gt;GArea_X2, $this-&gt;GArea_Y2, $R - 40, $G - 40, $B - 40);
<a name="l00479"></a>00479 
<a name="l00480"></a>00480         <span class="keywordflow">if</span>($Stripe) {
<a name="l00481"></a>00481             <span class="comment">// Draw stripes</span>
<a name="l00482"></a>00482             $LineColor = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B, -15);
<a name="l00483"></a>00483             $SkewWidth = $this-&gt;GArea_Y2 - $this-&gt;GArea_Y1 - 1;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485             <span class="keywordflow">for</span>($i = $this-&gt;GArea_X1 - $SkewWidth; $i &lt;= $this-&gt;GArea_X2; $i += $StripeDistance) {
<a name="l00486"></a>00486                 $X1 = $i;
<a name="l00487"></a>00487                 $Y1 = $this-&gt;GArea_Y2;
<a name="l00488"></a>00488                 $X2 = $i + $SkewWidth;
<a name="l00489"></a>00489                 $Y2 = $this-&gt;GArea_Y1;
<a name="l00490"></a>00490 
<a name="l00491"></a>00491                 <span class="keywordflow">if</span>($X1 &lt; $this-&gt;GArea_X1) {
<a name="l00492"></a>00492                     $X1 = $this-&gt;GArea_X1;
<a name="l00493"></a>00493                     $Y1 = $this-&gt;GArea_Y1 + $X2 - $this-&gt;GArea_X1 + 1;
<a name="l00494"></a>00494                 }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496                 <span class="keywordflow">if</span>($X2 &gt;= $this-&gt;GArea_X2) {
<a name="l00497"></a>00497                     $Y2 = $this-&gt;GArea_Y1 + $X2 - $this-&gt;GArea_X2 +1;
<a name="l00498"></a>00498                     $X2 = $this-&gt;GArea_X2 - 1;
<a name="l00499"></a>00499                 }
<a name="l00500"></a>00500 
<a name="l00501"></a>00501                 imageline($this-&gt;Picture, $X1, $Y1, $X2, $Y2 + 1, $LineColor);
<a name="l00502"></a>00502             }
<a name="l00503"></a>00503         }
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505 
<a name="l00512"></a><a class="code" href="classmt_chart.html#a8c6c6593412a9dc7d79625e6bade25f">00512</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#a8c6c6593412a9dc7d79625e6bade25f">clearScale</a>() {
<a name="l00513"></a>00513         $this-&gt;VMin       = NULL;
<a name="l00514"></a>00514         $this-&gt;VMax       = NULL;
<a name="l00515"></a>00515         $this-&gt;VXMin      = NULL;
<a name="l00516"></a>00516         $this-&gt;VXMax      = NULL;
<a name="l00517"></a>00517         $this-&gt;Divisions  = NULL;
<a name="l00518"></a>00518         $this-&gt;XDivisions = NULL;
<a name="l00519"></a>00519     }
<a name="l00520"></a>00520 
<a name="l00541"></a><a class="code" href="classmt_chart.html#413da8178fe573b464c36de697322c08">00541</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#413da8178fe573b464c36de697322c08">setFixedScale</a>($VMin, $VMax, $Divisions = 5, $VXMin = NULL, $VXMax = NULL, $XDivisions = 5) {
<a name="l00542"></a>00542         $this-&gt;VMin      = $VMin;
<a name="l00543"></a>00543         $this-&gt;VMax      = $VMax;
<a name="l00544"></a>00544         $this-&gt;Divisions = $Divisions;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546         <span class="keywordflow">if</span>(isset($VXMin)) {
<a name="l00547"></a>00547             $this-&gt;VXMin      = $VXMin;
<a name="l00548"></a>00548             $this-&gt;VXMax      = $VXMax;
<a name="l00549"></a>00549             $this-&gt;XDivisions = $XDivisions;
<a name="l00550"></a>00550         }
<a name="l00551"></a>00551     }
<a name="l00552"></a>00552 
<a name="l00569"></a><a class="code" href="classmt_chart.html#0c5396406a3f16e8d24d98f8dafc41ba">00569</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#0c5396406a3f16e8d24d98f8dafc41ba">drawRightScale</a>($ScaleMode = SCALE_NORMAL, $R = 150, $G = 150, $B = 150, $DrawTicks = TRUE, $Angle = 0, $Decimals = 1, $WithMargin = FALSE) {
<a name="l00570"></a>00570         $this-&gt;<a class="code" href="classmt_chart.html#7b9f7c08343094c6ede34b0982ac1eb7">drawScale</a>($ScaleMode, $R, $G, $B, $DrawTicks, $Angle, $Decimals, $WithMargin, TRUE);
<a name="l00571"></a>00571     }
<a name="l00572"></a>00572 
<a name="l00595"></a><a class="code" href="classmt_chart.html#7b9f7c08343094c6ede34b0982ac1eb7">00595</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#7b9f7c08343094c6ede34b0982ac1eb7">drawScale</a>($ScaleMode = SCALE_NORMAL, $R = 150, $G = 150, $B = 150, $DrawTicks = TRUE, $Angle = 0, $Decimals = 1, $WithMargin = FALSE, $RightScale = FALSE) {
<a name="l00596"></a>00596         $this-&gt;validateData(<span class="stringliteral">'drawScale'</span>);
<a name="l00597"></a>00597         $C_TextColor = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l00598"></a>00598 
<a name="l00599"></a>00599         <span class="comment">// Draw axis's</span>
<a name="l00600"></a>00600         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($this-&gt;GArea_X1, $this-&gt;GArea_Y1, $this-&gt;GArea_X1, $this-&gt;GArea_Y2, $R, $G, $B);
<a name="l00601"></a>00601         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($this-&gt;GArea_X1, $this-&gt;GArea_Y2, $this-&gt;GArea_X2, $this-&gt;GArea_Y2, $R, $G, $B);
<a name="l00602"></a>00602 
<a name="l00603"></a>00603         <span class="comment">// If scale is not set manually</span>
<a name="l00604"></a>00604         <span class="keywordflow">if</span>(is_null($this-&gt;VMin) &amp;&amp; is_null($this-&gt;VMax)) {
<a name="l00605"></a>00605             <span class="comment">// Set arbitrary limits</span>
<a name="l00606"></a>00606             <span class="keywordflow">if</span>(isset($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>][0])) {
<a name="l00607"></a>00607                 $this-&gt;VMin = $this-&gt;Data[0][$this-&gt;DataDescription[<span class="stringliteral">'Values'</span>][0]];
<a name="l00608"></a>00608                 $this-&gt;VMax = $this-&gt;Data[0][$this-&gt;DataDescription[<span class="stringliteral">'Values'</span>][0]];
<a name="l00609"></a>00609             } <span class="keywordflow">else</span> {
<a name="l00610"></a>00610                 $this-&gt;VMin = NULL;
<a name="l00611"></a>00611                 $this-&gt;VMax = NULL;
<a name="l00612"></a>00612             }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614             <span class="comment">// Compute min/max</span>
<a name="l00615"></a>00615             <span class="keywordflow">switch</span>($ScaleMode) {
<a name="l00616"></a>00616                 <span class="keywordflow">case</span> SCALE_START0:
<a name="l00617"></a>00617                     $this-&gt;VMin = 0;
<a name="l00618"></a>00618                     <span class="comment">// Break intentionally omitted.</span>
<a name="l00619"></a>00619                 <span class="keywordflow">default</span>:
<a name="l00620"></a>00620                     <span class="comment">// Break intentionally omitted.</span>
<a name="l00621"></a>00621                 <span class="keywordflow">case</span> SCALE_NORMAL:
<a name="l00622"></a>00622                     <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l00623"></a>00623                         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l00624"></a>00624                             <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l00625"></a>00625                                 $Value = $this-&gt;Data[$Key][$ColName];
<a name="l00626"></a>00626 
<a name="l00627"></a>00627                                 <span class="keywordflow">if</span>(is_numeric($Value)) {
<a name="l00628"></a>00628                                     <span class="keywordflow">if</span>(is_null($this-&gt;VMax) || $this-&gt;VMax &lt; $Value) {
<a name="l00629"></a>00629                                         $this-&gt;VMax = $Value;
<a name="l00630"></a>00630                                     }
<a name="l00631"></a>00631                                     <span class="keywordflow">if</span>(is_null($this-&gt;VMin) || $this-&gt;VMin &gt; $Value) {
<a name="l00632"></a>00632                                         $this-&gt;VMin = $Value;
<a name="l00633"></a>00633                                     }
<a name="l00634"></a>00634                                 }
<a name="l00635"></a>00635                             }
<a name="l00636"></a>00636                         }
<a name="l00637"></a>00637                     }
<a name="l00638"></a>00638                     <span class="keywordflow">break</span>;
<a name="l00639"></a>00639                 <span class="keywordflow">case</span> SCALE_ADDALLSTART0:
<a name="l00640"></a>00640                     $this-&gt;VMin = 0;
<a name="l00641"></a>00641                     <span class="comment">// Break intentionally omitted.</span>
<a name="l00642"></a>00642                 <span class="keywordflow">case</span> SCALE_ADDALL:
<a name="l00643"></a>00643                     <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l00644"></a>00644                         $Sum = 0;
<a name="l00645"></a>00645                         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l00646"></a>00646                             <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l00647"></a>00647                                 $Value = $this-&gt;Data[$Key][$ColName];
<a name="l00648"></a>00648                                 <span class="keywordflow">if</span>(is_numeric($Value)) {
<a name="l00649"></a>00649                                     $Sum  += $Value;
<a name="l00650"></a>00650                                 }
<a name="l00651"></a>00651                             }
<a name="l00652"></a>00652                         }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654                         <span class="keywordflow">if</span>(is_null($this-&gt;VMax) || $this-&gt;VMax &lt; $Sum) {
<a name="l00655"></a>00655                             $this-&gt;VMax = $Sum;
<a name="l00656"></a>00656                         }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658                         <span class="keywordflow">if</span>(is_null($this-&gt;VMin) || $this-&gt;VMin &gt; $Sum) {
<a name="l00659"></a>00659                             $this-&gt;VMin = $Sum;
<a name="l00660"></a>00660                         }
<a name="l00661"></a>00661                     }
<a name="l00662"></a>00662                     <span class="keywordflow">break</span>;
<a name="l00663"></a>00663             }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665             <span class="comment">// Special case: All values are the same</span>
<a name="l00666"></a>00666             <span class="keywordflow">if</span>($this-&gt;VMax == $this-&gt;VMin) {
<a name="l00667"></a>00667                 <span class="keywordflow">if</span>($this-&gt;VMax &gt;= 0) {
<a name="l00668"></a>00668                     ++$this-&gt;VMax;
<a name="l00669"></a>00669                     $this-&gt;VMin = $this-&gt;VMax - 1;
<a name="l00670"></a>00670                 } <span class="keywordflow">else</span> {
<a name="l00671"></a>00671                     --$this-&gt;VMin;
<a name="l00672"></a>00672                     $this-&gt;VMax = $this-&gt;VMin + 1;
<a name="l00673"></a>00673                 }
<a name="l00674"></a>00674             }
<a name="l00675"></a>00675 
<a name="l00676"></a>00676             <span class="comment">// Compute automatic scaling</span>
<a name="l00677"></a>00677             $DataRange = $this-&gt;VMax - $this-&gt;VMin;
<a name="l00678"></a>00678             $MaxDivs = ($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / $this-&gt;MinDivHeight;
<a name="l00679"></a>00679             $Divisions = floor($MaxDivs);
<a name="l00680"></a>00680 
<a name="l00681"></a>00681             $scale = $this-&gt;computeScale($this-&gt;VMin, $this-&gt;VMax, $Divisions);
<a name="l00682"></a>00682 
<a name="l00683"></a>00683             $this-&gt;VMax = $scale[<span class="stringliteral">'max'</span>];
<a name="l00684"></a>00684             $this-&gt;VMin = $scale[<span class="stringliteral">'min'</span>];
<a name="l00685"></a>00685         } <span class="keywordflow">else</span> {
<a name="l00686"></a>00686             <span class="comment">// Scale set manually</span>
<a name="l00687"></a>00687             $Divisions = $this-&gt;Divisions;
<a name="l00688"></a>00688         }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690         $this-&gt;DataRange = $this-&gt;VMax - $this-&gt;VMin;
<a name="l00691"></a>00691         <span class="keywordflow">if</span>($this-&gt;DataRange == 0) {
<a name="l00692"></a>00692             $this-&gt;DataRange = 0.1;
<a name="l00693"></a>00693         }
<a name="l00694"></a>00694 
<a name="l00695"></a>00695         $this-&gt;DivisionCount = $Divisions;
<a name="l00696"></a>00696         $this-&gt;DivisionHeight = ($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / $Divisions;
<a name="l00697"></a>00697         $this-&gt;DivisionRatio  = ($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / $this-&gt;DataRange;
<a name="l00698"></a>00698         $this-&gt;GAreaXOffset  = 0;
<a name="l00699"></a>00699         $this-&gt;DataCount = count($this-&gt;Data);
<a name="l00700"></a>00700 
<a name="l00701"></a>00701          
<a name="l00702"></a>00702         <span class="keywordflow">if</span>($this-&gt;DataCount &gt; 1) {
<a name="l00703"></a>00703             <span class="keywordflow">if</span>($WithMargin == FALSE) {
<a name="l00704"></a>00704                 $this-&gt;DivisionWidth = ($this-&gt;GArea_X2 - $this-&gt;GArea_X1) / ($this-&gt;DataCount - 1);
<a name="l00705"></a>00705             } <span class="keywordflow">else</span> {
<a name="l00706"></a>00706                 $this-&gt;DivisionWidth = ($this-&gt;GArea_X2 - $this-&gt;GArea_X1) / $this-&gt;DataCount;
<a name="l00707"></a>00707                 $this-&gt;GAreaXOffset  = $this-&gt;DivisionWidth / 2;
<a name="l00708"></a>00708             }
<a name="l00709"></a>00709         } <span class="keywordflow">else</span> {
<a name="l00710"></a>00710             $this-&gt;DivisionWidth = $this-&gt;GArea_X2 - $this-&gt;GArea_X1;
<a name="l00711"></a>00711             $this-&gt;GAreaXOffset  = $this-&gt;DivisionWidth / 2;
<a name="l00712"></a>00712         }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714         <span class="comment">// Draw ticks and labels if necessary</span>
<a name="l00715"></a>00715         <span class="keywordflow">if</span>($DrawTicks) {
<a name="l00716"></a>00716             $YPos = $this-&gt;GArea_Y2;
<a name="l00717"></a>00717             $XMin = NULL;
<a name="l00718"></a>00718             <span class="keywordflow">for</span>($i = 1;  $i &lt;= $Divisions + 1; ++$i) {
<a name="l00719"></a>00719                 <span class="keywordflow">if</span>($RightScale) {
<a name="l00720"></a>00720                     $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($this-&gt;GArea_X2, $YPos, $this-&gt;GArea_X2 + 5, $YPos, $R, $G, $B);
<a name="l00721"></a>00721                 } <span class="keywordflow">else</span> {
<a name="l00722"></a>00722                     $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($this-&gt;GArea_X1, $YPos, $this-&gt;GArea_X1 - 5, $YPos, $R, $G, $B);
<a name="l00723"></a>00723                 }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725                 $Value = $this-&gt;VMin + ($i - 1) * (($this-&gt;VMax - $this-&gt;VMin) / $Divisions);
<a name="l00726"></a>00726                 $Value = round($Value, $Decimals);
<a name="l00727"></a>00727                 $Value = $this-&gt;formatValue($Value, $this-&gt;DataDescription[<span class="stringliteral">'Format'</span>][<span class="charliteral">'Y'</span>], $this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'Y'</span>]);
<a name="l00728"></a>00728 
<a name="l00729"></a>00729                 $Position  = imageftbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Value));
<a name="l00730"></a>00730                 $TextWidth = $Position[2] - $Position[0];
<a name="l00731"></a>00731 
<a name="l00732"></a>00732                 <span class="keywordflow">if</span>($RightScale) {
<a name="l00733"></a>00733                     imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $this-&gt;GArea_X2 + 10, $YPos + ($this-&gt;FontSize / 2), $C_TextColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l00734"></a>00734                     <span class="keywordflow">if</span>($XMin &lt; $this-&gt;GArea_X2 + 15 + $TextWidth || $XMin == NULL) {
<a name="l00735"></a>00735                         $XMin = $this-&gt;GArea_X2 + 15 + $TextWidth;
<a name="l00736"></a>00736                     }
<a name="l00737"></a>00737                 } <span class="keywordflow">else</span> {
<a name="l00738"></a>00738                     imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $this-&gt;GArea_X1 - 10 - $TextWidth, $YPos + ($this-&gt;FontSize / 2), $C_TextColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l00739"></a>00739                     <span class="keywordflow">if</span>($XMin &gt; $this-&gt;GArea_X1 - 10 - $TextWidth || $XMin == NULL) {
<a name="l00740"></a>00740                         $XMin = $this-&gt;GArea_X1 - 10 - $TextWidth;
<a name="l00741"></a>00741                     }
<a name="l00742"></a>00742                 }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744                 $YPos = $YPos - $this-&gt;DivisionHeight;
<a name="l00745"></a>00745             }
<a name="l00746"></a>00746 
<a name="l00747"></a>00747             <span class="comment">// Write the y-axis caption if set</span>
<a name="l00748"></a>00748             <span class="keywordflow">if</span>(isset($this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'Y'</span>])) {
<a name="l00749"></a>00749                 $Position   = imageftbbox($this-&gt;FontSize, 90, $this-&gt;FontName, $this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'Y'</span>]);
<a name="l00750"></a>00750                 $TextHeight = abs($Position[1]) + abs($Position[3]);
<a name="l00751"></a>00751                 $TextTop    = (($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / 2) + $this-&gt;GArea_Y1 + ($TextHeight / 2);
<a name="l00752"></a>00752 
<a name="l00753"></a>00753                 <span class="keywordflow">if</span>($RightScale) {
<a name="l00754"></a>00754                     imagettftext($this-&gt;Picture, $this-&gt;FontSize, 90, $XMin + $this-&gt;FontSize, $TextTop, $C_TextColor, $this-&gt;FontName, utf8_decode($this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'Y'</span>]));
<a name="l00755"></a>00755                 } <span class="keywordflow">else</span> {
<a name="l00756"></a>00756                     imagettftext($this-&gt;Picture, $this-&gt;FontSize, 90, $XMin - $this-&gt;FontSize, $TextTop, $C_TextColor, $this-&gt;FontName, utf8_decode($this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'Y'</span>]));
<a name="l00757"></a>00757                 }
<a name="l00758"></a>00758             }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760             <span class="comment">// Horizontal axis</span>
<a name="l00761"></a>00761             $XPos = $this-&gt;GArea_X1 + $this-&gt;GAreaXOffset;
<a name="l00762"></a>00762             $ID = 0;
<a name="l00763"></a>00763             $YMax = NULL;
<a name="l00764"></a>00764             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l00765"></a>00765                 <span class="comment">// Only draw every $XInterval'st label</span>
<a name="l00766"></a>00766                 <span class="keywordflow">if</span>($ID == 0 || $ID % $this-&gt;XInterval == 0) {
<a name="l00767"></a>00767                     $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>(floor($XPos), $this-&gt;GArea_Y2, floor($XPos), $this-&gt;GArea_Y2 + 5, $R, $G, $B);
<a name="l00768"></a>00768                     $Value = $this-&gt;formatValue($this-&gt;Data[$Key][$this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]], $this-&gt;DataDescription[<span class="stringliteral">'Format'</span>][<span class="charliteral">'X'</span>], $this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'X'</span>]);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770                     $Position   = imageftbbox($this-&gt;FontSize, $Angle, $this-&gt;FontName, utf8_decode($Value));
<a name="l00771"></a>00771                     $TextWidth  = abs($Position[2]) + abs($Position[0]);
<a name="l00772"></a>00772                     $TextHeight = abs($Position[1]) + abs($Position[3]);
<a name="l00773"></a>00773 
<a name="l00774"></a>00774                     <span class="keywordflow">if</span>($Angle == 0) {
<a name="l00775"></a>00775                         $YPos = $this-&gt;GArea_Y2 + 18;
<a name="l00776"></a>00776                         imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, floor($XPos) - floor($TextWidth / 2), $YPos, $C_TextColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l00777"></a>00777                     } <span class="keywordflow">else</span> {
<a name="l00778"></a>00778                         $YPos = $this-&gt;GArea_Y2 + 10 + $TextHeight;
<a name="l00779"></a>00779                         <span class="keywordflow">if</span>($Angle &lt;= 90) {
<a name="l00780"></a>00780                             imagettftext($this-&gt;Picture, $this-&gt;FontSize, $Angle, floor($XPos) - $TextWidth + 5, $YPos, $C_TextColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l00781"></a>00781                         } <span class="keywordflow">else</span> {
<a name="l00782"></a>00782                             imagettftext($this-&gt;Picture, $this-&gt;FontSize, $Angle, floor($XPos) + $TextWidth + 5, $YPos, $C_TextColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l00783"></a>00783                         }
<a name="l00784"></a>00784                     }
<a name="l00785"></a>00785 
<a name="l00786"></a>00786                     <span class="keywordflow">if</span>($YMax &lt; $YPos || $YMax == NULL) {
<a name="l00787"></a>00787                         $YMax = $YPos;
<a name="l00788"></a>00788                     }
<a name="l00789"></a>00789                 }
<a name="l00790"></a>00790 
<a name="l00791"></a>00791                 $XPos += $this-&gt;DivisionWidth;
<a name="l00792"></a>00792                 ++$ID;
<a name="l00793"></a>00793             }
<a name="l00794"></a>00794 
<a name="l00795"></a>00795             <span class="comment">// Write the x-axis caption if set</span>
<a name="l00796"></a>00796             <span class="keywordflow">if</span>(isset($this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'X'</span>])) {
<a name="l00797"></a>00797                 $Position   = imageftbbox($this-&gt;FontSize, 90, $this-&gt;FontName, utf8_decode($this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'X'</span>]));
<a name="l00798"></a>00798                 $TextWidth  = abs($Position[2]) + abs($Position[0]);
<a name="l00799"></a>00799                 $TextLeft   = (($this-&gt;GArea_X2 - $this-&gt;GArea_X1) / 2) + $this-&gt;GArea_X1 + ($TextWidth / 2);
<a name="l00800"></a>00800                 imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $TextLeft, $YMax+$this-&gt;FontSize + 5, $C_TextColor, $this-&gt;FontName, utf8_decode($this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'X'</span>]));
<a name="l00801"></a>00801             }
<a name="l00802"></a>00802         }
<a name="l00803"></a>00803     }
<a name="l00804"></a>00804 
<a name="l00818"></a>00818     <span class="keyword">private</span> function computeScale($min, $max, $nint = 0, $p = NULL) {
<a name="l00819"></a>00819         <span class="comment">// Correct max/min if necessary        </span>
<a name="l00820"></a>00820         <span class="keywordflow">if</span>($max &lt; $min) {
<a name="l00821"></a>00821             list($max, $min) = array($min, $max);            
<a name="l00822"></a>00822         }
<a name="l00823"></a>00823         
<a name="l00824"></a>00824         <span class="comment">// Estimate a number of intervals if necessary</span>
<a name="l00825"></a>00825         <span class="keywordflow">if</span>(0 == $nint) {
<a name="l00826"></a>00826             <span class="keywordflow">if</span>($max - $min) {
<a name="l00827"></a>00827                 $nint = min(floor(10 * log10($max - $min)), 17);
<a name="l00828"></a>00828             } <span class="keywordflow">else</span> {
<a name="l00829"></a>00829                 $nint = 1;
<a name="l00830"></a>00830             }
<a name="l00831"></a>00831         }
<a name="l00832"></a>00832 
<a name="l00833"></a>00833         <span class="comment">// Prepare values</span>
<a name="l00834"></a>00834         $A = $min;
<a name="l00835"></a>00835         $B = $max;
<a name="l00836"></a>00836         $R = $B - $A;
<a name="l00837"></a>00837         
<a name="l00838"></a>00838         <span class="comment">// If all values equal, abort somehow</span>
<a name="l00839"></a>00839         <span class="keywordflow">if</span>(! $R) {
<a name="l00840"></a>00840             <span class="keywordflow">return</span> array(<span class="stringliteral">'min'</span> =&gt; $A, <span class="stringliteral">'max'</span> =&gt; $A + 1);
<a name="l00841"></a>00841         }
<a name="l00842"></a>00842 
<a name="l00843"></a>00843         <span class="comment">// Prepare nice numbers if necessary</span>
<a name="l00844"></a>00844         <span class="keywordflow">if</span>(is_null($p)) {
<a name="l00845"></a>00845             $p = range(1, 9);
<a name="l00846"></a>00846         } <span class="keywordflow">else</span> {
<a name="l00847"></a>00847             sort($p);
<a name="l00848"></a>00848             $p_temp = array();
<a name="l00849"></a>00849             <span class="keywordflow">foreach</span>($p as $thisP) {
<a name="l00850"></a>00850                 <span class="keywordflow">if</span>($thisP &gt;= 1 &amp;&amp; $thisP &lt; 10) {
<a name="l00851"></a>00851                     $p_temp[] = $thisP;
<a name="l00852"></a>00852                 }
<a name="l00853"></a>00853             }
<a name="l00854"></a>00854 
<a name="l00855"></a>00855             $p = $p_temp;
<a name="l00856"></a>00856         }
<a name="l00857"></a>00857 
<a name="l00858"></a>00858         $n = count($p);
<a name="l00859"></a>00859         $t_i = floor(log10($R / $nint));
<a name="l00860"></a>00860 
<a name="l00861"></a>00861         <span class="keywordflow">if</span>(($R / $nint) / pow(10, $t_i) &lt;= max($p)) {
<a name="l00862"></a>00862             $k = $t_i;
<a name="l00863"></a>00863         } <span class="keywordflow">else</span> {
<a name="l00864"></a>00864             $k = $t_i + 1;
<a name="l00865"></a>00865         }
<a name="l00866"></a>00866 
<a name="l00867"></a>00867         $i = 0;
<a name="l00868"></a>00868         <span class="keywordflow">foreach</span>($p as $index =&gt; $thisP) {
<a name="l00869"></a>00869             <span class="keywordflow">if</span>($thisP &gt;= ($R / $nint) / pow(10, $k)) {
<a name="l00870"></a>00870                 <span class="keywordflow">break</span>;
<a name="l00871"></a>00871             }
<a name="l00872"></a>00872             $i = $index;
<a name="l00873"></a>00873         }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875         $b = $B - 1; <span class="comment">// To enter the while loop at least once</span>
<a name="l00876"></a>00876 
<a name="l00877"></a>00877         <span class="keywordflow">while</span>($B &gt; $b) {
<a name="l00878"></a>00878             $s = $p[$i] * pow(10, $k);
<a name="l00879"></a>00879             $a = $s * floor((((($B + $A) / 2) - ($s * $nint / 2)) / $s));
<a name="l00880"></a>00880             $b = $a + ($s * $nint);
<a name="l00881"></a>00881 
<a name="l00882"></a>00882             <span class="keywordflow">if</span>($i &lt; ($n - 1)) {
<a name="l00883"></a>00883                 ++$i;
<a name="l00884"></a>00884             } <span class="keywordflow">else</span> {
<a name="l00885"></a>00885                 $i = 0;
<a name="l00886"></a>00886                 ++$k;
<a name="l00887"></a>00887             }
<a name="l00888"></a>00888         }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890         <span class="keywordflow">return</span> array(<span class="stringliteral">'min'</span> =&gt; $a, <span class="stringliteral">'max'</span> =&gt; $b);
<a name="l00891"></a>00891     }
<a name="l00892"></a>00892     
<a name="l00901"></a>00901     <span class="keyword">private</span> function formatValue($Value, $Format, $Unit) {
<a name="l00902"></a>00902         <span class="keywordflow">switch</span>($Format) {
<a name="l00903"></a>00903             <span class="keywordflow">default</span>: <span class="comment">// Unknown formatting function</span>
<a name="l00904"></a>00904                 $this-&gt;Errors[] = <span class="stringliteral">'[Warning] formatValue - Formatting '</span> . $Format . <span class="stringliteral">' unknown.'</span>;
<a name="l00905"></a>00905                 <span class="keywordflow">break</span>;
<a name="l00906"></a>00906             <span class="keywordflow">case</span> <span class="stringliteral">'number'</span>:
<a name="l00907"></a>00907                 $Value .= $Unit;
<a name="l00908"></a>00908                 <span class="keywordflow">break</span>;
<a name="l00909"></a>00909             <span class="keywordflow">case</span> <span class="stringliteral">'time'</span>:
<a name="l00910"></a>00910                 $Value = $this-&gt;ToTime($Value);
<a name="l00911"></a>00911                 <span class="keywordflow">break</span>;
<a name="l00912"></a>00912             <span class="keywordflow">case</span> <span class="stringliteral">'date'</span>:
<a name="l00913"></a>00913                 $Value = $this-&gt;ToDate($Value);
<a name="l00914"></a>00914                 <span class="keywordflow">break</span>;
<a name="l00915"></a>00915             <span class="keywordflow">case</span> <span class="stringliteral">'metric'</span>:
<a name="l00916"></a>00916                 $Value = $this-&gt;ToMetric($Value);
<a name="l00917"></a>00917                 <span class="keywordflow">break</span>;
<a name="l00918"></a>00918             <span class="keywordflow">case</span> <span class="stringliteral">'currency'</span>:
<a name="l00919"></a>00919                 $Value = $this-&gt;ToCurrency($Value);
<a name="l00920"></a>00920                 <span class="keywordflow">break</span>;
<a name="l00921"></a>00921         }
<a name="l00922"></a>00922         <span class="keywordflow">return</span> $Value;
<a name="l00923"></a>00923     }
<a name="l00924"></a>00924 
<a name="l00937"></a><a class="code" href="classmt_chart.html#7e069b104d9091298527c34973b026bd">00937</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#7e069b104d9091298527c34973b026bd">drawXYScale</a>($YSerieName, $XSerieName, $R, $G, $B, $WithMargin = 0, $Angle = 0, $Decimals = 1) {
<a name="l00938"></a>00938         $this-&gt;validateData(<span class="stringliteral">'drawScale'</span>);
<a name="l00939"></a>00939 
<a name="l00940"></a>00940         $C_TextColor =$this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l00941"></a>00941         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($this-&gt;GArea_X1, $this-&gt;GArea_Y1, $this-&gt;GArea_X1, $this-&gt;GArea_Y2, $R, $G, $B);
<a name="l00942"></a>00942         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($this-&gt;GArea_X1, $this-&gt;GArea_Y2, $this-&gt;GArea_X2, $this-&gt;GArea_Y2, $R, $G, $B);
<a name="l00943"></a>00943 
<a name="l00944"></a>00944         <span class="comment">// y-scale</span>
<a name="l00945"></a>00945         <span class="keywordflow">if</span>(is_null($this-&gt;VMin) &amp;&amp; is_null($this-&gt;VMax)) {
<a name="l00946"></a>00946             $this-&gt;VMin = $this-&gt;Data[0][$YSerieName];
<a name="l00947"></a>00947             $this-&gt;VMax = $this-&gt;Data[0][$YSerieName];
<a name="l00948"></a>00948 
<a name="l00949"></a>00949             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l00950"></a>00950                 <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$YSerieName])) {
<a name="l00951"></a>00951                     $Value = $this-&gt;Data[$Key][$YSerieName];
<a name="l00952"></a>00952                     <span class="keywordflow">if</span>($this-&gt;VMax &lt; $Value) { $this-&gt;VMax = $Value; }
<a name="l00953"></a>00953                     <span class="keywordflow">if</span>($this-&gt;VMin &gt; $Value) { $this-&gt;VMin = $Value; }
<a name="l00954"></a>00954                 }
<a name="l00955"></a>00955             }
<a name="l00956"></a>00956 
<a name="l00957"></a>00957             <span class="keywordflow">if</span>($this-&gt;VMax &gt; 0) {
<a name="l00958"></a>00958                 $this-&gt;VMax = ceil($this-&gt;VMax);
<a name="l00959"></a>00959             } <span class="keywordflow">else</span> {
<a name="l00960"></a>00960                 $this-&gt;VMax = floor($this-&gt;VMax);
<a name="l00961"></a>00961             }
<a name="l00962"></a>00962             <span class="keywordflow">if</span>($this-&gt;VMin &gt; 0) {
<a name="l00963"></a>00963                 $this-&gt;VMin = ceil($this-&gt;VMin);
<a name="l00964"></a>00964             } <span class="keywordflow">else</span> {
<a name="l00965"></a>00965                 $this-&gt;VMin = floor($this-&gt;VMin);
<a name="l00966"></a>00966             }
<a name="l00967"></a>00967 
<a name="l00968"></a>00968             $this-&gt;DataRange = $this-&gt;VMax - $this-&gt;VMin;
<a name="l00969"></a>00969             <span class="keywordflow">if</span>($this-&gt;DataRange == 0) {
<a name="l00970"></a>00970                 $this-&gt;DataRange = .1;
<a name="l00971"></a>00971             }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973             <span class="comment">// Compute automatic scaling</span>
<a name="l00974"></a>00974             $ScaleOk = FALSE;
<a name="l00975"></a>00975             $Factor = 1;
<a name="l00976"></a>00976             $MinDivHeight = 25;
<a name="l00977"></a>00977             $MaxDivs = ($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / $MinDivHeight;
<a name="l00978"></a>00978             $Divisions = 2;
<a name="l00979"></a>00979 
<a name="l00980"></a>00980             <span class="keywordflow">if</span>($this-&gt;VMin == 0 &amp;&amp; $this-&gt;VMax == 0) {
<a name="l00981"></a>00981                 $this-&gt;VMin = 0;
<a name="l00982"></a>00982                 $this-&gt;VMax = 2;
<a name="l00983"></a>00983                 $Scale = 1;
<a name="l00984"></a>00984                 $Divisions = 2;
<a name="l00985"></a>00985             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>($MaxDivs &gt; 1) {
<a name="l00986"></a>00986                 <span class="keywordflow">while</span>(!$ScaleOk) {
<a name="l00987"></a>00987                     $Scale1 = ($this-&gt;VMax - $this-&gt;VMin) / $Factor;
<a name="l00988"></a>00988                     $Scale2 = ($this-&gt;VMax - $this-&gt;VMin) / $Factor / 2;
<a name="l00989"></a>00989 
<a name="l00990"></a>00990                     <span class="keywordflow">if</span>($Scale1 &gt; 1 &amp;&amp; $Scale1 &lt;= $MaxDivs &amp;&amp; !$ScaleOk) {
<a name="l00991"></a>00991                         $ScaleOk = TRUE;
<a name="l00992"></a>00992                         $Divisions = floor($Scale1); $Scale = 1;
<a name="l00993"></a>00993                     }
<a name="l00994"></a>00994 
<a name="l00995"></a>00995                     <span class="keywordflow">if</span>($Scale2 &gt; 1 &amp;&amp; $Scale2 &lt;= $MaxDivs &amp;&amp; !$ScaleOk) {
<a name="l00996"></a>00996                         $ScaleOk = TRUE;
<a name="l00997"></a>00997                         $Divisions = floor($Scale2);
<a name="l00998"></a>00998                         $Scale = 2;
<a name="l00999"></a>00999                     }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001                     <span class="keywordflow">if</span>(!$ScaleOk) {
<a name="l01002"></a>01002                         <span class="keywordflow">if</span>($Scale2 &gt; 1) {
<a name="l01003"></a>01003                             $Factor *= 2 * $MaxDivs;
<a name="l01004"></a>01004                         }
<a name="l01005"></a>01005                         <span class="keywordflow">if</span>($Scale2 &lt; 1) {
<a name="l01006"></a>01006                             $Factor /= 2 * $MaxDivs;
<a name="l01007"></a>01007                         }
<a name="l01008"></a>01008                     }
<a name="l01009"></a>01009                 }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011                 $VMaxFactor = $this-&gt;VMax / $Scale / $Factor;
<a name="l01012"></a>01012                 $VMinFactor = $this-&gt;VMin / $Scale / $Factor;
<a name="l01013"></a>01013 
<a name="l01014"></a>01014                 <span class="keywordflow">if</span>(! $this-&gt;isRealInt($VMaxFactor)) {
<a name="l01015"></a>01015                     $this-&gt;VMax = ceil($VMaxFactor) * $Scale * $Factor;
<a name="l01016"></a>01016                     ++$Divisions;
<a name="l01017"></a>01017                 }
<a name="l01018"></a>01018 
<a name="l01019"></a>01019                 <span class="keywordflow">if</span>(! $this-&gt;isRealInt($VMinFactor)) {
<a name="l01020"></a>01020                     $this-&gt;VMin = floor($VMinFactor) * $Scale * $Factor;
<a name="l01021"></a>01021                     ++$Divisions;
<a name="l01022"></a>01022                 }
<a name="l01023"></a>01023             } <span class="keywordflow">else</span> {
<a name="l01024"></a>01024                 <span class="comment">// Small graph</span>
<a name="l01025"></a>01025                 $Scale = 1;
<a name="l01026"></a>01026             }
<a name="l01027"></a>01027 
<a name="l01028"></a>01028             <span class="keywordflow">if</span>($this-&gt;isRealInt(($this-&gt;VMax-$this-&gt;VMin)/($Divisions - 1))) {
<a name="l01029"></a>01029                 --$Divisions;
<a name="l01030"></a>01030             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;isRealInt(($this-&gt;VMax-$this-&gt;VMin)/($Divisions+1))) {
<a name="l01031"></a>01031                 ++$Divisions;
<a name="l01032"></a>01032             }
<a name="l01033"></a>01033         } <span class="keywordflow">else</span> {
<a name="l01034"></a>01034             $Divisions = $this-&gt;Divisions;
<a name="l01035"></a>01035         }
<a name="l01036"></a>01036 
<a name="l01037"></a>01037         $this-&gt;DivisionCount = $Divisions;
<a name="l01038"></a>01038 
<a name="l01039"></a>01039         $this-&gt;DataRange = $this-&gt;VMax - $this-&gt;VMin;
<a name="l01040"></a>01040         <span class="keywordflow">if</span>($this-&gt;DataRange == 0) {
<a name="l01041"></a>01041             $this-&gt;DataRange = .1;
<a name="l01042"></a>01042         }
<a name="l01043"></a>01043 
<a name="l01044"></a>01044         $this-&gt;DivisionHeight = ($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / $Divisions;
<a name="l01045"></a>01045         $this-&gt;DivisionRatio  = ($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / $this-&gt;DataRange;
<a name="l01046"></a>01046         $YPos = $this-&gt;GArea_Y2;
<a name="l01047"></a>01047         $XMin = NULL;
<a name="l01048"></a>01048 
<a name="l01049"></a>01049         <span class="keywordflow">for</span>($i = 1; $i &lt;= $Divisions+1; ++$i) {
<a name="l01050"></a>01050             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($this-&gt;GArea_X1, $YPos, $this-&gt;GArea_X1 - 5, $YPos, $R, $G, $B);
<a name="l01051"></a>01051             $Value     = $this-&gt;VMin + ($i - 1) * (($this-&gt;VMax - $this-&gt;VMin) / $Divisions);
<a name="l01052"></a>01052             $Value     = round($Value, $Decimals);
<a name="l01053"></a>01053             $Value     = $this-&gt;formatValue($Value, $this-&gt;DataDescription[<span class="stringliteral">'Format'</span>][<span class="charliteral">'Y'</span>], $Value.$this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'Y'</span>]);
<a name="l01054"></a>01054 
<a name="l01055"></a>01055             $Position  = imageftbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Value));
<a name="l01056"></a>01056             $TextWidth = $Position[2] - $Position[0];
<a name="l01057"></a>01057             imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $this-&gt;GArea_X1 - 10 - $TextWidth, $YPos + ($this-&gt;FontSize / 2), $C_TextColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l01058"></a>01058 
<a name="l01059"></a>01059             <span class="keywordflow">if</span>($XMin &gt; $this-&gt;GArea_X1 - 10 - $TextWidth || $XMin == NULL) {
<a name="l01060"></a>01060                 $XMin = $this-&gt;GArea_X1 - 10 - $TextWidth;
<a name="l01061"></a>01061             }
<a name="l01062"></a>01062 
<a name="l01063"></a>01063             $YPos = $YPos - $this-&gt;DivisionHeight;
<a name="l01064"></a>01064         }
<a name="l01065"></a>01065 
<a name="l01066"></a>01066         <span class="comment">// Process x-scale</span>
<a name="l01067"></a>01067         <span class="keywordflow">if</span>($this-&gt;VXMin == NULL &amp;&amp; $this-&gt;VXMax == NULL) {
<a name="l01068"></a>01068             $this-&gt;VXMin = $this-&gt;Data[0][$XSerieName];
<a name="l01069"></a>01069             $this-&gt;VXMax = $this-&gt;Data[0][$XSerieName];
<a name="l01070"></a>01070 
<a name="l01071"></a>01071             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l01072"></a>01072                 <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$XSerieName])) {
<a name="l01073"></a>01073                     $Value = $this-&gt;Data[$Key][$XSerieName];
<a name="l01074"></a>01074                     <span class="keywordflow">if</span>($this-&gt;VXMax &lt; $Value) {
<a name="l01075"></a>01075                         $this-&gt;VXMax = $Value;
<a name="l01076"></a>01076                     }
<a name="l01077"></a>01077                     <span class="keywordflow">if</span>($this-&gt;VXMin &gt; $Value) {
<a name="l01078"></a>01078                         $this-&gt;VXMin = $Value;
<a name="l01079"></a>01079                     }
<a name="l01080"></a>01080                 }
<a name="l01081"></a>01081             }
<a name="l01082"></a>01082 
<a name="l01083"></a>01083             <span class="keywordflow">if</span>(! $this-&gt;isRealInt($this-&gt;VXMax)) {
<a name="l01084"></a>01084                 <span class="keywordflow">if</span>($this-&gt;VXMax &gt; 0) {
<a name="l01085"></a>01085                     $this-&gt;VXMax = ceil($this-&gt;VXMax);
<a name="l01086"></a>01086                 } <span class="keywordflow">else</span> {
<a name="l01087"></a>01087                     $this-&gt;VXMax = floor($this-&gt;VXMax);
<a name="l01088"></a>01088                 }
<a name="l01089"></a>01089             }
<a name="l01090"></a>01090 
<a name="l01091"></a>01091             $this-&gt;DataRange = $this-&gt;VMax - $this-&gt;VMin;
<a name="l01092"></a>01092             <span class="keywordflow">if</span>($this-&gt;DataRange == 0) {
<a name="l01093"></a>01093                 $this-&gt;DataRange = .1;
<a name="l01094"></a>01094             }
<a name="l01095"></a>01095 
<a name="l01096"></a>01096             <span class="comment">// Compute automatic scaling</span>
<a name="l01097"></a>01097             $ScaleOk = FALSE;
<a name="l01098"></a>01098             $Factor = 1;
<a name="l01099"></a>01099             $MinDivWidth = 25;
<a name="l01100"></a>01100             $MaxDivs = ($this-&gt;GArea_X2 - $this-&gt;GArea_X1) / $MinDivWidth;
<a name="l01101"></a>01101             $XDivisions = 2;
<a name="l01102"></a>01102 
<a name="l01103"></a>01103             <span class="keywordflow">if</span>($this-&gt;VXMin == 0 &amp;&amp; $this-&gt;VXMax == 0) {
<a name="l01104"></a>01104                 $this-&gt;VXMin = 0;
<a name="l01105"></a>01105                 $this-&gt;VXMax = 2;
<a name="l01106"></a>01106                 $Scale = 1;
<a name="l01107"></a>01107                 $XDivisions = 2;
<a name="l01108"></a>01108             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>($MaxDivs &gt; 1) {
<a name="l01109"></a>01109                 <span class="keywordflow">while</span>(!$ScaleOk) {
<a name="l01110"></a>01110                     $Scale1 = ($this-&gt;VXMax - $this-&gt;VXMin) / $Factor;
<a name="l01111"></a>01111                     $Scale2 = ($this-&gt;VXMax - $this-&gt;VXMin) / $Factor / 2;
<a name="l01112"></a>01112 
<a name="l01113"></a>01113                     <span class="keywordflow">if</span>($Scale1 &gt; 1 &amp;&amp; $Scale1 &lt;= $MaxDivs &amp;&amp; !$ScaleOk) {
<a name="l01114"></a>01114                         $ScaleOk = TRUE;
<a name="l01115"></a>01115                         $XDivisions = floor($Scale1);
<a name="l01116"></a>01116                         $Scale = 1;
<a name="l01117"></a>01117                     }
<a name="l01118"></a>01118                     <span class="keywordflow">if</span>($Scale2 &gt; 1 &amp;&amp; $Scale2 &lt;= $MaxDivs &amp;&amp; !$ScaleOk) {
<a name="l01119"></a>01119                         $ScaleOk = TRUE;
<a name="l01120"></a>01120                         $XDivisions = floor($Scale2);
<a name="l01121"></a>01121                         $Scale = 2;
<a name="l01122"></a>01122                     }
<a name="l01123"></a>01123                     <span class="keywordflow">if</span>(!$ScaleOk)
<a name="l01124"></a>01124                     {
<a name="l01125"></a>01125                         <span class="keywordflow">if</span>($Scale2 &gt; 1) {
<a name="l01126"></a>01126                             $Factor *= 2 * $MaxDivs;
<a name="l01127"></a>01127                         }
<a name="l01128"></a>01128                         <span class="keywordflow">if</span>($Scale2 &lt; 1) {
<a name="l01129"></a>01129                             $Factor /= 2 * $MaxDivs;
<a name="l01130"></a>01130                         }
<a name="l01131"></a>01131                     }
<a name="l01132"></a>01132                 }
<a name="l01133"></a>01133 
<a name="l01134"></a>01134                 $VXMaxFactor = $this-&gt;VXMax / $Scale / $Factor;
<a name="l01135"></a>01135                 $VXMinFactor = $this-&gt;VXMin / $Scale / $Factor;
<a name="l01136"></a>01136 
<a name="l01137"></a>01137                 <span class="keywordflow">if</span>(! $this-&gt;isRealInt($VXMaxFactor)) {
<a name="l01138"></a>01138                     $this-&gt;VXMax = ceil($VXMaxFactor) * $Scale * $Factor;
<a name="l01139"></a>01139                     $XDivisions++;
<a name="l01140"></a>01140                 }
<a name="l01141"></a>01141 
<a name="l01142"></a>01142                 <span class="keywordflow">if</span>(! $this-&gt;isRealInt($VXMinFactor)) {
<a name="l01143"></a>01143                     $this-&gt;VXMin = floor($VXMinFactor) * $Scale * $Factor;
<a name="l01144"></a>01144                     $XDivisions++;
<a name="l01145"></a>01145                 }
<a name="l01146"></a>01146             } <span class="keywordflow">else</span> {
<a name="l01147"></a>01147                 <span class="comment">// Small graph</span>
<a name="l01148"></a>01148                 $Scale = 1;
<a name="l01149"></a>01149             }
<a name="l01150"></a>01150 
<a name="l01151"></a>01151             <span class="keywordflow">if</span>($this-&gt;isRealInt(($this-&gt;VXMax-$this-&gt;VXMin)/($XDivisions - 1))) {
<a name="l01152"></a>01152                 $XDivisions--;
<a name="l01153"></a>01153             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>($this-&gt;isRealInt(($this-&gt;VXMax-$this-&gt;VXMin)/($XDivisions+1))) {
<a name="l01154"></a>01154                 $XDivisions++;
<a name="l01155"></a>01155             }
<a name="l01156"></a>01156         } <span class="keywordflow">else</span> {
<a name="l01157"></a>01157             $XDivisions = $this-&gt;XDivisions;
<a name="l01158"></a>01158         }
<a name="l01159"></a>01159 
<a name="l01160"></a>01160         $this-&gt;XDivisionCount = $Divisions;
<a name="l01161"></a>01161         $this-&gt;DataCount      = $Divisions + 2;
<a name="l01162"></a>01162 
<a name="l01163"></a>01163         $XDataRange = $this-&gt;VXMax - $this-&gt;VXMin;
<a name="l01164"></a>01164         <span class="keywordflow">if</span>($XDataRange == 0) {
<a name="l01165"></a>01165             $XDataRange = .1;
<a name="l01166"></a>01166         }
<a name="l01167"></a>01167 
<a name="l01168"></a>01168         $this-&gt;DivisionWidth   = ($this-&gt;GArea_X2 - $this-&gt;GArea_X1) / $XDivisions;
<a name="l01169"></a>01169         $this-&gt;XDivisionRatio  = ($this-&gt;GArea_X2 - $this-&gt;GArea_X1) / $XDataRange;
<a name="l01170"></a>01170 
<a name="l01171"></a>01171         $XPos = $this-&gt;GArea_X1;
<a name="l01172"></a>01172         $YMax = NULL;
<a name="l01173"></a>01173 
<a name="l01174"></a>01174         <span class="keywordflow">for</span>($i = 1; $i &lt;= $XDivisions + 1; ++$i) {
<a name="l01175"></a>01175             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XPos, $this-&gt;GArea_Y2, $XPos, $this-&gt;GArea_Y2 + 5, $R, $G, $B);
<a name="l01176"></a>01176 
<a name="l01177"></a>01177             $Value     = $this-&gt;VXMin + ($i - 1) * (($this-&gt;VXMax - $this-&gt;VXMin) / $XDivisions);
<a name="l01178"></a>01178             $Value     = round($Value, $Decimals);
<a name="l01179"></a>01179             $Value     = $this-&gt;formatValue($Value, $this-&gt;DataDescription[<span class="stringliteral">'Format'</span>][<span class="charliteral">'Y'</span>], $this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'Y'</span>]);
<a name="l01180"></a>01180 
<a name="l01181"></a>01181             $Position   = imageftbbox($this-&gt;FontSize, $Angle, $this-&gt;FontName, utf8_decode($Value));
<a name="l01182"></a>01182             $TextWidth  = abs($Position[2]) + abs($Position[0]);
<a name="l01183"></a>01183             $TextHeight = abs($Position[1]) + abs($Position[3]);
<a name="l01184"></a>01184 
<a name="l01185"></a>01185             <span class="keywordflow">if</span>($Angle == 0) {
<a name="l01186"></a>01186                 $YPos = $this-&gt;GArea_Y2 + 18;
<a name="l01187"></a>01187                 imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, floor($XPos) - floor($TextWidth / 2), $YPos, $C_TextColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l01188"></a>01188             } <span class="keywordflow">else</span> {
<a name="l01189"></a>01189                 $YPos = $this-&gt;GArea_Y2 + 10 + $TextHeight;
<a name="l01190"></a>01190                 <span class="keywordflow">if</span>($Angle &lt;= 90) {
<a name="l01191"></a>01191                     imagettftext($this-&gt;Picture, $this-&gt;FontSize, $Angle, floor($XPos) - $TextWidth + 5, $YPos, $C_TextColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l01192"></a>01192                 } <span class="keywordflow">else</span> {
<a name="l01193"></a>01193                     imagettftext($this-&gt;Picture, $this-&gt;FontSize, $Angle, floor($XPos) + $TextWidth + 5, $YPos, $C_TextColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l01194"></a>01194                 }
<a name="l01195"></a>01195             }
<a name="l01196"></a>01196 
<a name="l01197"></a>01197             <span class="keywordflow">if</span>($YMax &lt; $YPos || $YMax == NULL) {
<a name="l01198"></a>01198                 $YMax = $YPos;
<a name="l01199"></a>01199             }
<a name="l01200"></a>01200 
<a name="l01201"></a>01201             $XPos += $this-&gt;DivisionWidth;
<a name="l01202"></a>01202         }
<a name="l01203"></a>01203 
<a name="l01204"></a>01204         <span class="comment">// Write the y-axis caption if set</span>
<a name="l01205"></a>01205         <span class="keywordflow">if</span>(isset($this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'Y'</span>])) {
<a name="l01206"></a>01206             $Position   = imageftbbox($this-&gt;FontSize, 90, $this-&gt;FontName, utf8_decode($this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'Y'</span>]));
<a name="l01207"></a>01207             $TextHeight = abs($Position[1]) + abs($Position[3]);
<a name="l01208"></a>01208             $TextTop    = (($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / 2) + $this-&gt;GArea_Y1 + ($TextHeight / 2);
<a name="l01209"></a>01209             imagettftext($this-&gt;Picture, $this-&gt;FontSize, 90, $XMin-$this-&gt;FontSize, $TextTop, $C_TextColor, $this-&gt;FontName, utf8_decode($this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'Y'</span>]));
<a name="l01210"></a>01210         }
<a name="l01211"></a>01211 
<a name="l01212"></a>01212         <span class="comment">// Write the x-axis caption if set</span>
<a name="l01213"></a>01213         <span class="keywordflow">if</span>(isset($this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'X'</span>])) {
<a name="l01214"></a>01214             $Position   = imageftbbox($this-&gt;FontSize, 90, $this-&gt;FontName, utf8_decode($this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'X'</span>]));
<a name="l01215"></a>01215             $TextWidth  = abs($Position[2]) + abs($Position[0]);
<a name="l01216"></a>01216             $TextLeft   = (($this-&gt;GArea_X2 - $this-&gt;GArea_X1) / 2) + $this-&gt;GArea_X1 + ($TextWidth / 2);
<a name="l01217"></a>01217             imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $TextLeft, $YMax+$this-&gt;FontSize + 5, $C_TextColor, $this-&gt;FontName, utf8_decode($this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'X'</span>]));
<a name="l01218"></a>01218         }
<a name="l01219"></a>01219     }
<a name="l01220"></a>01220 
<a name="l01234"></a><a class="code" href="classmt_chart.html#34bf27a8e3fcc4f091b043df20bb2a77">01234</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#34bf27a8e3fcc4f091b043df20bb2a77">drawGrid</a>($LineWidth = 4, $Mosaic = TRUE, $R = 220, $G = 220, $B = 220, $Alpha = 100) {
<a name="l01235"></a>01235         <span class="keywordflow">if</span>($Mosaic) {
<a name="l01236"></a>01236             $LayerWidth  = $this-&gt;GArea_X2 - $this-&gt;GArea_X1;
<a name="l01237"></a>01237             $LayerHeight = $this-&gt;GArea_Y2 - $this-&gt;GArea_Y1;
<a name="l01238"></a>01238 
<a name="l01239"></a>01239             $this-&gt;Layers[0] = imagecreatetruecolor($LayerWidth, $LayerHeight);
<a name="l01240"></a>01240             $C_White = $this-&gt;AllocateColor($this-&gt;Layers[0], 255, 255, 255);
<a name="l01241"></a>01241             imagefilledrectangle($this-&gt;Layers[0], 0, 0, $LayerWidth, $LayerHeight, $C_White);
<a name="l01242"></a>01242             imagecolortransparent($this-&gt;Layers[0], $C_White);
<a name="l01243"></a>01243 
<a name="l01244"></a>01244             $C_Rectangle = $this-&gt;AllocateColor($this-&gt;Layers[0], 250, 250, 250);
<a name="l01245"></a>01245 
<a name="l01246"></a>01246             $YPos  = $LayerHeight;
<a name="l01247"></a>01247             $LastY = $YPos;
<a name="l01248"></a>01248             <span class="keywordflow">for</span>($i = 0; $i &lt;= $this-&gt;DivisionCount; ++$i) {
<a name="l01249"></a>01249                 $LastY = $YPos;
<a name="l01250"></a>01250                 $YPos  -= $this-&gt;DivisionHeight;
<a name="l01251"></a>01251 
<a name="l01252"></a>01252                 <span class="keywordflow">if</span>($YPos &lt;= 0) {
<a name="l01253"></a>01253                     $YPos = 1;
<a name="l01254"></a>01254                 }
<a name="l01255"></a>01255 
<a name="l01256"></a>01256                 <span class="keywordflow">if</span>($i % 2 == 0) {
<a name="l01257"></a>01257                     imagefilledrectangle($this-&gt;Layers[0], 1, $YPos, $LayerWidth-1, $LastY, $C_Rectangle);
<a name="l01258"></a>01258                 }
<a name="l01259"></a>01259             }
<a name="l01260"></a>01260             imagecopymerge($this-&gt;Picture, $this-&gt;Layers[0], $this-&gt;GArea_X1, $this-&gt;GArea_Y1, 0, 0, $LayerWidth, $LayerHeight, $Alpha);
<a name="l01261"></a>01261             imagedestroy($this-&gt;Layers[0]);
<a name="l01262"></a>01262         }
<a name="l01263"></a>01263 
<a name="l01264"></a>01264         <span class="comment">// Horizontal lines</span>
<a name="l01265"></a>01265         $YPos = $this-&gt;GArea_Y2 - $this-&gt;DivisionHeight;
<a name="l01266"></a>01266         <span class="keywordflow">for</span>($i = 1; $i &lt;= $this-&gt;DivisionCount; ++$i) {
<a name="l01267"></a>01267             <span class="keywordflow">if</span>($YPos &gt; $this-&gt;GArea_Y1 &amp;&amp; $YPos &lt; $this-&gt;GArea_Y2) {
<a name="l01268"></a>01268                 $this-&gt;<a class="code" href="classmt_chart.html#108d0822c67fb29ab139b10bb58ffced">drawDottedLine</a>($this-&gt;GArea_X1, $YPos, $this-&gt;GArea_X2, $YPos, $LineWidth, $R, $G, $B);
<a name="l01269"></a>01269             }
<a name="l01270"></a>01270             $YPos -= $this-&gt;DivisionHeight;
<a name="l01271"></a>01271         }
<a name="l01272"></a>01272 
<a name="l01273"></a>01273         <span class="comment">// Vertical lines</span>
<a name="l01274"></a>01274         <span class="keywordflow">if</span>($this-&gt;GAreaXOffset == 0) {
<a name="l01275"></a>01275             <span class="comment">// Start with the first line not directly on the y-axis</span>
<a name="l01276"></a>01276             $XPos = $this-&gt;GArea_X1 + ($this-&gt;DivisionWidth * $this-&gt;XInterval);
<a name="l01277"></a>01277             $ColCount = $this-&gt;DataCount - 2;
<a name="l01278"></a>01278         } <span class="keywordflow">else</span> {
<a name="l01279"></a>01279             $XPos = $this-&gt;GArea_X1 + $this-&gt;GAreaXOffset;
<a name="l01280"></a>01280             $ColCount = floor(($this-&gt;GArea_X2 - $this-&gt;GArea_X1) / $this-&gt;DivisionWidth);
<a name="l01281"></a>01281         }
<a name="l01282"></a>01282 
<a name="l01283"></a>01283         <span class="keywordflow">for</span>($i = 1; $i &lt;= $ColCount; ++$i) {
<a name="l01284"></a>01284             <span class="keywordflow">if</span>($XPos &gt; $this-&gt;GArea_X1 &amp;&amp; $XPos &lt; $this-&gt;GArea_X2) {
<a name="l01285"></a>01285                 $this-&gt;<a class="code" href="classmt_chart.html#108d0822c67fb29ab139b10bb58ffced">drawDottedLine</a>(floor($XPos), $this-&gt;GArea_Y1, floor($XPos), $this-&gt;GArea_Y2, $LineWidth, $R, $G, $B);
<a name="l01286"></a>01286             }
<a name="l01287"></a>01287             $XPos += ($this-&gt;DivisionWidth * $this-&gt;XInterval);
<a name="l01288"></a>01288         }
<a name="l01289"></a>01289     }
<a name="l01290"></a>01290 
<a name="l01297"></a>01297     <span class="keyword">private</span> function getLegendBoxSize($forPie = FALSE) {
<a name="l01298"></a>01298         $fieldname = NULL;
<a name="l01299"></a>01299         $MaxWidth = 0;
<a name="l01300"></a>01300         $MaxHeight = 8;
<a name="l01301"></a>01301 
<a name="l01302"></a>01302         <span class="keywordflow">if</span>($forPie) {
<a name="l01303"></a>01303             <span class="keywordflow">if</span>(!isset($this-&gt;DataDescription[<span class="stringliteral">'Position'</span>])) {
<a name="l01304"></a>01304                 <span class="keywordflow">return</span> NULL;
<a name="l01305"></a>01305             } <span class="keywordflow">else</span> {
<a name="l01306"></a>01306                 $myDescription = $this-&gt;DataDescription[<span class="stringliteral">'Position'</span>];
<a name="l01307"></a>01307             }
<a name="l01308"></a>01308 
<a name="l01309"></a>01309             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Value) {
<a name="l01310"></a>01310                 $Position   = imageftbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Value[$myDescription]));
<a name="l01311"></a>01311                 $TextWidth  = $Position[2] - $Position[0];
<a name="l01312"></a>01312                 $TextHeight = $Position[1] - $Position[7];
<a name="l01313"></a>01313                 $MaxWidth = max($TextWidth, $MaxWidth);
<a name="l01314"></a>01314                 $MaxHeight += $TextHeight + 4;
<a name="l01315"></a>01315             }
<a name="l01316"></a>01316         } <span class="keywordflow">else</span> {
<a name="l01317"></a>01317             <span class="keywordflow">if</span>(!isset($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>])) {
<a name="l01318"></a>01318                 <span class="keywordflow">return</span> NULL;
<a name="l01319"></a>01319             }
<a name="l01320"></a>01320             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $Key =&gt; $Value) {
<a name="l01321"></a>01321                 $Position   = imageftbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Value));
<a name="l01322"></a>01322                 $TextWidth  = $Position[2] - $Position[0];
<a name="l01323"></a>01323                 $TextHeight = $Position[1] - $Position[7];
<a name="l01324"></a>01324                 $MaxWidth = max($TextWidth, $MaxWidth);
<a name="l01325"></a>01325                 $MaxHeight += $TextHeight + 4;
<a name="l01326"></a>01326             }
<a name="l01327"></a>01327         }
<a name="l01328"></a>01328 
<a name="l01329"></a>01329         $MaxHeight -= 3;
<a name="l01330"></a>01330         $MaxWidth  += 32;
<a name="l01331"></a>01331 
<a name="l01332"></a>01332         <span class="keywordflow">return</span>(array($MaxWidth, $MaxHeight));
<a name="l01333"></a>01333     }
<a name="l01334"></a>01334 
<a name="l01355"></a><a class="code" href="classmt_chart.html#6e369922a0bfc740f0e1d1b7e6ec4bfc">01355</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#6e369922a0bfc740f0e1d1b7e6ec4bfc">drawLegend</a>($XPos, $YPos, $R = 255, $G = 255, $B = 255, $Rs = NULL, $Gs = NULL, $Bs = NULL, $Rt = 0, $Gt = 0, $Bt = 0, $Border = TRUE) {
<a name="l01356"></a>01356         $this-&gt;validateDataDescription(<span class="stringliteral">'drawLegend'</span>);
<a name="l01357"></a>01357 
<a name="l01358"></a>01358         <span class="keywordflow">if</span>(!isset($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>])) {
<a name="l01359"></a>01359             <span class="keywordflow">return</span>;
<a name="l01360"></a>01360         }
<a name="l01361"></a>01361 
<a name="l01362"></a>01362         $C_TextColor = $this-&gt;AllocateColor($this-&gt;Picture, $Rt, $Gt, $Bt);
<a name="l01363"></a>01363 
<a name="l01364"></a>01364         list($MaxWidth, $MaxHeight) = $this-&gt;getLegendBoxSize();
<a name="l01365"></a>01365 
<a name="l01366"></a>01366         <span class="keywordflow">if</span>(is_null($Rs)) {
<a name="l01367"></a>01367             $Rs = max($R - 30, 0);
<a name="l01368"></a>01368         }
<a name="l01369"></a>01369         <span class="keywordflow">if</span>(is_null($Gs)) {
<a name="l01370"></a>01370             $Gs = max($G - 30, 0);
<a name="l01371"></a>01371         }
<a name="l01372"></a>01372         <span class="keywordflow">if</span>(is_null($Bs)) {
<a name="l01373"></a>01373             $Bs = max($B - 30, 0);
<a name="l01374"></a>01374         }
<a name="l01375"></a>01375 
<a name="l01376"></a>01376         <span class="keywordflow">if</span>($Border) {
<a name="l01377"></a>01377             $this-&gt;<a class="code" href="classmt_chart.html#49ed36208b1734539834cf757f97adf2">drawFilledRoundedRectangle</a>($XPos + 1, $YPos + 1, $XPos + $MaxWidth + 1, $YPos + $MaxHeight + 1, 5, $Rs, $Gs, $Bs);
<a name="l01378"></a>01378             $this-&gt;<a class="code" href="classmt_chart.html#49ed36208b1734539834cf757f97adf2">drawFilledRoundedRectangle</a>($XPos, $YPos, $XPos + $MaxWidth, $YPos + $MaxHeight, 5, $R, $G, $B);
<a name="l01379"></a>01379         }
<a name="l01380"></a>01380 
<a name="l01381"></a>01381         $YOffset = 4 + $this-&gt;FontSize;
<a name="l01382"></a>01382         $ID = 0;
<a name="l01383"></a>01383         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $Key =&gt; $Value)
<a name="l01384"></a>01384         {
<a name="l01385"></a>01385             $this-&gt;<a class="code" href="classmt_chart.html#49ed36208b1734539834cf757f97adf2">drawFilledRoundedRectangle</a>($XPos + 10, $YPos + $YOffset - 4, $XPos + 14, $YPos + $YOffset - 4, 2, $this-&gt;Palette[$ID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ID][<span class="charliteral">'B'</span>]);
<a name="l01386"></a>01386             imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $XPos+22, $YPos + $YOffset, $C_TextColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l01387"></a>01387 
<a name="l01388"></a>01388             $Position   = imageftbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Value));
<a name="l01389"></a>01389             $TextHeight = $Position[1]-$Position[7];
<a name="l01390"></a>01390 
<a name="l01391"></a>01391             $YOffset = $YOffset + $TextHeight + 4;
<a name="l01392"></a>01392             ++$ID;
<a name="l01393"></a>01393         }
<a name="l01394"></a>01394     }
<a name="l01395"></a>01395 
<a name="l01416"></a><a class="code" href="classmt_chart.html#c19fa727c723ba38234e6b2c56454cdb">01416</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#c19fa727c723ba38234e6b2c56454cdb">drawPieLegend</a>($XPos, $YPos, $R = 255, $G = 255, $B = 255, $Rs = NULL, $Gs = NULL, $Bs = NULL, $Rt = 0, $Gt = 0, $Bt = 0, $Border = TRUE) {
<a name="l01417"></a>01417         $this-&gt;validateDataDescription(<span class="stringliteral">'drawPieLegend'</span>, FALSE);
<a name="l01418"></a>01418         $this-&gt;validateData(<span class="stringliteral">'drawPieLegend'</span>);
<a name="l01419"></a>01419 
<a name="l01420"></a>01420         <span class="keywordflow">if</span>(is_null($this-&gt;DataDescription[<span class="stringliteral">'Position'</span>])) {
<a name="l01421"></a>01421             <span class="keywordflow">return</span>;
<a name="l01422"></a>01422         }
<a name="l01423"></a>01423 
<a name="l01424"></a>01424         $C_TextColor = $this-&gt;AllocateColor($this-&gt;Picture, $Rt, $Gt, $Bt);
<a name="l01425"></a>01425 
<a name="l01426"></a>01426         list($MaxWidth, $MaxHeight) = $this-&gt;getLegendBoxSize(TRUE);
<a name="l01427"></a>01427 
<a name="l01428"></a>01428         <span class="keywordflow">if</span>(is_null($Rs)) {
<a name="l01429"></a>01429             $Rs = max($R - 30, 0);
<a name="l01430"></a>01430         }
<a name="l01431"></a>01431         <span class="keywordflow">if</span>(is_null($Gs)) {
<a name="l01432"></a>01432             $Gs = max($G - 30, 0);
<a name="l01433"></a>01433         }
<a name="l01434"></a>01434         <span class="keywordflow">if</span>(is_null($Bs)) {
<a name="l01435"></a>01435             $Bs = max($B - 30, 0);
<a name="l01436"></a>01436         }
<a name="l01437"></a>01437 
<a name="l01438"></a>01438         <span class="keywordflow">if</span>($Border) {
<a name="l01439"></a>01439             $this-&gt;<a class="code" href="classmt_chart.html#49ed36208b1734539834cf757f97adf2">drawFilledRoundedRectangle</a>($XPos + 1, $YPos + 1, $XPos + $MaxWidth + 1, $YPos + $MaxHeight + 1, 5, $Rs, $Gs, $Bs);
<a name="l01440"></a>01440             $this-&gt;<a class="code" href="classmt_chart.html#49ed36208b1734539834cf757f97adf2">drawFilledRoundedRectangle</a>($XPos, $YPos, $XPos + $MaxWidth, $YPos + $MaxHeight, 5, $R, $G, $B);
<a name="l01441"></a>01441         }
<a name="l01442"></a>01442 
<a name="l01443"></a>01443         $YOffset = 4 + $this-&gt;FontSize;
<a name="l01444"></a>01444         $ID = 0;
<a name="l01445"></a>01445         <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Value) {
<a name="l01446"></a>01446             $Value2     = $Value[$this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]];
<a name="l01447"></a>01447             $Position   = imageftbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Value2));
<a name="l01448"></a>01448             $TextHeight = $Position[1] - $Position[7];
<a name="l01449"></a>01449             $this-&gt;<a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">drawFilledRectangle</a>($XPos + 10, $YPos + $YOffset - 6, $XPos + 14, $YPos + $YOffset - 2, $this-&gt;Palette[$ID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ID][<span class="charliteral">'B'</span>]);
<a name="l01450"></a>01450 
<a name="l01451"></a>01451             imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $XPos + 22, $YPos + $YOffset, $C_TextColor, $this-&gt;FontName, utf8_decode($Value2));
<a name="l01452"></a>01452             $YOffset = $YOffset + $TextHeight + 4;
<a name="l01453"></a>01453             ++$ID;
<a name="l01454"></a>01454         }
<a name="l01455"></a>01455     }
<a name="l01456"></a>01456 
<a name="l01475"></a><a class="code" href="classmt_chart.html#17501539052f5d5cdf2421273b01f566">01475</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#17501539052f5d5cdf2421273b01f566">drawTitle</a>($XPos, $YPos, $Value, $R = 0, $G = 0, $B = 0, $XPos2 = NULL, $YPos2 = NULL, $Shadow = FALSE) {
<a name="l01476"></a>01476         $C_TextColor = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l01477"></a>01477         $Position = imageftbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Value));
<a name="l01478"></a>01478 
<a name="l01479"></a>01479         <span class="keywordflow">if</span>(isset($XPos2)) {
<a name="l01480"></a>01480             $TextWidth = $Position[2] - $Position[0];
<a name="l01481"></a>01481             $XPos      = floor(($XPos2 - $XPos - $TextWidth) / 2) + $XPos;
<a name="l01482"></a>01482         }
<a name="l01483"></a>01483 
<a name="l01484"></a>01484         <span class="keywordflow">if</span>(isset($YPos2)) {
<a name="l01485"></a>01485             $TextHeight = $Position[5] - $Position[3];
<a name="l01486"></a>01486             $YPos       = floor(($YPos2 - $YPos - $TextHeight) / 2) + $YPos;
<a name="l01487"></a>01487         }
<a name="l01488"></a>01488 
<a name="l01489"></a>01489         <span class="keywordflow">if</span>($Shadow) {
<a name="l01490"></a>01490             $C_ShadowColor = $this-&gt;AllocateColor($this-&gt;Picture, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor);
<a name="l01491"></a>01491             imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $XPos + $this-&gt;ShadowXDistance, $YPos + $this-&gt;ShadowYDistance, $C_ShadowColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l01492"></a>01492         }
<a name="l01493"></a>01493 
<a name="l01494"></a>01494         imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $XPos, $YPos, $C_TextColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l01495"></a>01495     }
<a name="l01496"></a>01496 
<a name="l01532"></a><a class="code" href="classmt_chart.html#14d4e9bdf66042136b58cbd275b036f6">01532</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#14d4e9bdf66042136b58cbd275b036f6">drawTextBox</a>($X1, $Y1, $X2, $Y2, $Text, $Angle = 0, $R = 255, $G = 255, $B = 255, $Align = ALIGN_LEFT, $Shadow = TRUE, $BgR = NULL, $BgG = NULL, $BgB = NULL, $Alpha = 100) {
<a name="l01533"></a>01533         $Position   = imageftbbox($this-&gt;FontSize, $Angle, $this-&gt;FontName, utf8_decode($Text));
<a name="l01534"></a>01534         $TextWidth  = $Position[2] - $Position[0];
<a name="l01535"></a>01535         $TextHeight = $Position[5] - $Position[3];
<a name="l01536"></a>01536         $AreaWidth  = $X2 - $X1;
<a name="l01537"></a>01537         $AreaHeight = $Y2 - $Y1;
<a name="l01538"></a>01538 
<a name="l01539"></a>01539         <span class="keywordflow">if</span>(isset($BgR, $BgG, $BgB)) {
<a name="l01540"></a>01540             $this-&gt;<a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">drawFilledRectangle</a>($X1, $Y1, $X2, $Y2, $BgR, $BgG, $BgB, FALSE, $Alpha);
<a name="l01541"></a>01541         }
<a name="l01542"></a>01542 
<a name="l01543"></a>01543         <span class="keywordflow">switch</span>($Align) {
<a name="l01544"></a>01544             <span class="keywordflow">case</span> ALIGN_TOP_LEFT:
<a name="l01545"></a>01545                 $X = $X1 + 1;
<a name="l01546"></a>01546                 $Y = $Y1 + $this-&gt;FontSize + 1;
<a name="l01547"></a>01547                 <span class="keywordflow">break</span>;
<a name="l01548"></a>01548             <span class="keywordflow">case</span> ALIGN_TOP_CENTER:
<a name="l01549"></a>01549                 $X = $X1 + ($AreaWidth / 2) - ($TextWidth / 2);
<a name="l01550"></a>01550                 $Y = $Y1 + $this-&gt;FontSize + 1;
<a name="l01551"></a>01551                 <span class="keywordflow">break</span>;
<a name="l01552"></a>01552             <span class="keywordflow">case</span> ALIGN_TOP_RIGHT:
<a name="l01553"></a>01553                 $X = $X2 - $TextWidth - 1;
<a name="l01554"></a>01554                 $Y = $Y1 + $this-&gt;FontSize + 1;
<a name="l01555"></a>01555                 <span class="keywordflow">break</span>;
<a name="l01556"></a>01556             <span class="keywordflow">default</span>: <span class="comment">// Break intentionally omitted</span>
<a name="l01557"></a>01557             <span class="keywordflow">case</span> ALIGN_LEFT:
<a name="l01558"></a>01558                 $X = $X1 + 1;
<a name="l01559"></a>01559                 $Y = $Y1 + ($AreaHeight / 2) - ($TextHeight / 2);
<a name="l01560"></a>01560                 <span class="keywordflow">break</span>;
<a name="l01561"></a>01561             <span class="keywordflow">case</span> ALIGN_CENTER:
<a name="l01562"></a>01562                 $X = $X1 + ($AreaWidth / 2) - ($TextWidth / 2);
<a name="l01563"></a>01563                 $Y = $Y1 + ($AreaHeight / 2) - ($TextHeight / 2);
<a name="l01564"></a>01564                 <span class="keywordflow">break</span>;
<a name="l01565"></a>01565             <span class="keywordflow">case</span> ALIGN_RIGHT:
<a name="l01566"></a>01566                 $X = $X2 - $TextWidth - 1;
<a name="l01567"></a>01567                 $Y = $Y1 + ($AreaHeight / 2) - ($TextHeight / 2);
<a name="l01568"></a>01568                 <span class="keywordflow">break</span>;
<a name="l01569"></a>01569             <span class="keywordflow">case</span> ALIGN_BOTTOM_LEFT:
<a name="l01570"></a>01570                 $X = $X1 + 1;
<a name="l01571"></a>01571                 $Y = $Y2 - 1;
<a name="l01572"></a>01572                 <span class="keywordflow">break</span>;
<a name="l01573"></a>01573             <span class="keywordflow">case</span> ALIGN_BOTTOM_CENTER:
<a name="l01574"></a>01574                 $X = $X1 + ($AreaWidth / 2) - ($TextWidth / 2);
<a name="l01575"></a>01575                 $Y = $Y2 - 1;
<a name="l01576"></a>01576                 <span class="keywordflow">break</span>;
<a name="l01577"></a>01577             <span class="keywordflow">case</span> ALIGN_BOTTOM_RIGHT:
<a name="l01578"></a>01578                 $X = $X2 - $TextWidth - 1;
<a name="l01579"></a>01579                 $Y = $Y2 - 1;
<a name="l01580"></a>01580                 <span class="keywordflow">break</span>;
<a name="l01581"></a>01581         }
<a name="l01582"></a>01582 
<a name="l01583"></a>01583         <span class="keywordflow">if</span>($Shadow) {
<a name="l01584"></a>01584             $C_ShadowColor = $this-&gt;AllocateColor($this-&gt;Picture, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor);
<a name="l01585"></a>01585             imagettftext($this-&gt;Picture, $this-&gt;FontSize, $Angle, $X + $this-&gt;ShadowXDistance, $Y + $this-&gt;ShadowYDistance, $C_ShadowColor, $this-&gt;FontName, utf8_decode($Text));
<a name="l01586"></a>01586         }
<a name="l01587"></a>01587 
<a name="l01588"></a>01588         $C_TextColor   = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l01589"></a>01589         imagettftext($this-&gt;Picture, $this-&gt;FontSize, $Angle, $X, $Y, $C_TextColor, $this-&gt;FontName, utf8_decode($Text));
<a name="l01590"></a>01590     }
<a name="l01591"></a>01591 
<a name="l01608"></a><a class="code" href="classmt_chart.html#c341c76074aff9696d80272166a8b1a7">01608</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#c341c76074aff9696d80272166a8b1a7">drawTreshold</a>($Value, $R = 255, $G = 80, $B = 51, $ShowLabel = FALSE, $ShowOnRight = FALSE, $TickWidth = 4, $FreeText = NULL) {
<a name="l01609"></a>01609         $C_TextColor = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l01610"></a>01610         $Y = $this-&gt;GArea_Y2 - ($Value - $this-&gt;VMin) * $this-&gt;DivisionRatio;
<a name="l01611"></a>01611 
<a name="l01612"></a>01612         <span class="comment">// Check if it falls into graph</span>
<a name="l01613"></a>01613         <span class="keywordflow">if</span>($Y &lt;= $this-&gt;GArea_Y1 || $Y &gt;= $this-&gt;GArea_Y2) {
<a name="l01614"></a>01614             <span class="keywordflow">return</span>;
<a name="l01615"></a>01615         }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617         <span class="keywordflow">if</span>($TickWidth == 0) {
<a name="l01618"></a>01618             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($this-&gt;GArea_X1, $Y, $this-&gt;GArea_X2, $Y, $R, $G, $B);
<a name="l01619"></a>01619         } <span class="keywordflow">else</span> {
<a name="l01620"></a>01620             $this-&gt;<a class="code" href="classmt_chart.html#108d0822c67fb29ab139b10bb58ffced">drawDottedLine</a>($this-&gt;GArea_X1, $Y, $this-&gt;GArea_X2, $Y, $TickWidth, $R, $G, $B);
<a name="l01621"></a>01621         }
<a name="l01622"></a>01622 
<a name="l01623"></a>01623         <span class="keywordflow">if</span>($ShowLabel) {
<a name="l01624"></a>01624             <span class="keywordflow">if</span>(is_null($FreeText)) {
<a name="l01625"></a>01625                 $Label = $Value;
<a name="l01626"></a>01626             } <span class="keywordflow">else</span> {
<a name="l01627"></a>01627                 $Label = $FreeText;
<a name="l01628"></a>01628             }
<a name="l01629"></a>01629 
<a name="l01630"></a>01630             <span class="keywordflow">if</span>($ShowOnRight) {
<a name="l01631"></a>01631                 imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $this-&gt;GArea_X2 + 2, $Y + ($this-&gt;FontSize / 2), $C_TextColor, $this-&gt;FontName, utf8_decode($Label));
<a name="l01632"></a>01632             } <span class="keywordflow">else</span> {
<a name="l01633"></a>01633                 imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $this-&gt;GArea_X1 + 2, $Y - ($this-&gt;FontSize / 2), $C_TextColor, $this-&gt;FontName, utf8_decode($Label));
<a name="l01634"></a>01634             }
<a name="l01635"></a>01635         }
<a name="l01636"></a>01636     }
<a name="l01637"></a>01637 
<a name="l01661"></a><a class="code" href="classmt_chart.html#089607972e4f13328073d381e60bfa44">01661</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#089607972e4f13328073d381e60bfa44">drawVerticalLine</a>($ValueName, $SerieName = <span class="stringliteral">'Serie1'</span>, $R = 255, $G = 80, $B = 51, $TickWidth = 4, $FreeText = NULL, $TextPosition = ALIGN_TOP_RIGHT) {
<a name="l01662"></a>01662         $C_TextColor = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l01663"></a>01663 
<a name="l01664"></a>01664         <span class="comment">// Find value</span>
<a name="l01665"></a>01665         $Cp = 0;
<a name="l01666"></a>01666         <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Value) {
<a name="l01667"></a>01667             <span class="keywordflow">if</span>($this-&gt;Data[$Key][$this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]] == $ValueName) {
<a name="l01668"></a>01668                 $NumericalValue = $this-&gt;Data[$Key][$SerieName];
<a name="l01669"></a>01669                 <span class="keywordflow">break</span>;
<a name="l01670"></a>01670             }
<a name="l01671"></a>01671             ++$Cp;
<a name="l01672"></a>01672         }
<a name="l01673"></a>01673 
<a name="l01674"></a>01674         $X = $this-&gt;GArea_X1 + $this-&gt;GAreaXOffset + ($this-&gt;DivisionWidth * $Cp);
<a name="l01675"></a>01675 
<a name="l01676"></a>01676         <span class="keywordflow">if</span>($TickWidth == 0) {
<a name="l01677"></a>01677             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X, $this-&gt;GArea_Y1, $X, $this-&gt;GArea_Y2, $R, $G, $B);
<a name="l01678"></a>01678         } <span class="keywordflow">else</span> {
<a name="l01679"></a>01679             $this-&gt;<a class="code" href="classmt_chart.html#108d0822c67fb29ab139b10bb58ffced">drawDottedLine</a>($X, $this-&gt;GArea_Y1, $X, $this-&gt;GArea_Y2, $TickWidth, $R, $G, $B);
<a name="l01680"></a>01680         }
<a name="l01681"></a>01681 
<a name="l01682"></a>01682         <span class="keywordflow">if</span>(! is_null($FreeText)) {
<a name="l01683"></a>01683             $Position   = imageftbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($FreeText));
<a name="l01684"></a>01684             $TextHeight = $Position[3] - $Position[5] + 2;
<a name="l01685"></a>01685             $TextWidth  = $Position[2] - $Position[0] + 2;
<a name="l01686"></a>01686 
<a name="l01687"></a>01687             <span class="keywordflow">switch</span>($TextPosition) {
<a name="l01688"></a>01688                 <span class="keywordflow">default</span>: <span class="comment">// Break intentionally omitted</span>
<a name="l01689"></a>01689                 <span class="keywordflow">case</span> ALIGN_TOP_RIGHT:
<a name="l01690"></a>01690                     $TX = $X + 1;
<a name="l01691"></a>01691                     $TY = $this-&gt;GArea_Y1 + $TextHeight;
<a name="l01692"></a>01692                     <span class="keywordflow">break</span>;
<a name="l01693"></a>01693                 <span class="keywordflow">case</span> ALIGN_TOP_LEFT:
<a name="l01694"></a>01694                     $TX = $X - $TextWidth - 1;
<a name="l01695"></a>01695                     $TY = $this-&gt;GArea_Y1 + $TextHeight;
<a name="l01696"></a>01696                     <span class="keywordflow">break</span>;
<a name="l01697"></a>01697                 <span class="keywordflow">case</span> ALIGN_BOTTOM_LEFT:
<a name="l01698"></a>01698                     $TX = $X - $TextWidth - 1;
<a name="l01699"></a>01699                     $TY = $this-&gt;GArea_Y2 - $TextHeight;
<a name="l01700"></a>01700                     <span class="keywordflow">break</span>;
<a name="l01701"></a>01701                 <span class="keywordflow">case</span> ALIGN_BOTTOM_RIGHT:
<a name="l01702"></a>01702                     $TX = $X + 1;
<a name="l01703"></a>01703                     $TY = $this-&gt;GArea_Y2 - $TextHeight;
<a name="l01704"></a>01704                     <span class="keywordflow">break</span>;
<a name="l01705"></a>01705             }
<a name="l01706"></a>01706 
<a name="l01707"></a>01707             imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $TX, $TY, $C_TextColor, $this-&gt;FontName, utf8_decode($FreeText));
<a name="l01708"></a>01708         }
<a name="l01709"></a>01709     }
<a name="l01710"></a>01710 
<a name="l01711"></a>01711 
<a name="l01733"></a><a class="code" href="classmt_chart.html#1fe488155df36bfe113908ffc41b3206">01733</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#1fe488155df36bfe113908ffc41b3206">setLabel</a>($SerieName = <span class="stringliteral">'Serie1'</span>, $ValueName, $Caption, $R = 210, $G = 210, $B = 210, $Rt = 0, $Gt = 0, $Bt = 0, $Shadow = TRUE) {
<a name="l01734"></a>01734         $this-&gt;validateDataDescription(<span class="stringliteral">'setLabel'</span>);
<a name="l01735"></a>01735         $this-&gt;validateData(<span class="stringliteral">'setLabel'</span>);
<a name="l01736"></a>01736         $C_Label      = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l01737"></a>01737         $C_TextColor  = $this-&gt;AllocateColor($this-&gt;Picture, $Rt, $Gt, $Bt);
<a name="l01738"></a>01738 
<a name="l01739"></a>01739         $Cp = 0;
<a name="l01740"></a>01740         <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Value) {
<a name="l01741"></a>01741             <span class="keywordflow">if</span>($this-&gt;Data[$Key][$this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]] == $ValueName) {
<a name="l01742"></a>01742                 $NumericalValue = $this-&gt;Data[$Key][$SerieName];
<a name="l01743"></a>01743                 <span class="keywordflow">break</span>;
<a name="l01744"></a>01744             }
<a name="l01745"></a>01745             ++$Cp;
<a name="l01746"></a>01746         }
<a name="l01747"></a>01747 
<a name="l01748"></a>01748         $XPos = $this-&gt;GArea_X1 + $this-&gt;GAreaXOffset + ($this-&gt;DivisionWidth * $Cp) + 2;
<a name="l01749"></a>01749         $YPos = $this-&gt;GArea_Y2 - ($NumericalValue - $this-&gt;VMin) * $this-&gt;DivisionRatio;
<a name="l01750"></a>01750 
<a name="l01751"></a>01751         $Position   = imageftbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Caption));
<a name="l01752"></a>01752         $TextHeight = $Position[3] - $Position[5] + 2;
<a name="l01753"></a>01753         $TextWidth  = $Position[2] - $Position[0] + 2;
<a name="l01754"></a>01754         $TextOffset = floor($TextHeight / 2);
<a name="l01755"></a>01755 
<a name="l01756"></a>01756         <span class="comment">// Draw Shadow</span>
<a name="l01757"></a>01757         <span class="keywordflow">if</span>($Shadow) {
<a name="l01758"></a>01758             $C_Shadow = $this-&gt;AllocateColor($this-&gt;Picture, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor);
<a name="l01759"></a>01759             $Poly = array($XPos + 1, $YPos + 1, $XPos + 9, $YPos - $TextOffset, $XPos + 8, $YPos + $TextOffset + 2);
<a name="l01760"></a>01760             imagefilledpolygon($this-&gt;Picture, $Poly, 3, $C_Shadow);
<a name="l01761"></a>01761             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XPos, $YPos + 1, $XPos + 9, $YPos - $TextOffset - 0.2, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor);
<a name="l01762"></a>01762             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XPos, $YPos + 1, $XPos + 9, $YPos + $TextOffset + 2.2, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor);
<a name="l01763"></a>01763             $this-&gt;<a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">drawFilledRectangle</a>($XPos + 9, $YPos - $TextOffset - 0.2, $XPos + 13 + $TextWidth, $YPos + $TextOffset + 2.2, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor);
<a name="l01764"></a>01764         }
<a name="l01765"></a>01765 
<a name="l01766"></a>01766         <span class="comment">// Draw Label background</span>
<a name="l01767"></a>01767         $Poly = array($XPos, $YPos, $XPos + 8, $YPos - $TextOffset - 1, $XPos + 8, $YPos + $TextOffset + 1);
<a name="l01768"></a>01768         imagefilledpolygon($this-&gt;Picture, $Poly, 3, $C_Label);
<a name="l01769"></a>01769         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XPos-1, $YPos, $XPos + 8, $YPos - $TextOffset - 1.2, $R, $G, $B);
<a name="l01770"></a>01770         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XPos-1, $YPos, $XPos + 8, $YPos + $TextOffset + 1.2, $R, $G, $B);
<a name="l01771"></a>01771         $this-&gt;<a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">drawFilledRectangle</a>($XPos + 8, $YPos - $TextOffset - 1.2, $XPos + 12 + $TextWidth, $YPos + $TextOffset + 1.2, $R, $G, $B);
<a name="l01772"></a>01772 
<a name="l01773"></a>01773         imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $XPos + 10, $YPos + $TextOffset, $C_TextColor, $this-&gt;FontName, utf8_decode($Caption));
<a name="l01774"></a>01774     }
<a name="l01775"></a>01775 
<a name="l01776"></a>01776     <span class="comment">/* This function draw a plot graph */</span>
<a name="l01793"></a><a class="code" href="classmt_chart.html#f35973762d987a768e688372ac44c89f">01793</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#f35973762d987a768e688372ac44c89f">drawPlotGraph</a>($BigRadius = 5, $SmallRadius = 2, $R2 = NULL, $G2 = NULL, $B2 = NULL, $Shadow = FALSE) {
<a name="l01794"></a>01794         $this-&gt;validateDataDescription(<span class="stringliteral">'drawPlotGraph'</span>);
<a name="l01795"></a>01795         $this-&gt;validateData(<span class="stringliteral">'drawPlotGraph'</span>);
<a name="l01796"></a>01796 
<a name="l01797"></a>01797         $GraphID = 0;
<a name="l01798"></a>01798         $Ro = $R2;
<a name="l01799"></a>01799         $Go = $G2;
<a name="l01800"></a>01800         $Bo = $B2;
<a name="l01801"></a>01801 
<a name="l01802"></a>01802         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l01803"></a>01803             $ID = 0;
<a name="l01804"></a>01804             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $keyI =&gt; $ValueI) {
<a name="l01805"></a>01805                 <span class="keywordflow">if</span>($keyI == $ColName) {
<a name="l01806"></a>01806                     $ColorID = $ID;
<a name="l01807"></a>01807                 }
<a name="l01808"></a>01808                 ++$ID;
<a name="l01809"></a>01809             }
<a name="l01810"></a>01810 
<a name="l01811"></a>01811             $R = $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>];
<a name="l01812"></a>01812             $G = $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>];
<a name="l01813"></a>01813             $B = $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>];
<a name="l01814"></a>01814             $R2 = $Ro;
<a name="l01815"></a>01815             $G2 = $Go;
<a name="l01816"></a>01816             $B2 = $Bo;
<a name="l01817"></a>01817 
<a name="l01818"></a>01818             <span class="comment">// Load symbol image</span>
<a name="l01819"></a>01819             <span class="keywordflow">if</span>(isset($this-&gt;DataDescription[<span class="stringliteral">'Symbol'</span>][$ColName])) {
<a name="l01820"></a>01820                 $Is_Alpha = ((ord (file_get_contents ($this-&gt;DataDescription[<span class="stringliteral">'Symbol'</span>][$ColName], <span class="keyword">false</span>, null, 25, 1)) &amp; 6) &amp; 4) == 4;
<a name="l01821"></a>01821 
<a name="l01822"></a>01822                 $Infos       = getimagesize($this-&gt;DataDescription[<span class="stringliteral">'Symbol'</span>][$ColName]);
<a name="l01823"></a>01823                 $ImageWidth  = $Infos[0];
<a name="l01824"></a>01824                 $ImageHeight = $Infos[1];
<a name="l01825"></a>01825                 $Symbol      = imagecreatefromgif($this-&gt;DataDescription[<span class="stringliteral">'Symbol'</span>][$ColName]);
<a name="l01826"></a>01826             }
<a name="l01827"></a>01827 
<a name="l01828"></a>01828             $XPos  = $this-&gt;GArea_X1 + $this-&gt;GAreaXOffset;
<a name="l01829"></a>01829             $Hsize = round($BigRadius / 2);
<a name="l01830"></a>01830             $R3 = NULL;
<a name="l01831"></a>01831             $G3 = NULL;
<a name="l01832"></a>01832             $B3 = NULL;
<a name="l01833"></a>01833 
<a name="l01834"></a>01834             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l01835"></a>01835                 $Value = $this-&gt;Data[$Key][$ColName];
<a name="l01836"></a>01836                 $YPos  = $this-&gt;GArea_Y2 - (($Value-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l01837"></a>01837 
<a name="l01838"></a>01838                 <span class="comment">// Save point to image map if required</span>
<a name="l01839"></a>01839                 <span class="keywordflow">if</span>($this-&gt;BuildMap) {
<a name="l01840"></a>01840                     $this-&gt;addToImageMap($XPos - $Hsize, $YPos - $Hsize, $XPos + 1 + $Hsize, $YPos + $Hsize + 1, $this-&gt;DataDescription[<span class="stringliteral">'Description'</span>][$ColName], $this-&gt;Data[$Key][$ColName].$this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'Y'</span>], <span class="stringliteral">'Plot'</span>);
<a name="l01841"></a>01841                 }
<a name="l01842"></a>01842 
<a name="l01843"></a>01843                 <span class="comment">// Draw value point</span>
<a name="l01844"></a>01844                 <span class="keywordflow">if</span>(is_numeric($Value)) {
<a name="l01845"></a>01845                     <span class="comment">// Check for image as dot</span>
<a name="l01846"></a>01846                     <span class="keywordflow">if</span>(@is_null($this-&gt;DataDescription[<span class="stringliteral">'Symbol'</span>][$ColName])) {
<a name="l01847"></a>01847                         <span class="comment">// Draw shadow</span>
<a name="l01848"></a>01848                         <span class="keywordflow">if</span>($Shadow) {
<a name="l01849"></a>01849                             <span class="keywordflow">if</span>(isset($R3, $G3, $B3)) {
<a name="l01850"></a>01850                                 $this-&gt;<a class="code" href="classmt_chart.html#052b3ef7036ff7e4c830b69325372a08">drawFilledCircle</a>($XPos+2, $YPos+2, $BigRadius, $R3, $G3, $B3);
<a name="l01851"></a>01851                             } <span class="keywordflow">else</span> {
<a name="l01852"></a>01852                                 $R3 = $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>]-20;
<a name="l01853"></a>01853                                 $G3 = $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>]-20;
<a name="l01854"></a>01854                                 $B3 = $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>]-20;
<a name="l01855"></a>01855                                 $this-&gt;<a class="code" href="classmt_chart.html#052b3ef7036ff7e4c830b69325372a08">drawFilledCircle</a>($XPos+2, $YPos+2, $BigRadius, $R3, $G3, $B3);
<a name="l01856"></a>01856                             }
<a name="l01857"></a>01857                         }
<a name="l01858"></a>01858 
<a name="l01859"></a>01859                         <span class="comment">// Draw dot</span>
<a name="l01860"></a>01860                         $this-&gt;<a class="code" href="classmt_chart.html#052b3ef7036ff7e4c830b69325372a08">drawFilledCircle</a>($XPos+1, $YPos+1, $BigRadius, $R, $G, $B);
<a name="l01861"></a>01861 
<a name="l01862"></a>01862                         <span class="comment">// Draw inner circle</span>
<a name="l01863"></a>01863                         <span class="keywordflow">if</span>($SmallRadius &gt; 0) {
<a name="l01864"></a>01864                             <span class="keywordflow">if</span>(! isset($R2, $G2, $B2)) {
<a name="l01865"></a>01865                                 $R2 = $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>] - 15;
<a name="l01866"></a>01866                                 $G2 = $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>] - 15;
<a name="l01867"></a>01867                                 $B2 = $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>] - 15;
<a name="l01868"></a>01868                             }
<a name="l01869"></a>01869 
<a name="l01870"></a>01870                             $this-&gt;<a class="code" href="classmt_chart.html#052b3ef7036ff7e4c830b69325372a08">drawFilledCircle</a>($XPos + 1, $YPos + 1, $SmallRadius, $R2, $G2, $B2);
<a name="l01871"></a>01871                         }
<a name="l01872"></a>01872                     } <span class="keywordflow">else</span> {
<a name="l01873"></a>01873                         imagecopymerge($this-&gt;Picture, $Symbol, $XPos+1-$ImageWidth/2, $YPos+1-$ImageHeight/2, 0, 0, $ImageWidth, $ImageHeight,100);
<a name="l01874"></a>01874                     }
<a name="l01875"></a>01875                 }
<a name="l01876"></a>01876 
<a name="l01877"></a>01877                 $XPos += $this-&gt;DivisionWidth;
<a name="l01878"></a>01878             }
<a name="l01879"></a>01879             ++$GraphID;
<a name="l01880"></a>01880         }
<a name="l01881"></a>01881     }
<a name="l01882"></a>01882 
<a name="l01883"></a>01883     <span class="comment">/* This function draw a plot graph in an X/Y space */</span>
<a name="l01897"></a><a class="code" href="classmt_chart.html#4268ed04c3c58ac3a3eed7067e3f3af0">01897</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#4268ed04c3c58ac3a3eed7067e3f3af0">drawXYPlotGraph</a>($YSerieName, $XSerieName, $PaletteID = 0, $BigRadius = 5, $SmallRadius = 2, $R2 = NULL, $G2 = NULL, $B2 = NULL, $Shadow = TRUE) {
<a name="l01898"></a>01898         $R = $this-&gt;Palette[$PaletteID][<span class="charliteral">'R'</span>];
<a name="l01899"></a>01899         $G = $this-&gt;Palette[$PaletteID][<span class="charliteral">'G'</span>];
<a name="l01900"></a>01900         $B = $this-&gt;Palette[$PaletteID][<span class="charliteral">'B'</span>];
<a name="l01901"></a>01901         $R3 = NULL;
<a name="l01902"></a>01902         $G3 = NULL;
<a name="l01903"></a>01903         $B3 = NULL;
<a name="l01904"></a>01904 
<a name="l01905"></a>01905         <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l01906"></a>01906             <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$YSerieName], $this-&gt;Data[$Key][$XSerieName])) {
<a name="l01907"></a>01907                 $Y = $this-&gt;GArea_Y2 - (($Y-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l01908"></a>01908                 $X = $this-&gt;GArea_X1 + (($X-$this-&gt;VXMin) * $this-&gt;XDivisionRatio);
<a name="l01909"></a>01909 
<a name="l01910"></a>01910                 <span class="comment">// Draw shadow</span>
<a name="l01911"></a>01911                 <span class="keywordflow">if</span>($Shadow) {
<a name="l01912"></a>01912                     <span class="keywordflow">if</span>(isset($R3, $G3, $B3)) {
<a name="l01913"></a>01913                         $this-&gt;<a class="code" href="classmt_chart.html#052b3ef7036ff7e4c830b69325372a08">drawFilledCircle</a>($X+2, $Y+2, $BigRadius, $R3, $G3, $B3);
<a name="l01914"></a>01914                     } <span class="keywordflow">else</span> {
<a name="l01915"></a>01915                         $R3 = $this-&gt;Palette[$PaletteID][<span class="charliteral">'R'</span>] - 20;
<a name="l01916"></a>01916                         $G3 = $this-&gt;Palette[$PaletteID][<span class="charliteral">'G'</span>] - 20;
<a name="l01917"></a>01917                         $B3 = $this-&gt;Palette[$PaletteID][<span class="charliteral">'B'</span>] - 20;
<a name="l01918"></a>01918                         $this-&gt;<a class="code" href="classmt_chart.html#052b3ef7036ff7e4c830b69325372a08">drawFilledCircle</a>($X + 2, $Y + 2, $BigRadius, $R3, $G3, $B3);
<a name="l01919"></a>01919                     }
<a name="l01920"></a>01920                 }
<a name="l01921"></a>01921 
<a name="l01922"></a>01922                 <span class="comment">// Draw circle</span>
<a name="l01923"></a>01923                 $this-&gt;<a class="code" href="classmt_chart.html#052b3ef7036ff7e4c830b69325372a08">drawFilledCircle</a>($X+1, $Y+1, $BigRadius, $R, $G, $B);
<a name="l01924"></a>01924 
<a name="l01925"></a>01925                 <span class="comment">// Draw inner circle</span>
<a name="l01926"></a>01926                 <span class="keywordflow">if</span>($SmallRadius &gt; 0) {
<a name="l01927"></a>01927                     <span class="keywordflow">if</span>(isset($R2, $G2, $B2)) {
<a name="l01928"></a>01928                         $this-&gt;<a class="code" href="classmt_chart.html#052b3ef7036ff7e4c830b69325372a08">drawFilledCircle</a>($X + 1, $Y + 1, $SmallRadius, $R2, $G2, $B2);
<a name="l01929"></a>01929                     } <span class="keywordflow">else</span> {
<a name="l01930"></a>01930                         $R2 = $this-&gt;Palette[$PaletteID][<span class="charliteral">'R'</span>] + 20;
<a name="l01931"></a>01931                         $G2 = $this-&gt;Palette[$PaletteID][<span class="charliteral">'G'</span>] + 20;
<a name="l01932"></a>01932                         $B2 = $this-&gt;Palette[$PaletteID][<span class="charliteral">'B'</span>] + 20;
<a name="l01933"></a>01933                         $this-&gt;<a class="code" href="classmt_chart.html#052b3ef7036ff7e4c830b69325372a08">drawFilledCircle</a>($X + 1, $Y + 1, $SmallRadius, $R2, $G2, $B2);
<a name="l01934"></a>01934                     }
<a name="l01935"></a>01935                 }
<a name="l01936"></a>01936             }
<a name="l01937"></a>01937         }
<a name="l01938"></a>01938     }
<a name="l01939"></a>01939 
<a name="l01950"></a><a class="code" href="classmt_chart.html#c84d05266d5e8caab420fa1881a84839">01950</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#c84d05266d5e8caab420fa1881a84839">drawArea</a>($Serie1, $Serie2, $R, $G, $B, $Alpha = 50) {
<a name="l01951"></a>01951         $this-&gt;validateData(<span class="stringliteral">'drawArea'</span>);
<a name="l01952"></a>01952 
<a name="l01953"></a>01953         $LayerWidth  = $this-&gt;GArea_X2 - $this-&gt;GArea_X1;
<a name="l01954"></a>01954         $LayerHeight = $this-&gt;GArea_Y2 - $this-&gt;GArea_Y1;
<a name="l01955"></a>01955 
<a name="l01956"></a>01956         $this-&gt;Layers[0] = imagecreatetruecolor($LayerWidth, $LayerHeight);
<a name="l01957"></a>01957         $C_White         = $this-&gt;AllocateColor($this-&gt;Layers[0], 255, 255, 255);
<a name="l01958"></a>01958         imagefilledrectangle($this-&gt;Layers[0], 0, 0, $LayerWidth, $LayerHeight, $C_White);
<a name="l01959"></a>01959         imagecolortransparent($this-&gt;Layers[0], $C_White);
<a name="l01960"></a>01960 
<a name="l01961"></a>01961         $C_Graph = $this-&gt;AllocateColor($this-&gt;Layers[0], $R, $G, $B);
<a name="l01962"></a>01962 
<a name="l01963"></a>01963         $XPos     = $this-&gt;GAreaXOffset;
<a name="l01964"></a>01964         $LastXPos = NULL;
<a name="l01965"></a>01965         <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l01966"></a>01966             $Value1 = $this-&gt;Data[$Key][$Serie1];
<a name="l01967"></a>01967             $Value2 = $this-&gt;Data[$Key][$Serie2];
<a name="l01968"></a>01968             $YPos1  = $LayerHeight - (($Value1-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l01969"></a>01969             $YPos2  = $LayerHeight - (($Value2-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l01970"></a>01970 
<a name="l01971"></a>01971             <span class="keywordflow">if</span>(isset($LastXPos)) {
<a name="l01972"></a>01972                 $Points   = array();
<a name="l01973"></a>01973                 $Points[] = $LastXPos;
<a name="l01974"></a>01974                 $Points[] = $LastYPos1;
<a name="l01975"></a>01975                 $Points[] = $LastXPos;
<a name="l01976"></a>01976                 $Points[] = $LastYPos2;
<a name="l01977"></a>01977                 $Points[] = $XPos;
<a name="l01978"></a>01978                 $Points[] = $YPos2;
<a name="l01979"></a>01979                 $Points[] = $XPos;
<a name="l01980"></a>01980                 $Points[] = $YPos1;
<a name="l01981"></a>01981 
<a name="l01982"></a>01982                 imagefilledpolygon($this-&gt;Layers[0], $Points, 4, $C_Graph);
<a name="l01983"></a>01983             }
<a name="l01984"></a>01984 
<a name="l01985"></a>01985             $LastYPos1 = $YPos1;
<a name="l01986"></a>01986             $LastYPos2 = $YPos2;
<a name="l01987"></a>01987             $LastXPos  = $XPos;
<a name="l01988"></a>01988 
<a name="l01989"></a>01989             $XPos += $this-&gt;DivisionWidth;
<a name="l01990"></a>01990         }
<a name="l01991"></a>01991 
<a name="l01992"></a>01992         imagecopymerge($this-&gt;Picture, $this-&gt;Layers[0], $this-&gt;GArea_X1, $this-&gt;GArea_Y1, 0, 0, $LayerWidth, $LayerHeight, $Alpha);
<a name="l01993"></a>01993         imagedestroy($this-&gt;Layers[0]);
<a name="l01994"></a>01994     }
<a name="l01995"></a>01995 
<a name="l01996"></a>01996 
<a name="l02004"></a><a class="code" href="classmt_chart.html#57695ecd6efdf7eaaa25e97e6f553bf7">02004</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#57695ecd6efdf7eaaa25e97e6f553bf7">writeValues</a>($Series = <span class="stringliteral">'Serie1'</span>) {
<a name="l02005"></a>02005         $this-&gt;validateDataDescription(<span class="stringliteral">'writeValues'</span>);
<a name="l02006"></a>02006         $this-&gt;validateData(<span class="stringliteral">'writeValues'</span>);
<a name="l02007"></a>02007 
<a name="l02008"></a>02008         <span class="keywordflow">if</span>(!is_array($Series)) {
<a name="l02009"></a>02009             $Series = array($Series);
<a name="l02010"></a>02010         }
<a name="l02011"></a>02011 
<a name="l02012"></a>02012         <span class="keywordflow">foreach</span>($Series as $Key =&gt; $Serie) {
<a name="l02013"></a>02013             $ID = 0;
<a name="l02014"></a>02014             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $keyI =&gt; $ValueI) {
<a name="l02015"></a>02015                 <span class="keywordflow">if</span>($keyI == $Serie) {
<a name="l02016"></a>02016                     $ColorID = $ID;
<a name="l02017"></a>02017                 }
<a name="l02018"></a>02018                 ++$ID;
<a name="l02019"></a>02019             }
<a name="l02020"></a>02020 
<a name="l02021"></a>02021             $XPos  = $this-&gt;GArea_X1 + $this-&gt;GAreaXOffset;
<a name="l02022"></a>02022             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l02023"></a>02023                 <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$Serie]) &amp;&amp; is_numeric($this-&gt;Data[$Key][$Serie])) {
<a name="l02024"></a>02024                     $Value = $this-&gt;Data[$Key][$Serie];
<a name="l02025"></a>02025                     $YPos = $this-&gt;GArea_Y2 - (($Value-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02026"></a>02026 
<a name="l02027"></a>02027                     $Positions = imagettfbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Value));
<a name="l02028"></a>02028                     $Width  = $Positions[2] - $Positions[6];
<a name="l02029"></a>02029                     $XOffset = $XPos - ($Width / 2);
<a name="l02030"></a>02030                     $Height = $Positions[3] - $Positions[7];
<a name="l02031"></a>02031                     $YOffset = $YPos - 4;
<a name="l02032"></a>02032 
<a name="l02033"></a>02033                     $C_TextColor = $this-&gt;AllocateColor($this-&gt;Picture, $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>]);
<a name="l02034"></a>02034                     imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $XOffset, $YOffset, $C_TextColor, $this-&gt;FontName, utf8_decode($Value));
<a name="l02035"></a>02035                 }
<a name="l02036"></a>02036                 $XPos += $this-&gt;DivisionWidth;
<a name="l02037"></a>02037             }
<a name="l02038"></a>02038         }
<a name="l02039"></a>02039     }
<a name="l02040"></a>02040 
<a name="l02049"></a><a class="code" href="classmt_chart.html#3210238cfff3cda6f2ce6df99e085a5d">02049</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#3210238cfff3cda6f2ce6df99e085a5d">drawLineGraph</a>($SerieName = NULL) {
<a name="l02050"></a>02050         $this-&gt;validateDataDescription(<span class="stringliteral">'drawLineGraph'</span>);
<a name="l02051"></a>02051         $this-&gt;validateData(<span class="stringliteral">'drawLineGraph'</span>);
<a name="l02052"></a>02052 
<a name="l02053"></a>02053         $GraphID = 0;
<a name="l02054"></a>02054         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l02055"></a>02055             $ID = 0;
<a name="l02056"></a>02056             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $keyI =&gt; $ValueI) {
<a name="l02057"></a>02057                 <span class="keywordflow">if</span>($keyI == $ColName) {
<a name="l02058"></a>02058                     $ColorID = $ID;
<a name="l02059"></a>02059                 }
<a name="l02060"></a>02060                 ++$ID;
<a name="l02061"></a>02061             }
<a name="l02062"></a>02062 
<a name="l02063"></a>02063             <span class="keywordflow">if</span>(is_null($SerieName) || $SerieName == $ColName) {
<a name="l02064"></a>02064                 $XPos  = $this-&gt;GArea_X1 + $this-&gt;GAreaXOffset;
<a name="l02065"></a>02065                 $XLast = NULL;
<a name="l02066"></a>02066                 <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l02067"></a>02067                     <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l02068"></a>02068                         $Value = $this-&gt;Data[$Key][$ColName];
<a name="l02069"></a>02069                         $YPos = $this-&gt;GArea_Y2 - (($Value - $this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02070"></a>02070 
<a name="l02071"></a>02071                         <span class="comment">// Save to image map</span>
<a name="l02072"></a>02072                         <span class="keywordflow">if</span>($this-&gt;BuildMap) {
<a name="l02073"></a>02073                             $this-&gt;addToImageMap($XPos - 3, $YPos - 3, $XPos + 3, $YPos + 3, $this-&gt;DataDescription[<span class="stringliteral">'Description'</span>][$ColName], $this-&gt;Data[$Key][$ColName].$this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'Y'</span>], <span class="stringliteral">'Line'</span>);
<a name="l02074"></a>02074                         }
<a name="l02075"></a>02075 
<a name="l02076"></a>02076                         <span class="keywordflow">if</span>(!is_numeric($Value)) {
<a name="l02077"></a>02077                             $XLast = NULL;
<a name="l02078"></a>02078                         }
<a name="l02079"></a>02079 
<a name="l02080"></a>02080                         <span class="keywordflow">if</span>(isset($XLast)) {
<a name="l02081"></a>02081                             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XLast, $YLast, $XPos, $YPos, $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>], TRUE);
<a name="l02082"></a>02082                         }
<a name="l02083"></a>02083 
<a name="l02084"></a>02084                         $XLast = $XPos;
<a name="l02085"></a>02085                         $YLast = $YPos;
<a name="l02086"></a>02086                     }
<a name="l02087"></a>02087                     $XPos += $this-&gt;DivisionWidth;
<a name="l02088"></a>02088                 }
<a name="l02089"></a>02089                 ++$GraphID;
<a name="l02090"></a>02090             }
<a name="l02091"></a>02091         }
<a name="l02092"></a>02092     }
<a name="l02093"></a>02093 
<a name="l02101"></a><a class="code" href="classmt_chart.html#c45d49081ed48b3728e5f882f155ec88">02101</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#c45d49081ed48b3728e5f882f155ec88">drawXYGraph</a>($YSerieName, $XSerieName, $PaletteID = 0) {
<a name="l02102"></a>02102         $YLast = NULL;
<a name="l02103"></a>02103         $XLast = NULL;
<a name="l02104"></a>02104 
<a name="l02105"></a>02105         <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l02106"></a>02106             <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$YSerieName], $this-&gt;Data[$Key][$XSerieName])) {
<a name="l02107"></a>02107                 $X = $this-&gt;Data[$Key][$XSerieName];
<a name="l02108"></a>02108                 $Y = $this-&gt;Data[$Key][$YSerieName];
<a name="l02109"></a>02109 
<a name="l02110"></a>02110                 $Y = $this-&gt;GArea_Y2 - (($Y-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02111"></a>02111                 $X = $this-&gt;GArea_X1 + (($X-$this-&gt;VXMin) * $this-&gt;XDivisionRatio);
<a name="l02112"></a>02112 
<a name="l02113"></a>02113                 <span class="keywordflow">if</span>(isset($XLast, $YLast)) {
<a name="l02114"></a>02114                     $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XLast, $YLast, $X, $Y, $this-&gt;Palette[$PaletteID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$PaletteID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$PaletteID][<span class="charliteral">'B'</span>], TRUE);
<a name="l02115"></a>02115                 }
<a name="l02116"></a>02116 
<a name="l02117"></a>02117                 $XLast = $X;
<a name="l02118"></a>02118                 $YLast = $Y;
<a name="l02119"></a>02119             }
<a name="l02120"></a>02120         }
<a name="l02121"></a>02121     }
<a name="l02122"></a>02122 
<a name="l02132"></a><a class="code" href="classmt_chart.html#d6f7f29824f9fc993e713f150bc43a80">02132</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#d6f7f29824f9fc993e713f150bc43a80">drawCubicCurve</a>($Accuracy = 0.1, $SerieName = NULL) {
<a name="l02133"></a>02133         $this-&gt;validateDataDescription(<span class="stringliteral">'drawCubicCurve'</span>);
<a name="l02134"></a>02134         $this-&gt;validateData(<span class="stringliteral">'drawCubicCurve'</span>);
<a name="l02135"></a>02135 
<a name="l02136"></a>02136         $GraphID = 0;
<a name="l02137"></a>02137         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l02138"></a>02138             <span class="keywordflow">if</span>(is_null($SerieName) || $SerieName == $ColName) {
<a name="l02139"></a>02139                 $XIn = array();
<a name="l02140"></a>02140                 $YIn = array();
<a name="l02141"></a>02141                 $Yt = array();
<a name="l02142"></a>02142                 $U = array();
<a name="l02143"></a>02143                 $XIn[0] = 0;
<a name="l02144"></a>02144                 $YIn[0] = 0;
<a name="l02145"></a>02145 
<a name="l02146"></a>02146                 $ID = 0;
<a name="l02147"></a>02147                 <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $keyI =&gt; $ValueI) {
<a name="l02148"></a>02148                     <span class="keywordflow">if</span>($keyI == $ColName) {
<a name="l02149"></a>02149                         $ColorID = $ID;
<a name="l02150"></a>02150                     }
<a name="l02151"></a>02151                     ++$ID;
<a name="l02152"></a>02152                 }
<a name="l02153"></a>02153 
<a name="l02154"></a>02154                 $Index = 1;
<a name="l02155"></a>02155                 $XLast = NULL;
<a name="l02156"></a>02156                 $Missing = array();
<a name="l02157"></a>02157                 <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l02158"></a>02158                     <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l02159"></a>02159                         $Value = $this-&gt;Data[$Key][$ColName];
<a name="l02160"></a>02160                         $XIn[$Index] = $Index;
<a name="l02161"></a>02161                         $YIn[$Index] = $Value;
<a name="l02162"></a>02162                         <span class="keywordflow">if</span>(!is_numeric($Value)) {
<a name="l02163"></a>02163                             $Missing[$Index] = TRUE;
<a name="l02164"></a>02164                         }
<a name="l02165"></a>02165                         ++$Index;
<a name="l02166"></a>02166                     }
<a name="l02167"></a>02167                 }
<a name="l02168"></a>02168                 --$Index;
<a name="l02169"></a>02169 
<a name="l02170"></a>02170                 $Yt[0] = 0;
<a name="l02171"></a>02171                 $Yt[1] = 0;
<a name="l02172"></a>02172                 $U[1]  = 0;
<a name="l02173"></a>02173                 <span class="keywordflow">for</span>($i = 2; $i &lt;= $Index - 1; ++$i) {
<a name="l02174"></a>02174                     $Sig    = ($XIn[$i] - $XIn[$i-1]) / ($XIn[$i+1] - $XIn[$i-1]);
<a name="l02175"></a>02175                     $p      = $Sig * $Yt[$i-1] + 2;
<a name="l02176"></a>02176                     $Yt[$i] = ($Sig - 1) / $p;
<a name="l02177"></a>02177                     $U[$i]  = ($YIn[$i+1] - $YIn[$i]) / ($XIn[$i+1] - $XIn[$i]) - ($YIn[$i] - $YIn[$i-1]) / ($XIn[$i] - $XIn[$i-1]);
<a name="l02178"></a>02178                     $U[$i]  = (6 * $U[$i] / ($XIn[$i+1] - $XIn[$i-1]) - $Sig * $U[$i-1]) / $p;
<a name="l02179"></a>02179                 }
<a name="l02180"></a>02180 
<a name="l02181"></a>02181                 $qn = 0;
<a name="l02182"></a>02182                 $un = 0;
<a name="l02183"></a>02183                 $Yt[$Index] = ($un - $qn * $U[$Index-1]) / ($qn * $Yt[$Index-1] + 1);
<a name="l02184"></a>02184 
<a name="l02185"></a>02185                 <span class="keywordflow">for</span>($k = $Index - 1; $k &gt;= 1; --$k) {
<a name="l02186"></a>02186                     $Yt[$k] = $Yt[$k] * $Yt[$k+1] + $U[$k];
<a name="l02187"></a>02187                 }
<a name="l02188"></a>02188 
<a name="l02189"></a>02189                 $XPos  = $this-&gt;GArea_X1 + $this-&gt;GAreaXOffset;
<a name="l02190"></a>02190                 <span class="keywordflow">for</span>($X = 1; $X &lt;= $Index; $X += $Accuracy) {
<a name="l02191"></a>02191                     $klo = 1;
<a name="l02192"></a>02192                     $khi = $Index;
<a name="l02193"></a>02193                     $k   = $khi - $klo;
<a name="l02194"></a>02194                     <span class="keywordflow">while</span>($k &gt; 1) {
<a name="l02195"></a>02195                         $k = $khi - $klo;
<a name="l02196"></a>02196                         <span class="keywordflow">if</span>($XIn[$k] &gt;= $X) {
<a name="l02197"></a>02197                             $khi = $k;
<a name="l02198"></a>02198                         } <span class="keywordflow">else</span> {
<a name="l02199"></a>02199                             $klo = $k;
<a name="l02200"></a>02200                         }
<a name="l02201"></a>02201                     }
<a name="l02202"></a>02202                     $klo = $khi - 1;
<a name="l02203"></a>02203 
<a name="l02204"></a>02204                     $h     = $XIn[$khi] - $XIn[$klo];
<a name="l02205"></a>02205                     $a     = ($XIn[$khi] - $X) / $h;
<a name="l02206"></a>02206                     $b     = ($X - $XIn[$klo]) / $h;
<a name="l02207"></a>02207                     $Value = $a * $YIn[$klo] + $b * $YIn[$khi] + (($a*$a*$a - $a) * $Yt[$klo] + ($b*$b*$b - $b) * $Yt[$khi]) * ($h*$h) / 6;
<a name="l02208"></a>02208 
<a name="l02209"></a>02209                     $YPos = $this-&gt;GArea_Y2 - (($Value-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02210"></a>02210 
<a name="l02211"></a>02211                     <span class="keywordflow">if</span>(isset($XLast) &amp;&amp; !isset($Missing[floor($X)]) &amp;&amp; !isset($Missing[floor($X+1)])) {
<a name="l02212"></a>02212                         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XLast, $YLast, $XPos, $YPos, $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>], TRUE);
<a name="l02213"></a>02213                     }
<a name="l02214"></a>02214 
<a name="l02215"></a>02215                     $XLast = $XPos;
<a name="l02216"></a>02216                     $YLast = $YPos;
<a name="l02217"></a>02217                     $XPos  = $XPos + $this-&gt;DivisionWidth * $Accuracy;
<a name="l02218"></a>02218                 }
<a name="l02219"></a>02219 
<a name="l02220"></a>02220                 <span class="comment">// Add potentialy missing values</span>
<a name="l02221"></a>02221                 $XPos  = $XPos - $this-&gt;DivisionWidth * $Accuracy;
<a name="l02222"></a>02222                 <span class="keywordflow">if</span>($XPos &lt; ($this-&gt;GArea_X2 - $this-&gt;GAreaXOffset)) {
<a name="l02223"></a>02223                     $YPos = $this-&gt;GArea_Y2 - (($YIn[$Index] - $this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02224"></a>02224                     $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XLast, $YLast, $this-&gt;GArea_X2 - $this-&gt;GAreaXOffset, $YPos, $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>], TRUE);
<a name="l02225"></a>02225                 }
<a name="l02226"></a>02226 
<a name="l02227"></a>02227                 ++$GraphID;
<a name="l02228"></a>02228             }
<a name="l02229"></a>02229         }
<a name="l02230"></a>02230     }
<a name="l02231"></a>02231 
<a name="l02239"></a><a class="code" href="classmt_chart.html#367bd739cde5ead5328cb188aba8b722">02239</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#367bd739cde5ead5328cb188aba8b722">drawFilledCubicCurve</a>($Accuracy = 0.1, $Alpha = 100, $AroundZero = FALSE) {
<a name="l02240"></a>02240         $this-&gt;validateDataDescription(<span class="stringliteral">'drawFilledCubicCurve'</span>);
<a name="l02241"></a>02241         $this-&gt;validateData(<span class="stringliteral">'drawFilledCubicCurve'</span>);
<a name="l02242"></a>02242 
<a name="l02243"></a>02243         $LayerWidth  = $this-&gt;GArea_X2 - $this-&gt;GArea_X1;
<a name="l02244"></a>02244         $LayerHeight = $this-&gt;GArea_Y2 - $this-&gt;GArea_Y1;
<a name="l02245"></a>02245         $YZero = $LayerHeight - ((0 - $this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02246"></a>02246 
<a name="l02247"></a>02247         <span class="keywordflow">if</span>($YZero &gt; $LayerHeight) {
<a name="l02248"></a>02248             $YZero = $LayerHeight;
<a name="l02249"></a>02249         }
<a name="l02250"></a>02250 
<a name="l02251"></a>02251         $GraphID = 0;
<a name="l02252"></a>02252         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l02253"></a>02253             $XIn = array();
<a name="l02254"></a>02254             $Yin = array();
<a name="l02255"></a>02255             $Yt = array();
<a name="l02256"></a>02256             $U = array();
<a name="l02257"></a>02257             $XIn[0] = 0;
<a name="l02258"></a>02258             $YIn[0] = 0;
<a name="l02259"></a>02259 
<a name="l02260"></a>02260             $ID = 0;
<a name="l02261"></a>02261             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $keyI =&gt; $ValueI) {
<a name="l02262"></a>02262                 <span class="keywordflow">if</span>($keyI == $ColName) {
<a name="l02263"></a>02263                     $ColorID = $ID;
<a name="l02264"></a>02264                 }
<a name="l02265"></a>02265                 ++$ID;
<a name="l02266"></a>02266             }
<a name="l02267"></a>02267 
<a name="l02268"></a>02268             $Index = 1;
<a name="l02269"></a>02269             $XLast = NULL;
<a name="l02270"></a>02270             $Missing = array();
<a name="l02271"></a>02271 
<a name="l02272"></a>02272             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l02273"></a>02273                 $Value = $this-&gt;Data[$Key][$ColName];
<a name="l02274"></a>02274                 $XIn[$Index] = $Index;
<a name="l02275"></a>02275                 $YIn[$Index] = $Value;
<a name="l02276"></a>02276                 <span class="keywordflow">if</span>(!is_numeric($Value)) {
<a name="l02277"></a>02277                     $Missing[$Index] = TRUE;
<a name="l02278"></a>02278                 }
<a name="l02279"></a>02279                 ++$Index;
<a name="l02280"></a>02280             }
<a name="l02281"></a>02281             --$Index;
<a name="l02282"></a>02282 
<a name="l02283"></a>02283             $Yt[0] = 0;
<a name="l02284"></a>02284             $Yt[1] = 0;
<a name="l02285"></a>02285             $U[1]  = 0;
<a name="l02286"></a>02286             <span class="keywordflow">for</span>($i = 2; $i &lt;= $Index - 1; ++$i) {
<a name="l02287"></a>02287                 $Sig    = ($XIn[$i] - $XIn[$i-1]) / ($XIn[$i+1] - $XIn[$i-1]);
<a name="l02288"></a>02288                 $p      = $Sig * $Yt[$i-1] + 2;
<a name="l02289"></a>02289                 $Yt[$i] = ($Sig - 1) / $p;
<a name="l02290"></a>02290                 $U[$i]  = ($YIn[$i+1] - $YIn[$i]) / ($XIn[$i+1] - $XIn[$i]) - ($YIn[$i] - $YIn[$i-1]) / ($XIn[$i] - $XIn[$i-1]);
<a name="l02291"></a>02291                 $U[$i]  = (6 * $U[$i] / ($XIn[$i+1] - $XIn[$i-1]) - $Sig * $U[$i-1]) / $p;
<a name="l02292"></a>02292             }
<a name="l02293"></a>02293 
<a name="l02294"></a>02294             $qn = 0;
<a name="l02295"></a>02295             $un = 0;
<a name="l02296"></a>02296             $Yt[$Index] = ($un - $qn * $U[$Index-1]) / ($qn * $Yt[$Index-1] + 1);
<a name="l02297"></a>02297 
<a name="l02298"></a>02298             <span class="keywordflow">for</span>($k = $Index - 1; $k &gt;= 1; --$k) {
<a name="l02299"></a>02299                 $Yt[$k] = $Yt[$k] * $Yt[$k+1] + $U[$k];
<a name="l02300"></a>02300             }
<a name="l02301"></a>02301 
<a name="l02302"></a>02302             $Points   = array();
<a name="l02303"></a>02303             $Points[] = $this-&gt;GAreaXOffset;
<a name="l02304"></a>02304             $Points[] = $LayerHeight;
<a name="l02305"></a>02305 
<a name="l02306"></a>02306             $this-&gt;Layers[0] = imagecreatetruecolor($LayerWidth, $LayerHeight);
<a name="l02307"></a>02307             $C_White         = $this-&gt;AllocateColor($this-&gt;Layers[0], 255, 255, 255);
<a name="l02308"></a>02308             imagefilledrectangle($this-&gt;Layers[0], 0, 0, $LayerWidth, $LayerHeight, $C_White);
<a name="l02309"></a>02309             imagecolortransparent($this-&gt;Layers[0], $C_White);
<a name="l02310"></a>02310 
<a name="l02311"></a>02311             $YLast = NULL;
<a name="l02312"></a>02312             $XPos  = $this-&gt;GAreaXOffset;
<a name="l02313"></a>02313             $PointsCount = 2;
<a name="l02314"></a>02314             <span class="keywordflow">for</span>($X = 1; $X &lt;= $Index; $X += $Accuracy) {
<a name="l02315"></a>02315                 $klo = 1;
<a name="l02316"></a>02316                 $khi = $Index;
<a name="l02317"></a>02317                 $k   = $khi - $klo;
<a name="l02318"></a>02318                 <span class="keywordflow">while</span>($k &gt; 1) {
<a name="l02319"></a>02319                     $k = $khi - $klo;
<a name="l02320"></a>02320                     <span class="keywordflow">if</span>($XIn[$k] &gt;= $X) {
<a name="l02321"></a>02321                         $khi = $k;
<a name="l02322"></a>02322                     } <span class="keywordflow">else</span> {
<a name="l02323"></a>02323                         $klo = $k;
<a name="l02324"></a>02324                     }
<a name="l02325"></a>02325                 }
<a name="l02326"></a>02326                 $klo = $khi - 1;
<a name="l02327"></a>02327 
<a name="l02328"></a>02328                 $h     = $XIn[$khi] - $XIn[$klo];
<a name="l02329"></a>02329                 $a     = ($XIn[$khi] - $X) / $h;
<a name="l02330"></a>02330                 $b     = ($X - $XIn[$klo]) / $h;
<a name="l02331"></a>02331                 $Value = $a * $YIn[$klo] + $b * $YIn[$khi] + (($a*$a*$a - $a) * $Yt[$klo] + ($b*$b*$b - $b) * $Yt[$khi]) * ($h*$h) / 6;
<a name="l02332"></a>02332 
<a name="l02333"></a>02333                 $YPos = $LayerHeight - (($Value-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02334"></a>02334 
<a name="l02335"></a>02335                 <span class="keywordflow">if</span>(isset($YLast) &amp;&amp; $AroundZero &amp;&amp; !isset($Missing[floor($X)]) &amp;&amp; !isset($Missing[floor($X+1)])) {
<a name="l02336"></a>02336                     $aPoints   = array();
<a name="l02337"></a>02337                     $aPoints[] = $XLast;
<a name="l02338"></a>02338                     $aPoints[] = $YLast;
<a name="l02339"></a>02339                     $aPoints[] = $XPos;
<a name="l02340"></a>02340                     $aPoints[] = $YPos;
<a name="l02341"></a>02341                     $aPoints[] = $XPos;
<a name="l02342"></a>02342                     $aPoints[] = $YZero;
<a name="l02343"></a>02343                     $aPoints[] = $XLast;
<a name="l02344"></a>02344                     $aPoints[] = $YZero;
<a name="l02345"></a>02345 
<a name="l02346"></a>02346                     $C_Graph = $this-&gt;AllocateColor($this-&gt;Layers[0], $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>]);
<a name="l02347"></a>02347                     imagefilledpolygon($this-&gt;Layers[0], $aPoints, 4, $C_Graph);
<a name="l02348"></a>02348                 }
<a name="l02349"></a>02349 
<a name="l02350"></a>02350                 <span class="keywordflow">if</span>(!isset($Missing[floor($X)]) || $YLast == NULL) {
<a name="l02351"></a>02351                     ++$PointsCount;
<a name="l02352"></a>02352                     $Points[] = $XPos;
<a name="l02353"></a>02353                     $Points[] = $YPos;
<a name="l02354"></a>02354                 } <span class="keywordflow">else</span> {
<a name="l02355"></a>02355                     ++$PointsCount;
<a name="l02356"></a>02356                     $Points[] = $XLast;
<a name="l02357"></a>02357                     $Points[] = $LayerHeight;
<a name="l02358"></a>02358                 }
<a name="l02359"></a>02359 
<a name="l02360"></a>02360                 $YLast = $YPos;
<a name="l02361"></a>02361                 $XLast = $XPos;
<a name="l02362"></a>02362                 $XPos  += $this-&gt;DivisionWidth * $Accuracy;
<a name="l02363"></a>02363             }
<a name="l02364"></a>02364 
<a name="l02365"></a>02365             <span class="comment">// Add potentialy missing values</span>
<a name="l02366"></a>02366             $XPos  -= $this-&gt;DivisionWidth * $Accuracy;
<a name="l02367"></a>02367             <span class="keywordflow">if</span>($XPos &lt; ($LayerWidth-$this-&gt;GAreaXOffset)) {
<a name="l02368"></a>02368                 $YPos = $LayerHeight - (($YIn[$Index]-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02369"></a>02369 
<a name="l02370"></a>02370                 <span class="keywordflow">if</span>(isset($YLast) &amp;&amp; $AroundZero) {
<a name="l02371"></a>02371                     $aPoints   = array();
<a name="l02372"></a>02372                     $aPoints[] = $XLast;
<a name="l02373"></a>02373                     $aPoints[] = $YLast;
<a name="l02374"></a>02374                     $aPoints[] = $LayerWidth - $this-&gt;GAreaXOffset;
<a name="l02375"></a>02375                     $aPoints[] = $YPos;
<a name="l02376"></a>02376                     $aPoints[] = $LayerWidth - $this-&gt;GAreaXOffset;
<a name="l02377"></a>02377                     $aPoints[] = $YZero;
<a name="l02378"></a>02378                     $aPoints[] = $XLast;
<a name="l02379"></a>02379                     $aPoints[] = $YZero;
<a name="l02380"></a>02380 
<a name="l02381"></a>02381                     $C_Graph = $this-&gt;AllocateColor($this-&gt;Layers[0], $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>]);
<a name="l02382"></a>02382                     imagefilledpolygon($this-&gt;Layers[0], $aPoints, 4, $C_Graph);
<a name="l02383"></a>02383                 }
<a name="l02384"></a>02384 
<a name="l02385"></a>02385                 <span class="keywordflow">if</span>(isset($YIn[$klo], $YIn[$khi]) || $YLast == NULL) {
<a name="l02386"></a>02386                     ++$PointsCount;
<a name="l02387"></a>02387                     $Points[] = $LayerWidth  - $this-&gt;GAreaXOffset;
<a name="l02388"></a>02388                     $Points[] = $YPos;
<a name="l02389"></a>02389                 }
<a name="l02390"></a>02390             }
<a name="l02391"></a>02391 
<a name="l02392"></a>02392             $Points[] = $LayerWidth - $this-&gt;GAreaXOffset;
<a name="l02393"></a>02393             $Points[] = $LayerHeight;
<a name="l02394"></a>02394 
<a name="l02395"></a>02395             <span class="keywordflow">if</span>(!$AroundZero) {
<a name="l02396"></a>02396                 $C_Graph = $this-&gt;AllocateColor($this-&gt;Layers[0], $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>]);
<a name="l02397"></a>02397                 imagefilledpolygon($this-&gt;Layers[0], $Points, $PointsCount, $C_Graph);
<a name="l02398"></a>02398             }
<a name="l02399"></a>02399 
<a name="l02400"></a>02400             imagecopymerge($this-&gt;Picture, $this-&gt;Layers[0], $this-&gt;GArea_X1, $this-&gt;GArea_Y1, 0, 0, $LayerWidth, $LayerHeight, $Alpha);
<a name="l02401"></a>02401             imagedestroy($this-&gt;Layers[0]);
<a name="l02402"></a>02402 
<a name="l02403"></a>02403             $this-&gt;<a class="code" href="classmt_chart.html#d6f7f29824f9fc993e713f150bc43a80">drawCubicCurve</a>($this-&gt;Data, $this-&gt;DataDescription, $Accuracy, $ColName);
<a name="l02404"></a>02404 
<a name="l02405"></a>02405             ++$GraphID;
<a name="l02406"></a>02406         }
<a name="l02407"></a>02407     }
<a name="l02408"></a>02408 
<a name="l02415"></a><a class="code" href="classmt_chart.html#f90296172efe3367e458a5097cfff685">02415</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#f90296172efe3367e458a5097cfff685">drawFilledLineGraph</a>($Alpha = 100, $AroundZero = FALSE) {
<a name="l02416"></a>02416         $this-&gt;validateDataDescription(<span class="stringliteral">'drawFilledLineGraph'</span>);
<a name="l02417"></a>02417         $this-&gt;validateData(<span class="stringliteral">'drawFilledLineGraph'</span>);
<a name="l02418"></a>02418 
<a name="l02419"></a>02419         $LayerWidth  = $this-&gt;GArea_X2-$this-&gt;GArea_X1;
<a name="l02420"></a>02420         $LayerHeight = $this-&gt;GArea_Y2-$this-&gt;GArea_Y1;
<a name="l02421"></a>02421 
<a name="l02422"></a>02422         $GraphID = 0;
<a name="l02423"></a>02423         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l02424"></a>02424             $ID = 0;
<a name="l02425"></a>02425             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $keyI =&gt; $ValueI) {
<a name="l02426"></a>02426                 <span class="keywordflow">if</span>($keyI == $ColName) {
<a name="l02427"></a>02427                     $ColorID = $ID;
<a name="l02428"></a>02428                 }
<a name="l02429"></a>02429                 ++$ID;
<a name="l02430"></a>02430             }
<a name="l02431"></a>02431 
<a name="l02432"></a>02432             $aPoints   = array();
<a name="l02433"></a>02433             $aPoints[] = $this-&gt;GAreaXOffset;
<a name="l02434"></a>02434             $aPoints[] = $LayerHeight;
<a name="l02435"></a>02435 
<a name="l02436"></a>02436             $this-&gt;Layers[0] = imagecreatetruecolor($LayerWidth, $LayerHeight);
<a name="l02437"></a>02437             $C_White = $this-&gt;AllocateColor($this-&gt;Layers[0], 255, 255, 255);
<a name="l02438"></a>02438             imagefilledrectangle($this-&gt;Layers[0], 0, 0, $LayerWidth, $LayerHeight, $C_White);
<a name="l02439"></a>02439             imagecolortransparent($this-&gt;Layers[0], $C_White);
<a name="l02440"></a>02440 
<a name="l02441"></a>02441             $XPos  = $this-&gt;GAreaXOffset;
<a name="l02442"></a>02442             $XLast = NULL;
<a name="l02443"></a>02443             $PointsCount = 2;
<a name="l02444"></a>02444             $YZero = $LayerHeight - ((0-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02445"></a>02445 
<a name="l02446"></a>02446             <span class="keywordflow">if</span>($YZero &gt; $LayerHeight) {
<a name="l02447"></a>02447                 $YZero = $LayerHeight;
<a name="l02448"></a>02448             }
<a name="l02449"></a>02449 
<a name="l02450"></a>02450             $YLast = NULL;
<a name="l02451"></a>02451             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l02452"></a>02452                 $Value = $this-&gt;Data[$Key][$ColName];
<a name="l02453"></a>02453                 $YPos = $LayerHeight - (($Value-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02454"></a>02454 
<a name="l02455"></a>02455                 <span class="comment">// Save point to image map if necessary</span>
<a name="l02456"></a>02456                 <span class="keywordflow">if</span>($this-&gt;BuildMap) {
<a name="l02457"></a>02457                     $this-&gt;addToImageMap($XPos - 3, $YPos - 3, $XPos + 3, $YPos + 3, $this-&gt;DataDescription[<span class="stringliteral">'Description'</span>][$ColName], $this-&gt;Data[$Key][$ColName].$this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'Y'</span>], <span class="stringliteral">'FLine'</span>);
<a name="l02458"></a>02458                 }
<a name="l02459"></a>02459 
<a name="l02460"></a>02460                 <span class="keywordflow">if</span>(!is_numeric($Value)) {
<a name="l02461"></a>02461                     ++$PointsCount;
<a name="l02462"></a>02462                     $aPoints[] = $XLast;
<a name="l02463"></a>02463                     $aPoints[] = $LayerHeight;
<a name="l02464"></a>02464 
<a name="l02465"></a>02465                     $YLast = NULL;
<a name="l02466"></a>02466                 } <span class="keywordflow">else</span> {
<a name="l02467"></a>02467                     ++$PointsCount;
<a name="l02468"></a>02468                     <span class="keywordflow">if</span>(isset($YLast)) {
<a name="l02469"></a>02469                         $aPoints[] = $XPos;
<a name="l02470"></a>02470                         $aPoints[] = $YPos;
<a name="l02471"></a>02471                     } <span class="keywordflow">else</span> {
<a name="l02472"></a>02472                         ++$PointsCount;
<a name="l02473"></a>02473                         $aPoints[] = $XPos;
<a name="l02474"></a>02474                         $aPoints[] = $LayerHeight;
<a name="l02475"></a>02475                         $aPoints[] = $XPos;
<a name="l02476"></a>02476                         $aPoints[] = $YPos;
<a name="l02477"></a>02477                     }
<a name="l02478"></a>02478 
<a name="l02479"></a>02479                     <span class="keywordflow">if</span>(isset($YLast) &amp;&amp; $AroundZero) {
<a name="l02480"></a>02480                         $Points   = array();
<a name="l02481"></a>02481                         $Points[] = $XLast;
<a name="l02482"></a>02482                         $Points[] = $YLast;
<a name="l02483"></a>02483                         $Points[] = $XPos;
<a name="l02484"></a>02484                         $Points[] = $YPos;
<a name="l02485"></a>02485                         $Points[] = $XPos;
<a name="l02486"></a>02486                         $Points[] = $YZero;
<a name="l02487"></a>02487                         $Points[] = $XLast;
<a name="l02488"></a>02488                         $Points[] = $YZero;
<a name="l02489"></a>02489 
<a name="l02490"></a>02490                         $C_Graph = $this-&gt;AllocateColor($this-&gt;Layers[0], $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>]);
<a name="l02491"></a>02491                         imagefilledpolygon($this-&gt;Layers[0], $Points, 4, $C_Graph);
<a name="l02492"></a>02492                     }
<a name="l02493"></a>02493                     $YLast = $YPos;
<a name="l02494"></a>02494                 }
<a name="l02495"></a>02495 
<a name="l02496"></a>02496                 $XLast = $XPos;
<a name="l02497"></a>02497                 $XPos  = $XPos + $this-&gt;DivisionWidth;
<a name="l02498"></a>02498             }
<a name="l02499"></a>02499 
<a name="l02500"></a>02500             $aPoints[] = $LayerWidth - $this-&gt;GAreaXOffset;
<a name="l02501"></a>02501             $aPoints[] = $LayerHeight;
<a name="l02502"></a>02502 
<a name="l02503"></a>02503             <span class="keywordflow">if</span>(! $AroundZero) {
<a name="l02504"></a>02504                 $C_Graph = $this-&gt;AllocateColor($this-&gt;Layers[0], $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>]);
<a name="l02505"></a>02505                 imagefilledpolygon($this-&gt;Layers[0], $aPoints, $PointsCount, $C_Graph);
<a name="l02506"></a>02506             }
<a name="l02507"></a>02507 
<a name="l02508"></a>02508             imagecopymerge($this-&gt;Picture, $this-&gt;Layers[0], $this-&gt;GArea_X1, $this-&gt;GArea_Y1, 0, 0, $LayerWidth, $LayerHeight, $Alpha);
<a name="l02509"></a>02509             imagedestroy($this-&gt;Layers[0]);
<a name="l02510"></a>02510             ++$GraphID;
<a name="l02511"></a>02511             $this-&gt;<a class="code" href="classmt_chart.html#3210238cfff3cda6f2ce6df99e085a5d">drawLineGraph</a>($this-&gt;Data, $this-&gt;DataDescription, $ColName);
<a name="l02512"></a>02512         }
<a name="l02513"></a>02513     }
<a name="l02514"></a>02514 
<a name="l02520"></a><a class="code" href="classmt_chart.html#ef1155e950f6ca18a51c683179684583">02520</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#ef1155e950f6ca18a51c683179684583">drawOverlayBarGraph</a>($Alpha = 50) {
<a name="l02521"></a>02521         $this-&gt;validateDataDescription(<span class="stringliteral">'drawOverlayBarGraph'</span>);
<a name="l02522"></a>02522         $this-&gt;validateData(<span class="stringliteral">'drawOverlayBarGraph'</span>);
<a name="l02523"></a>02523 
<a name="l02524"></a>02524         $LayerWidth  = $this-&gt;GArea_X2 - $this-&gt;GArea_X1;
<a name="l02525"></a>02525         $LayerHeight = $this-&gt;GArea_Y2 - $this-&gt;GArea_Y1;
<a name="l02526"></a>02526 
<a name="l02527"></a>02527         $GraphID = 0;
<a name="l02528"></a>02528         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l02529"></a>02529             $ID = 0;
<a name="l02530"></a>02530             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $keyI =&gt; $ValueI) {
<a name="l02531"></a>02531                 <span class="keywordflow">if</span>($keyI == $ColName) {
<a name="l02532"></a>02532                     $ColorID = $ID;
<a name="l02533"></a>02533                 }
<a name="l02534"></a>02534                 ++$ID;
<a name="l02535"></a>02535             }
<a name="l02536"></a>02536 
<a name="l02537"></a>02537             $this-&gt;Layers[$GraphID] = imagecreatetruecolor($LayerWidth, $LayerHeight);
<a name="l02538"></a>02538             $C_White                = $this-&gt;AllocateColor($this-&gt;Layers[$GraphID], 255, 255, 255);
<a name="l02539"></a>02539             $C_Graph                = $this-&gt;AllocateColor($this-&gt;Layers[$GraphID], $this-&gt;Palette[$GraphID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$GraphID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$GraphID][<span class="charliteral">'B'</span>]);
<a name="l02540"></a>02540             imagefilledrectangle($this-&gt;Layers[$GraphID], 0, 0, $LayerWidth, $LayerHeight, $C_White);
<a name="l02541"></a>02541             imagecolortransparent($this-&gt;Layers[$GraphID], $C_White);
<a name="l02542"></a>02542 
<a name="l02543"></a>02543             $XWidth = $this-&gt;DivisionWidth / 4;
<a name="l02544"></a>02544             $XPos   = $this-&gt;GAreaXOffset;
<a name="l02545"></a>02545             $YZero  = $LayerHeight - ((0-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02546"></a>02546             $XLast  = NULL;
<a name="l02547"></a>02547             $PointsCount = 2;
<a name="l02548"></a>02548             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l02549"></a>02549                 <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l02550"></a>02550                     $Value = $this-&gt;Data[$Key][$ColName];
<a name="l02551"></a>02551                     <span class="keywordflow">if</span>(is_numeric($Value)) {
<a name="l02552"></a>02552                         $YPos  = $LayerHeight - (($Value-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02553"></a>02553 
<a name="l02554"></a>02554                         imagefilledrectangle($this-&gt;Layers[$GraphID], $XPos - $XWidth, $YPos, $XPos + $XWidth, $YZero, $C_Graph);
<a name="l02555"></a>02555 
<a name="l02556"></a>02556                         $X1 = floor($XPos - $XWidth + $this-&gt;GArea_X1);
<a name="l02557"></a>02557                         $Y1 = floor($YPos+$this-&gt;GArea_Y1) + 0.2;
<a name="l02558"></a>02558                         $X2 = floor($XPos + $XWidth + $this-&gt;GArea_X1);
<a name="l02559"></a>02559                         $Y2 = $this-&gt;GArea_Y2 - ((0 - $this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02560"></a>02560                         <span class="keywordflow">if</span>($X1 &lt;= $this-&gt;GArea_X1) {
<a name="l02561"></a>02561                             $X1 = $this-&gt;GArea_X1 + 1;
<a name="l02562"></a>02562                         }
<a name="l02563"></a>02563                         <span class="keywordflow">if</span>($X2 &gt;= $this-&gt;GArea_X2) {
<a name="l02564"></a>02564                             $X2 = $this-&gt;GArea_X2 - 1;
<a name="l02565"></a>02565                         }
<a name="l02566"></a>02566 
<a name="l02567"></a>02567                         <span class="comment">// Save point to image map if necessary</span>
<a name="l02568"></a>02568                         <span class="keywordflow">if</span>($this-&gt;BuildMap) {
<a name="l02569"></a>02569                             $this-&gt;addToImageMap($X1, min($Y1, $Y2), $X2, max($Y1, $Y2), $this-&gt;DataDescription[<span class="stringliteral">'Description'</span>][$ColName], $this-&gt;Data[$Key][$ColName].$this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'Y'</span>], <span class="stringliteral">'oBar'</span>);
<a name="l02570"></a>02570                         }
<a name="l02571"></a>02571 
<a name="l02572"></a>02572                         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X1, $Y1, $X2, $Y1, $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>], TRUE);
<a name="l02573"></a>02573                     }
<a name="l02574"></a>02574                 }
<a name="l02575"></a>02575                 $XPos += $this-&gt;DivisionWidth;
<a name="l02576"></a>02576             }
<a name="l02577"></a>02577 
<a name="l02578"></a>02578             ++$GraphID;
<a name="l02579"></a>02579         }
<a name="l02580"></a>02580 
<a name="l02581"></a>02581         <span class="keywordflow">for</span>($i = 0; $i &lt;= ($GraphID - 1); ++$i) {
<a name="l02582"></a>02582             imagecopymerge($this-&gt;Picture, $this-&gt;Layers[$i], $this-&gt;GArea_X1, $this-&gt;GArea_Y1, 0, 0, $LayerWidth, $LayerHeight, $Alpha);
<a name="l02583"></a>02583             imagedestroy($this-&gt;Layers[$i]);
<a name="l02584"></a>02584         }
<a name="l02585"></a>02585     }
<a name="l02586"></a>02586 
<a name="l02593"></a><a class="code" href="classmt_chart.html#c0462556af8405deffca904c1b2093a1">02593</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#c0462556af8405deffca904c1b2093a1">drawBarGraph</a>($Shadow = FALSE, $Alpha = 100) {
<a name="l02594"></a>02594         $this-&gt;validateDataDescription(<span class="stringliteral">'drawBarGraph'</span>);
<a name="l02595"></a>02595         $this-&gt;validateData(<span class="stringliteral">'drawBarGraph'</span>);
<a name="l02596"></a>02596 
<a name="l02597"></a>02597         $GraphID      = 0;
<a name="l02598"></a>02598         $Series       = count($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>]);
<a name="l02599"></a>02599         $SeriesWidth  = $this-&gt;DivisionWidth / ($Series + 1);
<a name="l02600"></a>02600         $SerieXOffset = $this-&gt;DivisionWidth / 2 - $SeriesWidth / 2;
<a name="l02601"></a>02601 
<a name="l02602"></a>02602         $YZero  = $this-&gt;GArea_Y2 - ((0-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02603"></a>02603         <span class="keywordflow">if</span>($YZero &gt; $this-&gt;GArea_Y2) {
<a name="l02604"></a>02604             $YZero = $this-&gt;GArea_Y2;
<a name="l02605"></a>02605         }
<a name="l02606"></a>02606 
<a name="l02607"></a>02607         $SerieID = 0;
<a name="l02608"></a>02608         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l02609"></a>02609             $ID = 0;
<a name="l02610"></a>02610             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $keyI =&gt; $ValueI) {
<a name="l02611"></a>02611                 <span class="keywordflow">if</span>($keyI == $ColName) {
<a name="l02612"></a>02612                     $ColorID = $ID;
<a name="l02613"></a>02613                 }
<a name="l02614"></a>02614                 ++$ID;
<a name="l02615"></a>02615             }
<a name="l02616"></a>02616 
<a name="l02617"></a>02617             $XPos  = $this-&gt;GArea_X1 + $this-&gt;GAreaXOffset - $SerieXOffset + $SeriesWidth * $SerieID;
<a name="l02618"></a>02618             $XLast = NULL;
<a name="l02619"></a>02619             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l02620"></a>02620                 <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l02621"></a>02621                     <span class="keywordflow">if</span>(is_numeric($this-&gt;Data[$Key][$ColName])) {
<a name="l02622"></a>02622                         $Value = $this-&gt;Data[$Key][$ColName];
<a name="l02623"></a>02623                         $YPos = $this-&gt;GArea_Y2 - (($Value-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02624"></a>02624 
<a name="l02625"></a>02625                         <span class="comment">// Save point to image map if necessary</span>
<a name="l02626"></a>02626                         <span class="keywordflow">if</span>($this-&gt;BuildMap)
<a name="l02627"></a>02627                         {
<a name="l02628"></a>02628                             $this-&gt;addToImageMap($XPos+1,min($YZero, $YPos), $XPos+$SeriesWidth-1,max($YZero, $YPos), $this-&gt;DataDescription[<span class="stringliteral">'Description'</span>][$ColName], $this-&gt;Data[$Key][$ColName].$this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'Y'</span>],<span class="stringliteral">'Bar'</span>);
<a name="l02629"></a>02629                         }
<a name="l02630"></a>02630 
<a name="l02631"></a>02631                         <span class="keywordflow">if</span>($Shadow &amp;&amp; $Alpha == 100) {
<a name="l02632"></a>02632                             $this-&gt;<a class="code" href="classmt_chart.html#616537ed8f9f5b76ce8cd7c19c07eecc">drawRectangle</a>($XPos + 1, $YZero, $XPos + $SeriesWidth - 1, $YPos, 25, 25, 25, TRUE, $Alpha);
<a name="l02633"></a>02633                         }
<a name="l02634"></a>02634 
<a name="l02635"></a>02635                         $this-&gt;<a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">drawFilledRectangle</a>($XPos + 1, $YZero, $XPos+$SeriesWidth - 1, $YPos, $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>], TRUE, $Alpha);
<a name="l02636"></a>02636                     }
<a name="l02637"></a>02637                 }
<a name="l02638"></a>02638                 $XPos += $this-&gt;DivisionWidth;
<a name="l02639"></a>02639             }
<a name="l02640"></a>02640             ++$SerieID;
<a name="l02641"></a>02641         }
<a name="l02642"></a>02642     }
<a name="l02643"></a>02643 
<a name="l02655"></a><a class="code" href="classmt_chart.html#8fce1a6c53288f58e8d48754535d79c8">02655</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#8fce1a6c53288f58e8d48754535d79c8">drawStackedBarGraph</a>($Alpha = 50, $Continuous = FALSE, $widthPercentage = 80) {
<a name="l02656"></a>02656         $this-&gt;validateDataDescription(<span class="stringliteral">'drawBarGraph'</span>);
<a name="l02657"></a>02657         $this-&gt;validateData(<span class="stringliteral">'drawBarGraph'</span>);
<a name="l02658"></a>02658 
<a name="l02659"></a>02659         $GraphID = 0;
<a name="l02660"></a>02660         $Series = count($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>]);
<a name="l02661"></a>02661 
<a name="l02662"></a>02662         <span class="keywordflow">if</span>($Continuous) {
<a name="l02663"></a>02663             $SeriesWidth  = $this-&gt;DivisionWidth;
<a name="l02664"></a>02664         } <span class="keywordflow">else</span> {
<a name="l02665"></a>02665             $SeriesWidth  = $this-&gt;DivisionWidth * ($widthPercentage / 100);
<a name="l02666"></a>02666         }
<a name="l02667"></a>02667 
<a name="l02668"></a>02668         $YZero = $this-&gt;GArea_Y2 - ((0-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02669"></a>02669         <span class="keywordflow">if</span>($YZero &gt; $this-&gt;GArea_Y2) {
<a name="l02670"></a>02670             $YZero = $this-&gt;GArea_Y2;
<a name="l02671"></a>02671         }
<a name="l02672"></a>02672 
<a name="l02673"></a>02673         $SerieID = 0;
<a name="l02674"></a>02674         $LastValue = array();
<a name="l02675"></a>02675         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l02676"></a>02676             $ID = 0;
<a name="l02677"></a>02677             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $keyI =&gt; $ValueI) {
<a name="l02678"></a>02678                 <span class="keywordflow">if</span>($keyI == $ColName) {
<a name="l02679"></a>02679                     $ColorID = $ID;
<a name="l02680"></a>02680                 }
<a name="l02681"></a>02681                 ++$ID;
<a name="l02682"></a>02682             }
<a name="l02683"></a>02683 
<a name="l02684"></a>02684             $XPos  = $this-&gt;GArea_X1 + $this-&gt;GAreaXOffset - $SeriesWidth / 2;
<a name="l02685"></a>02685             $XLast = NULL;
<a name="l02686"></a>02686             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l02687"></a>02687                 <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l02688"></a>02688                     <span class="keywordflow">if</span>(is_numeric($this-&gt;Data[$Key][$ColName])) {
<a name="l02689"></a>02689                         $Value = $this-&gt;Data[$Key][$ColName];
<a name="l02690"></a>02690 
<a name="l02691"></a>02691                         <span class="keywordflow">if</span>(isset($LastValue[$Key])) {
<a name="l02692"></a>02692                             $YPos    = $this-&gt;GArea_Y2 - ((($Value + $LastValue[$Key]) - $this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02693"></a>02693                             $YBottom = $this-&gt;GArea_Y2 - (($LastValue[$Key] - $this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02694"></a>02694                             $LastValue[$Key] += $Value;
<a name="l02695"></a>02695                         } <span class="keywordflow">else</span> {
<a name="l02696"></a>02696                             $YPos    = $this-&gt;GArea_Y2 - (($Value-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02697"></a>02697                             $YBottom = $YZero;
<a name="l02698"></a>02698                             $LastValue[$Key] = $Value;
<a name="l02699"></a>02699                         }
<a name="l02700"></a>02700 
<a name="l02701"></a>02701                         <span class="comment">// Save point to image map if necessary</span>
<a name="l02702"></a>02702                         <span class="keywordflow">if</span>($this-&gt;BuildMap) {
<a name="l02703"></a>02703                             $this-&gt;addToImageMap($XPos + 1, min($YBottom, $YPos), $XPos + $SeriesWidth - 1, max($YBottom, $YPos), $this-&gt;DataDescription[<span class="stringliteral">'Description'</span>][$ColName], $this-&gt;Data[$Key][$ColName].$this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'Y'</span>], <span class="stringliteral">'sBar'</span>);
<a name="l02704"></a>02704                         }
<a name="l02705"></a>02705 
<a name="l02706"></a>02706                         $this-&gt;<a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">drawFilledRectangle</a>($XPos + 1, $YBottom, $XPos + $SeriesWidth - 1, $YPos, $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>], TRUE, $Alpha);
<a name="l02707"></a>02707                     }
<a name="l02708"></a>02708                 }
<a name="l02709"></a>02709                 $XPos += $this-&gt;DivisionWidth;
<a name="l02710"></a>02710             }
<a name="l02711"></a>02711             ++$SerieID;
<a name="l02712"></a>02712         }
<a name="l02713"></a>02713     }
<a name="l02714"></a>02714 
<a name="l02725"></a><a class="code" href="classmt_chart.html#6f6499481b62e6fad17bf5e81136d46a">02725</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#6f6499481b62e6fad17bf5e81136d46a">drawLimitsGraph</a>($R = 180, $G = 180, $B = 180) {
<a name="l02726"></a>02726         $this-&gt;validateDataDescription(<span class="stringliteral">'drawLimitsGraph'</span>);
<a name="l02727"></a>02727         $this-&gt;validateData(<span class="stringliteral">'drawLimitsGraph'</span>);
<a name="l02728"></a>02728 
<a name="l02729"></a>02729         $XWidth = $this-&gt;DivisionWidth / 4;
<a name="l02730"></a>02730         $XPos   = $this-&gt;GArea_X1 + $this-&gt;GAreaXOffset;
<a name="l02731"></a>02731 
<a name="l02732"></a>02732         <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l02733"></a>02733             $Min     = $this-&gt;Data[$Key][$this-&gt;DataDescription[<span class="stringliteral">'Values'</span>][0]];
<a name="l02734"></a>02734             $Max     = $this-&gt;Data[$Key][$this-&gt;DataDescription[<span class="stringliteral">'Values'</span>][0]];
<a name="l02735"></a>02735             $GraphID = 0;
<a name="l02736"></a>02736             $MaxID = 0;
<a name="l02737"></a>02737             $MinID = 0;
<a name="l02738"></a>02738             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName)
<a name="l02739"></a>02739             {
<a name="l02740"></a>02740                 <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName]))
<a name="l02741"></a>02741                 {
<a name="l02742"></a>02742                     <span class="keywordflow">if</span>($this-&gt;Data[$Key][$ColName] &gt; $Max &amp;&amp; is_numeric($this-&gt;Data[$Key][$ColName])) {
<a name="l02743"></a>02743                         $Max = $this-&gt;Data[$Key][$ColName];
<a name="l02744"></a>02744                         $MaxID = $GraphID;
<a name="l02745"></a>02745                     }
<a name="l02746"></a>02746                 }
<a name="l02747"></a>02747 
<a name="l02748"></a>02748                 <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName]) &amp;&amp; is_numeric($this-&gt;Data[$Key][$ColName])) {
<a name="l02749"></a>02749                     <span class="keywordflow">if</span>($this-&gt;Data[$Key][$ColName] &lt; $Min) {
<a name="l02750"></a>02750                         $Min = $this-&gt;Data[$Key][$ColName];
<a name="l02751"></a>02751                         $MinID = $GraphID;
<a name="l02752"></a>02752                     }
<a name="l02753"></a>02753                     ++$GraphID;
<a name="l02754"></a>02754                 }
<a name="l02755"></a>02755             }
<a name="l02756"></a>02756 
<a name="l02757"></a>02757             $YPos = $this-&gt;GArea_Y2 - (($Max - $this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02758"></a>02758             $X1 = floor($XPos - $XWidth);
<a name="l02759"></a>02759             $Y1 = floor($YPos) - 0.2;
<a name="l02760"></a>02760             $X2 = floor($XPos + $XWidth);
<a name="l02761"></a>02761             <span class="keywordflow">if</span>($X1 &lt;= $this-&gt;GArea_X1) {
<a name="l02762"></a>02762                 $X1 = $this-&gt;GArea_X1 + 1;
<a name="l02763"></a>02763             }
<a name="l02764"></a>02764             <span class="keywordflow">if</span>($X2 &gt;= $this-&gt;GArea_X2) {
<a name="l02765"></a>02765                 $X2 = $this-&gt;GArea_X2 - 1;
<a name="l02766"></a>02766             }
<a name="l02767"></a>02767 
<a name="l02768"></a>02768             $YPos = $this-&gt;GArea_Y2 - (($Min-$this-&gt;VMin) * $this-&gt;DivisionRatio);
<a name="l02769"></a>02769             $Y2 = floor($YPos) + 0.2;
<a name="l02770"></a>02770 
<a name="l02771"></a>02771             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>(floor($XPos) - 0.2, $Y1 + 1, floor($XPos) - 0.2, $Y2 - 1, $R, $G, $B, TRUE);
<a name="l02772"></a>02772             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>(floor($XPos) + 0.2, $Y1 + 1, floor($XPos) + 0.2, $Y2 - 1, $R, $G, $B, TRUE);
<a name="l02773"></a>02773             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X1, $Y1, $X2, $Y1, $this-&gt;Palette[$MaxID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$MaxID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$MaxID][<span class="charliteral">'B'</span>], FALSE);
<a name="l02774"></a>02774             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X1, $Y2, $X2, $Y2, $this-&gt;Palette[$MinID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$MinID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$MinID][<span class="charliteral">'B'</span>], FALSE);
<a name="l02775"></a>02775 
<a name="l02776"></a>02776             $XPos += $this-&gt;DivisionWidth;
<a name="l02777"></a>02777         }
<a name="l02778"></a>02778     }
<a name="l02779"></a>02779 
<a name="l02798"></a><a class="code" href="classmt_chart.html#d677af3bddff60c8e2750cb3e8bfeb9f">02798</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#d677af3bddff60c8e2750cb3e8bfeb9f">drawRadarAxis</a>($Mosaic = TRUE, $BorderOffset = 10, $A_R = 60, $A_G = 60, $A_B = 60, $S_R = 200, $S_G = 200, $S_B = 200, $MaxValue = NULL) {
<a name="l02799"></a>02799         $this-&gt;validateDataDescription(<span class="stringliteral">'drawRadarAxis'</span>);
<a name="l02800"></a>02800         $this-&gt;validateData(<span class="stringliteral">'drawRadarAxis'</span>);
<a name="l02801"></a>02801 
<a name="l02802"></a>02802         $C_TextColor = $this-&gt;AllocateColor($this-&gt;Picture, $A_R, $A_G, $A_B);
<a name="l02803"></a>02803 
<a name="l02804"></a>02804         <span class="comment">// Draw the radar axis</span>
<a name="l02805"></a>02805         $Points  = count($this-&gt;Data);
<a name="l02806"></a>02806         $Radius  = ($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / 2 - $BorderOffset;
<a name="l02807"></a>02807         $XCenter = ($this-&gt;GArea_X2 - $this-&gt;GArea_X1) / 2 + $this-&gt;GArea_X1;
<a name="l02808"></a>02808         $YCenter = ($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / 2 + $this-&gt;GArea_Y1;
<a name="l02809"></a>02809 
<a name="l02810"></a>02810         <span class="comment">// Search for the maximum value</span>
<a name="l02811"></a>02811         <span class="keywordflow">if</span>(is_null($MaxValue)) {
<a name="l02812"></a>02812             $MaxValue = $this-&gt;MaximumValue($this-&gt;Data, $this-&gt;DataDescription);
<a name="l02813"></a>02813         }
<a name="l02814"></a>02814 
<a name="l02815"></a>02815         <span class="comment">// Draw mosaic</span>
<a name="l02816"></a>02816         <span class="keywordflow">if</span>($Mosaic) {
<a name="l02817"></a>02817             $RadiusScale = $Radius / $MaxValue;
<a name="l02818"></a>02818             <span class="keywordflow">for</span>($t = 1; $t &lt;= $MaxValue - 1; $t++) {
<a name="l02819"></a>02819                 $TRadius  = $RadiusScale * $t;
<a name="l02820"></a>02820                 $LastX1   = NULL;
<a name="l02821"></a>02821 
<a name="l02822"></a>02822                 <span class="keywordflow">for</span>($i = 0; $i &lt;= $Points; ++$i) {
<a name="l02823"></a>02823                     $Angle = -90 + $i * 360 / $Points;
<a name="l02824"></a>02824                     $X1 = cos($Angle * M_PI / 180) * $TRadius + $XCenter;
<a name="l02825"></a>02825                     $Y1 = sin($Angle * M_PI / 180) * $TRadius + $YCenter;
<a name="l02826"></a>02826                     $X2 = cos($Angle * M_PI / 180) * ($TRadius + $RadiusScale) + $XCenter;
<a name="l02827"></a>02827                     $Y2 = sin($Angle * M_PI / 180) * ($TRadius + $RadiusScale) + $YCenter;
<a name="l02828"></a>02828 
<a name="l02829"></a>02829                     <span class="keywordflow">if</span>($t % 2 == 1 &amp;&amp; isset($LastX)) {
<a name="l02830"></a>02830                         $Plots   = array();
<a name="l02831"></a>02831                         $Plots[] = $X1;
<a name="l02832"></a>02832                         $Plots[] = $Y1;
<a name="l02833"></a>02833                         $Plots[] = $X2;
<a name="l02834"></a>02834                         $Plots[] = $Y2;
<a name="l02835"></a>02835                         $Plots[] = $LastX2;
<a name="l02836"></a>02836                         $Plots[] = $LastY2;
<a name="l02837"></a>02837                         $Plots[] = $LastX1;
<a name="l02838"></a>02838                         $Plots[] = $LastY1;
<a name="l02839"></a>02839 
<a name="l02840"></a>02840                         $C_Graph = $this-&gt;AllocateColor($this-&gt;Picture, 250, 250, 250);
<a name="l02841"></a>02841                         imagefilledpolygon($this-&gt;Picture, $Plots, (count($Plots) + 1) / 2, $C_Graph);
<a name="l02842"></a>02842                     }
<a name="l02843"></a>02843 
<a name="l02844"></a>02844                     $LastX1 = $X1;
<a name="l02845"></a>02845                     $LastY1= $Y1;
<a name="l02846"></a>02846                     $LastX2 = $X2;
<a name="l02847"></a>02847                     $LastY2= $Y2;
<a name="l02848"></a>02848                 }
<a name="l02849"></a>02849             }
<a name="l02850"></a>02850         }
<a name="l02851"></a>02851 
<a name="l02852"></a>02852         <span class="comment">// Draw the spider web</span>
<a name="l02853"></a>02853         <span class="keywordflow">for</span>($t = 1; $t &lt;= $MaxValue; ++$t) {
<a name="l02854"></a>02854             $TRadius = ($Radius / $MaxValue) * $t;
<a name="l02855"></a>02855             $LastX = NULL;
<a name="l02856"></a>02856 
<a name="l02857"></a>02857             <span class="keywordflow">for</span>($i = 0; $i &lt;= $Points; ++$i) {
<a name="l02858"></a>02858                 $Angle = -90 + $i * 360/$Points;
<a name="l02859"></a>02859                 $X = cos($Angle * M_PI / 180) * $TRadius + $XCenter;
<a name="l02860"></a>02860                 $Y = sin($Angle * M_PI / 180) * $TRadius + $YCenter;
<a name="l02861"></a>02861 
<a name="l02862"></a>02862                 <span class="keywordflow">if</span>(isset($LastX)) {
<a name="l02863"></a>02863                     $this-&gt;<a class="code" href="classmt_chart.html#108d0822c67fb29ab139b10bb58ffced">drawDottedLine</a>($LastX, $LastY, $X, $Y, 4, $S_R, $S_G, $S_B);
<a name="l02864"></a>02864                 }
<a name="l02865"></a>02865 
<a name="l02866"></a>02866                 $LastX = $X;
<a name="l02867"></a>02867                 $LastY= $Y;
<a name="l02868"></a>02868             }
<a name="l02869"></a>02869         }
<a name="l02870"></a>02870 
<a name="l02871"></a>02871         <span class="comment">// Draw the axis</span>
<a name="l02872"></a>02872         <span class="keywordflow">for</span>($i = 0; $i &lt;= $Points; ++$i) {
<a name="l02873"></a>02873             $Angle = -90 + $i * 360 / $Points;
<a name="l02874"></a>02874             $X = cos($Angle * M_PI / 180) * $Radius + $XCenter;
<a name="l02875"></a>02875             $Y = sin($Angle * M_PI / 180) * $Radius + $YCenter;
<a name="l02876"></a>02876 
<a name="l02877"></a>02877             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XCenter, $YCenter, $X, $Y, $A_R, $A_G, $A_B);
<a name="l02878"></a>02878 
<a name="l02879"></a>02879             $XOffset = 0;
<a name="l02880"></a>02880             $YOffset = 0;
<a name="l02881"></a>02881             <span class="keywordflow">if</span>(isset($this-&gt;Data[$i][$this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]])) {
<a name="l02882"></a>02882                 $Label = $this-&gt;Data[$i][$this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]];
<a name="l02883"></a>02883 
<a name="l02884"></a>02884                 $Positions = imagettfbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Label));
<a name="l02885"></a>02885                 $Width  = $Positions[2] - $Positions[6];
<a name="l02886"></a>02886                 $Height = $Positions[3] - $Positions[7];
<a name="l02887"></a>02887 
<a name="l02888"></a>02888                 <span class="keywordflow">if</span>($Angle &gt;= 0 &amp;&amp; $Angle &lt;= 90) {
<a name="l02889"></a>02889                     $YOffset = $Height;
<a name="l02890"></a>02890                 }
<a name="l02891"></a>02891 
<a name="l02892"></a>02892                 <span class="keywordflow">if</span>($Angle &gt; 90 &amp;&amp; $Angle &lt;= 180) {
<a name="l02893"></a>02893                     $YOffset = $Height;
<a name="l02894"></a>02894                     $XOffset = -$Width;
<a name="l02895"></a>02895                 }
<a name="l02896"></a>02896 
<a name="l02897"></a>02897                 <span class="keywordflow">if</span>($Angle &gt; 180 &amp;&amp; $Angle &lt;= 270) {
<a name="l02898"></a>02898                     $XOffset = -$Width;
<a name="l02899"></a>02899                 }
<a name="l02900"></a>02900 
<a name="l02901"></a>02901                 imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $X + $XOffset, $Y + $YOffset, $C_TextColor, $this-&gt;FontName, utf8_decode($Label));
<a name="l02902"></a>02902             }
<a name="l02903"></a>02903         }
<a name="l02904"></a>02904 
<a name="l02905"></a>02905         <span class="comment">// Write the values</span>
<a name="l02906"></a>02906         <span class="keywordflow">for</span>($t = 1; $t &lt;= $MaxValue; ++$t) {
<a name="l02907"></a>02907             $TRadius = ($Radius / $MaxValue) * $t;
<a name="l02908"></a>02908 
<a name="l02909"></a>02909             $Angle = -90 + 360 / $Points;
<a name="l02910"></a>02910             $X1 = $XCenter;
<a name="l02911"></a>02911             $Y1 = $YCenter - $TRadius;
<a name="l02912"></a>02912             $X2 = cos($Angle * M_PI / 180) * $TRadius + $XCenter;
<a name="l02913"></a>02913             $Y2 = sin($Angle * M_PI / 180) * $TRadius + $YCenter;
<a name="l02914"></a>02914 
<a name="l02915"></a>02915             $XPos = floor(($X2-$X1) / 2) + $X1;
<a name="l02916"></a>02916             $YPos = floor(($Y2-$Y1) / 2) + $Y1;
<a name="l02917"></a>02917 
<a name="l02918"></a>02918             $Positions = imagettfbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($t));
<a name="l02919"></a>02919             $X = $XPos - ($X + $Positions[2] - $X + $Positions[6]) / 2;
<a name="l02920"></a>02920             $Y = $YPos + $this-&gt;FontSize;
<a name="l02921"></a>02921 
<a name="l02922"></a>02922             $this-&gt;<a class="code" href="classmt_chart.html#49ed36208b1734539834cf757f97adf2">drawFilledRoundedRectangle</a>($X + $Positions[6] - 2, $Y + $Positions[7] - 1, $X + $Positions[2] + 4, $Y + $Positions[3] + 1, 2, 240, 240, 240);
<a name="l02923"></a>02923             $this-&gt;<a class="code" href="classmt_chart.html#9cab5346037ff8cb42012cdb937948e2">drawRoundedRectangle</a>($X + $Positions[6] - 2, $Y + $Positions[7] - 1, $X + $Positions[2] + 4, $Y + $Positions[3] + 1, 2, 220, 220, 220);
<a name="l02924"></a>02924             imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $X, $Y, $C_TextColor, $this-&gt;FontName, utf8_decode($t));
<a name="l02925"></a>02925         }
<a name="l02926"></a>02926     }
<a name="l02927"></a>02927 
<a name="l02934"></a><a class="code" href="classmt_chart.html#c0aa9cf74e994adc6e5c91b4ecb98b16">02934</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#c0aa9cf74e994adc6e5c91b4ecb98b16">drawRadar</a>($BorderOffset = 10, $MaxValue = NULL) {
<a name="l02935"></a>02935         $this-&gt;validateDataDescription(<span class="stringliteral">'drawRadar'</span>);
<a name="l02936"></a>02936         $this-&gt;validateData(<span class="stringliteral">'drawRadar'</span>);
<a name="l02937"></a>02937 
<a name="l02938"></a>02938         $Points  = count($this-&gt;Data);
<a name="l02939"></a>02939         $Radius  = ($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / 2 - $BorderOffset;
<a name="l02940"></a>02940         $XCenter = ($this-&gt;GArea_X2 - $this-&gt;GArea_X1) / 2 + $this-&gt;GArea_X1;
<a name="l02941"></a>02941         $YCenter = ($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / 2 + $this-&gt;GArea_Y1;
<a name="l02942"></a>02942 
<a name="l02943"></a>02943         <span class="comment">// Search for the maximum value</span>
<a name="l02944"></a>02944         <span class="keywordflow">if</span>(is_null($MaxValue)) {
<a name="l02945"></a>02945             $MaxValue = $this-&gt;MaximumValue($this-&gt;Data, $this-&gt;DataDescription);
<a name="l02946"></a>02946         }
<a name="l02947"></a>02947 
<a name="l02948"></a>02948         $GraphID = 0;
<a name="l02949"></a>02949         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l02950"></a>02950             $ID = 0;
<a name="l02951"></a>02951             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $keyI =&gt; $ValueI) {
<a name="l02952"></a>02952                 <span class="keywordflow">if</span>($keyI == $ColName) {
<a name="l02953"></a>02953                     $ColorID = $ID;
<a name="l02954"></a>02954                 }
<a name="l02955"></a>02955                 ++$ID;
<a name="l02956"></a>02956             }
<a name="l02957"></a>02957 
<a name="l02958"></a>02958             $Angle = -90;
<a name="l02959"></a>02959             $XLast = NULL;
<a name="l02960"></a>02960             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l02961"></a>02961                 <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l02962"></a>02962                     $Value    = $this-&gt;Data[$Key][$ColName];
<a name="l02963"></a>02963                     $Strength = ($Radius / $MaxValue) * $Value;
<a name="l02964"></a>02964 
<a name="l02965"></a>02965                     $XPos = cos($Angle * M_PI / 180) * $Strength + $XCenter;
<a name="l02966"></a>02966                     $YPos = sin($Angle * M_PI / 180) * $Strength + $YCenter;
<a name="l02967"></a>02967 
<a name="l02968"></a>02968                     <span class="keywordflow">if</span>(isset($XLast)) {
<a name="l02969"></a>02969                         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XLast, $YLast, $XPos, $YPos, $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>]);
<a name="l02970"></a>02970                     }
<a name="l02971"></a>02971 
<a name="l02972"></a>02972                     <span class="keywordflow">if</span>(is_null($XLast)) {
<a name="l02973"></a>02973                         $FirstX = $XPos;
<a name="l02974"></a>02974                         $FirstY = $YPos;
<a name="l02975"></a>02975                     }
<a name="l02976"></a>02976 
<a name="l02977"></a>02977                     $Angle = $Angle + (360 / $Points);
<a name="l02978"></a>02978                     $XLast = $XPos;
<a name="l02979"></a>02979                     $YLast = $YPos;
<a name="l02980"></a>02980                 }
<a name="l02981"></a>02981             }
<a name="l02982"></a>02982 
<a name="l02983"></a>02983             $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XPos, $YPos, $FirstX, $FirstY, $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>]);
<a name="l02984"></a>02984             ++$GraphID;
<a name="l02985"></a>02985         }
<a name="l02986"></a>02986     }
<a name="l02987"></a>02987 
<a name="l02995"></a><a class="code" href="classmt_chart.html#cd76be41c9ed3290cb75dc808d1c2f83">02995</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#cd76be41c9ed3290cb75dc808d1c2f83">drawFilledRadar</a>($Alpha = 50, $BorderOffset = 10, $MaxValue = NULL) {
<a name="l02996"></a>02996         $this-&gt;validateDataDescription(<span class="stringliteral">'drawFilledRadar'</span>);
<a name="l02997"></a>02997         $this-&gt;validateData(<span class="stringliteral">'drawFilledRadar'</span>);
<a name="l02998"></a>02998 
<a name="l02999"></a>02999         $Points      = count($this-&gt;Data);
<a name="l03000"></a>03000         $LayerWidth  = $this-&gt;GArea_X2 - $this-&gt;GArea_X1;
<a name="l03001"></a>03001         $LayerHeight = $this-&gt;GArea_Y2 - $this-&gt;GArea_Y1;
<a name="l03002"></a>03002         $Radius      = ($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / 2 - $BorderOffset;
<a name="l03003"></a>03003         $XCenter     = ($this-&gt;GArea_X2 - $this-&gt;GArea_X1) / 2;
<a name="l03004"></a>03004         $YCenter     = ($this-&gt;GArea_Y2 - $this-&gt;GArea_Y1) / 2;
<a name="l03005"></a>03005 
<a name="l03006"></a>03006         <span class="comment">// Search for the maximum value</span>
<a name="l03007"></a>03007         <span class="keywordflow">if</span>(is_null($MaxValue)) {
<a name="l03008"></a>03008             $MaxValue = $this-&gt;MaximumValue($this-&gt;Data, $this-&gt;DataDescription);
<a name="l03009"></a>03009         }
<a name="l03010"></a>03010 
<a name="l03011"></a>03011         $GraphID = 0;
<a name="l03012"></a>03012         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l03013"></a>03013             $ID = 0;
<a name="l03014"></a>03014             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>] as $keyI =&gt; $ValueI) {
<a name="l03015"></a>03015                 <span class="keywordflow">if</span>($keyI == $ColName) {
<a name="l03016"></a>03016                     $ColorID = $ID;
<a name="l03017"></a>03017                 }
<a name="l03018"></a>03018                 ++$ID;
<a name="l03019"></a>03019             }
<a name="l03020"></a>03020 
<a name="l03021"></a>03021             $Angle = -90;
<a name="l03022"></a>03022             $XLast = NULL;
<a name="l03023"></a>03023             $Plots = array();
<a name="l03024"></a>03024 
<a name="l03025"></a>03025             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l03026"></a>03026                 <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l03027"></a>03027                     $Value    = $this-&gt;Data[$Key][$ColName];
<a name="l03028"></a>03028                     <span class="keywordflow">if</span>(!is_numeric($Value)) {
<a name="l03029"></a>03029                         $Value = 0;
<a name="l03030"></a>03030                     }
<a name="l03031"></a>03031                     $Strength = ($Radius / $MaxValue) * $Value;
<a name="l03032"></a>03032 
<a name="l03033"></a>03033                     $XPos = cos($Angle * M_PI / 180) * $Strength + $XCenter;
<a name="l03034"></a>03034                     $YPos = sin($Angle * M_PI / 180) * $Strength + $YCenter;
<a name="l03035"></a>03035 
<a name="l03036"></a>03036                     $Plots[] = $XPos;
<a name="l03037"></a>03037                     $Plots[] = $YPos;
<a name="l03038"></a>03038 
<a name="l03039"></a>03039                     $Angle = $Angle + (360 / $Points);
<a name="l03040"></a>03040                     $XLast = $XPos;
<a name="l03041"></a>03041                     $YLast = $YPos;
<a name="l03042"></a>03042                 }
<a name="l03043"></a>03043             }
<a name="l03044"></a>03044 
<a name="l03045"></a>03045             <span class="keywordflow">if</span>(isset($Plots[0])) {
<a name="l03046"></a>03046                 $Plots[] = $Plots[0];
<a name="l03047"></a>03047                 $Plots[] = $Plots[1];
<a name="l03048"></a>03048 
<a name="l03049"></a>03049                 $this-&gt;Layers[0] = imagecreatetruecolor($LayerWidth, $LayerHeight);
<a name="l03050"></a>03050                 $C_White         = $this-&gt;AllocateColor($this-&gt;Layers[0], 255, 255, 255);
<a name="l03051"></a>03051                 imagefilledrectangle($this-&gt;Layers[0], 0, 0, $LayerWidth, $LayerHeight, $C_White);
<a name="l03052"></a>03052                 imagecolortransparent($this-&gt;Layers[0], $C_White);
<a name="l03053"></a>03053 
<a name="l03054"></a>03054                 $C_Graph = $this-&gt;AllocateColor($this-&gt;Layers[0], $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>]);
<a name="l03055"></a>03055                 imagefilledpolygon($this-&gt;Layers[0], $Plots, (count($Plots) + 1) / 2, $C_Graph);
<a name="l03056"></a>03056 
<a name="l03057"></a>03057                 imagecopymerge($this-&gt;Picture, $this-&gt;Layers[0], $this-&gt;GArea_X1, $this-&gt;GArea_Y1, 0, 0, $LayerWidth, $LayerHeight, $Alpha);
<a name="l03058"></a>03058                 imagedestroy($this-&gt;Layers[0]);
<a name="l03059"></a>03059 
<a name="l03060"></a>03060                 <span class="keywordflow">for</span>($i = 0; $i &lt;= count($Plots) - 4; $i += 2) {
<a name="l03061"></a>03061                     $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($Plots[$i] + $this-&gt;GArea_X1, $Plots[$i+1] + $this-&gt;GArea_Y1, $Plots[$i+2] + $this-&gt;GArea_X1, $Plots[$i+3] + $this-&gt;GArea_Y1, $this-&gt;Palette[$ColorID][<span class="charliteral">'R'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'G'</span>], $this-&gt;Palette[$ColorID][<span class="charliteral">'B'</span>]);
<a name="l03062"></a>03062                 }
<a name="l03063"></a>03063             }
<a name="l03064"></a>03064 
<a name="l03065"></a>03065             ++$GraphID;
<a name="l03066"></a>03066         }
<a name="l03067"></a>03067     }
<a name="l03068"></a>03068 
<a name="l03096"></a><a class="code" href="classmt_chart.html#9b30145e8446c9dcb562df2f3966d180">03096</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#9b30145e8446c9dcb562df2f3966d180">drawBasicPieGraph</a>($XPos, $YPos, $Radius = 100, $DrawLabels = PIE_NOLABEL, $R = 255, $G = 255, $B = 255, $Decimals = 0) {
<a name="l03097"></a>03097         $this-&gt;validateDataDescription(<span class="stringliteral">'drawBasicPieGraph'</span>, FALSE);
<a name="l03098"></a>03098         $this-&gt;validateData(<span class="stringliteral">'drawBasicPieGraph'</span>);
<a name="l03099"></a>03099 
<a name="l03100"></a>03100         <span class="comment">// Calculate pie sum</span>
<a name="l03101"></a>03101         $Series = 0;
<a name="l03102"></a>03102         $PieSum = 0;
<a name="l03103"></a>03103         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l03104"></a>03104             <span class="keywordflow">if</span>($ColName != $this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]) {
<a name="l03105"></a>03105                 ++$Series;
<a name="l03106"></a>03106                 <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l03107"></a>03107                     <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l03108"></a>03108                         $PieSum += $this-&gt;Data[$Key][$ColName];
<a name="l03109"></a>03109                         $iValues[] = $this-&gt;Data[$Key][$ColName];
<a name="l03110"></a>03110                         $iLabels[] = $this-&gt;Data[$Key][$this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]];
<a name="l03111"></a>03111                     }
<a name="l03112"></a>03112                 }
<a name="l03113"></a>03113             }
<a name="l03114"></a>03114         }
<a name="l03115"></a>03115 
<a name="l03116"></a>03116         <span class="comment">// Validate number of $Series</span>
<a name="l03117"></a>03117         <span class="keywordflow">if</span>($Series != 1) {
<a name="l03118"></a>03118             $this-&gt;RaiseFatal(<span class="stringliteral">'Pie chart can only accept one serie of data.'</span>);
<a name="l03119"></a>03119         }
<a name="l03120"></a>03120 
<a name="l03121"></a>03121         $SpliceRatio = 360 / $PieSum;
<a name="l03122"></a>03122         $SplicePercent = 100 / $PieSum;
<a name="l03123"></a>03123 
<a name="l03124"></a>03124         <span class="comment">// Calculate all polygons</span>
<a name="l03125"></a>03125         $Angle = 0;
<a name="l03126"></a>03126         $TopPlots = array();
<a name="l03127"></a>03127 
<a name="l03128"></a>03128         <span class="keywordflow">foreach</span>($iValues as $Key =&gt; $Value) {
<a name="l03129"></a>03129             $TopPlots[$Key][] = $XPos;
<a name="l03130"></a>03130             $TopPlots[$Key][] = $YPos;
<a name="l03131"></a>03131 
<a name="l03132"></a>03132             <span class="comment">// Process labels and sizes</span>
<a name="l03133"></a>03133             $Caption = <span class="stringliteral">''</span>;
<a name="l03134"></a>03134 
<a name="l03135"></a>03135             <span class="keywordflow">switch</span>($DrawLabels) {
<a name="l03136"></a>03136                 <span class="keywordflow">default</span>: <span class="comment">// Break intentionally omitted</span>
<a name="l03137"></a>03137                 <span class="keywordflow">case</span> PIE_NOLABEL:
<a name="l03138"></a>03138                     <span class="keywordflow">break</span>;
<a name="l03139"></a>03139                 <span class="keywordflow">case</span> PIE_PERCENTAGE:
<a name="l03140"></a>03140                     $Caption  = (round($Value * pow(10, $Decimals) * $SplicePercent) / pow(10, $Decimals)) . <span class="charliteral">'%'</span>;
<a name="l03141"></a>03141                     <span class="keywordflow">break</span>;
<a name="l03142"></a>03142                 <span class="keywordflow">case</span> PIE_LABELS:
<a name="l03143"></a>03143                     $Caption  = $iLabels[$Key];
<a name="l03144"></a>03144                     <span class="keywordflow">break</span>;
<a name="l03145"></a>03145                 <span class="keywordflow">case</span> PIE_PERCENTAGE_LABEL:
<a name="l03146"></a>03146                     $Caption  = $iLabels[$Key] . <span class="stringliteral">"\n"</span> . (round($Value * pow(10, $Decimals) * $SplicePercent) / pow(10, $Decimals)) . <span class="charliteral">'%'</span>;
<a name="l03147"></a>03147                     <span class="keywordflow">break</span>;
<a name="l03148"></a>03148             }
<a name="l03149"></a>03149 
<a name="l03150"></a>03150             <span class="keywordflow">if</span>($Caption) {
<a name="l03151"></a>03151                 $TAngle     = $Angle + ($Value * $SpliceRatio / 2);
<a name="l03152"></a>03152                 $Position   = imageftbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Caption));
<a name="l03153"></a>03153                 $TextWidth  = $Position[2] - $Position[0];
<a name="l03154"></a>03154                 $TextHeight = abs($Position[1]) + abs($Position[3]);
<a name="l03155"></a>03155 
<a name="l03156"></a>03156                 $TX = cos(($TAngle) * M_PI / 180) * ($Radius + 10) + $XPos;
<a name="l03157"></a>03157 
<a name="l03158"></a>03158                 <span class="keywordflow">if</span>($TAngle &gt; 0 &amp;&amp; $TAngle &lt; 180) {
<a name="l03159"></a>03159                     $TY = sin(($TAngle) * M_PI / 180) * ($Radius + 10) + $YPos + 4;
<a name="l03160"></a>03160                 } <span class="keywordflow">else</span> {
<a name="l03161"></a>03161                     $TY = sin(($TAngle) * M_PI / 180) * ($Radius + 4) + $YPos - ($TextHeight / 2);
<a name="l03162"></a>03162                 }
<a name="l03163"></a>03163 
<a name="l03164"></a>03164                 <span class="keywordflow">if</span>($TAngle &gt; 90 &amp;&amp; $TAngle &lt; 270) {
<a name="l03165"></a>03165                     $TX -= $TextWidth;
<a name="l03166"></a>03166                 }
<a name="l03167"></a>03167 
<a name="l03168"></a>03168                 $C_TextColor = $this-&gt;AllocateColor($this-&gt;Picture, 70, 70, 70);
<a name="l03169"></a>03169                 imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $TX, $TY, $C_TextColor, $this-&gt;FontName, utf8_decode($Caption));
<a name="l03170"></a>03170             }
<a name="l03171"></a>03171 
<a name="l03172"></a>03172             <span class="comment">// Process pie slices</span>
<a name="l03173"></a>03173             <span class="keywordflow">for</span>($iAngle = $Angle; $iAngle &lt;= $Angle + $Value * $SpliceRatio; $iAngle += 0.5) {
<a name="l03174"></a>03174                 $TopX = cos($iAngle * M_PI / 180) * $Radius + $XPos;
<a name="l03175"></a>03175                 $TopY = sin($iAngle * M_PI / 180) * $Radius + $YPos;
<a name="l03176"></a>03176 
<a name="l03177"></a>03177                 $TopPlots[$Key][] = $TopX;
<a name="l03178"></a>03178                 $TopPlots[$Key][] = $TopY;
<a name="l03179"></a>03179             }
<a name="l03180"></a>03180 
<a name="l03181"></a>03181             $TopPlots[$Key][] = $XPos;
<a name="l03182"></a>03182             $TopPlots[$Key][] = $YPos;
<a name="l03183"></a>03183 
<a name="l03184"></a>03184             $Angle = $iAngle;
<a name="l03185"></a>03185         }
<a name="l03186"></a>03186         $PolyPlots = $TopPlots;
<a name="l03187"></a>03187 
<a name="l03188"></a>03188         <span class="comment">// Set array values type to float --- PHP Bug with imagefilledpolygon casting to integer</span>
<a name="l03189"></a>03189         <span class="keywordflow">foreach</span>($TopPlots as $Key =&gt; $Value) {
<a name="l03190"></a>03190             <span class="keywordflow">foreach</span> ($TopPlots[$Key] as $Key2 =&gt; $Value2) {
<a name="l03191"></a>03191                 settype($TopPlots[$Key][$Key2],<span class="stringliteral">'float'</span>);
<a name="l03192"></a>03192             }
<a name="l03193"></a>03193         }
<a name="l03194"></a>03194 
<a name="l03195"></a>03195         <span class="comment">// Draw top polygons</span>
<a name="l03196"></a>03196         <span class="keywordflow">foreach</span>($PolyPlots as $Key =&gt; $Value) {
<a name="l03197"></a>03197             $C_GraphLo = $this-&gt;AllocateColor($this-&gt;Picture, $this-&gt;Palette[$Key][<span class="charliteral">'R'</span>], $this-&gt;Palette[$Key][<span class="charliteral">'G'</span>], $this-&gt;Palette[$Key][<span class="charliteral">'B'</span>]);
<a name="l03198"></a>03198             imagefilledpolygon($this-&gt;Picture, $PolyPlots[$Key], (count($PolyPlots[$Key]) + 1) / 2, $C_GraphLo);
<a name="l03199"></a>03199         }
<a name="l03200"></a>03200 
<a name="l03201"></a>03201         $this-&gt;<a class="code" href="classmt_chart.html#12b38cf986a753b078510cb68248a5fc">drawCircle</a>($XPos - 0.5, $YPos - 0.5, $Radius, $R, $G, $B);
<a name="l03202"></a>03202         $this-&gt;<a class="code" href="classmt_chart.html#12b38cf986a753b078510cb68248a5fc">drawCircle</a>($XPos - 0.5, $YPos - 0.5, $Radius + 0.5, $R, $G, $B);
<a name="l03203"></a>03203 
<a name="l03204"></a>03204         <span class="comment">// Draw border lines</span>
<a name="l03205"></a>03205         <span class="keywordflow">foreach</span> ($TopPlots as $Key =&gt; $Value) {
<a name="l03206"></a>03206             <span class="keywordflow">for</span>($j = 0; $j &lt;= count($TopPlots[$Key]) - 4; $j += 2) {
<a name="l03207"></a>03207                 $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($TopPlots[$Key][$j], $TopPlots[$Key][$j+1], $TopPlots[$Key][$j+2], $TopPlots[$Key][$j+3], $R, $G, $B);
<a name="l03208"></a>03208             }
<a name="l03209"></a>03209         }
<a name="l03210"></a>03210     }
<a name="l03211"></a>03211 
<a name="l03232"></a><a class="code" href="classmt_chart.html#1b5f658c360f056dd0bb81085eceddd3">03232</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#1b5f658c360f056dd0bb81085eceddd3">drawFlatPieGraphWithShadow</a>($XPos, $YPos, $Radius = 100, $DrawLabels = PIE_NOLABEL, $SpliceDistance = 0, $Decimals = 0) {
<a name="l03233"></a>03233         $this-&gt;<a class="code" href="classmt_chart.html#9a938bc3e378b96c181ddfdfbf35165a">drawFlatPieGraph</a>($XPos + $this-&gt;ShadowXDistance, $YPos + $this-&gt;ShadowYDistance, $Radius, PIE_NOLABEL, $SpliceDistance, $Decimals, TRUE);
<a name="l03234"></a>03234         $this-&gt;<a class="code" href="classmt_chart.html#9a938bc3e378b96c181ddfdfbf35165a">drawFlatPieGraph</a>($XPos, $YPos, $Radius, $DrawLabels, $SpliceDistance, $Decimals, FALSE);
<a name="l03235"></a>03235     }
<a name="l03236"></a>03236 
<a name="l03259"></a><a class="code" href="classmt_chart.html#9a938bc3e378b96c181ddfdfbf35165a">03259</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#9a938bc3e378b96c181ddfdfbf35165a">drawFlatPieGraph</a>($XPos, $YPos, $Radius = 100, $DrawLabels = PIE_NOLABEL, $SpliceDistance = 0, $Decimals = 0, $AllBlack = FALSE) {
<a name="l03260"></a>03260         $this-&gt;validateDataDescription(<span class="stringliteral">'drawFlatPieGraph'</span>, FALSE);
<a name="l03261"></a>03261         $this-&gt;validateData(<span class="stringliteral">'drawFlatPieGraph'</span>);
<a name="l03262"></a>03262 
<a name="l03263"></a>03263         <span class="comment">// Back up current shadow status</span>
<a name="l03264"></a>03264         $ShadowStatus = $this-&gt;ShadowActive ;
<a name="l03265"></a>03265         $this-&gt;ShadowActive = FALSE;
<a name="l03266"></a>03266 
<a name="l03267"></a>03267         $Series = 0;
<a name="l03268"></a>03268         $PieSum = 0;
<a name="l03269"></a>03269         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l03270"></a>03270             <span class="keywordflow">if</span>($ColName != $this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]) {
<a name="l03271"></a>03271                 ++$Series;
<a name="l03272"></a>03272                 <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l03273"></a>03273                     <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l03274"></a>03274                         $PieSum += $this-&gt;Data[$Key][$ColName];
<a name="l03275"></a>03275                         $iValues[] = $this-&gt;Data[$Key][$ColName];
<a name="l03276"></a>03276                         $iLabels[] = $this-&gt;Data[$Key][$this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]];
<a name="l03277"></a>03277                     }
<a name="l03278"></a>03278                 }
<a name="l03279"></a>03279             }
<a name="l03280"></a>03280         }
<a name="l03281"></a>03281 
<a name="l03282"></a>03282         <span class="comment">// Validate number of $Series</span>
<a name="l03283"></a>03283         <span class="keywordflow">if</span>($Series != 1) {
<a name="l03284"></a>03284             $this-&gt;RaiseFatal(<span class="stringliteral">'Pie chart can only accept one serie of data.'</span>);
<a name="l03285"></a>03285         }
<a name="l03286"></a>03286 
<a name="l03287"></a>03287         $SpliceRatio = 360 / $PieSum;
<a name="l03288"></a>03288         $SplicePercent = 100 / $PieSum;
<a name="l03289"></a>03289 
<a name="l03290"></a>03290         <span class="comment">// Calculate all polygons</span>
<a name="l03291"></a>03291         $Angle = 0;
<a name="l03292"></a>03292         $TopPlots = array();
<a name="l03293"></a>03293         <span class="keywordflow">foreach</span>($iValues as $Key =&gt; $Value) {
<a name="l03294"></a>03294             $XOffset = cos(($Angle+($Value / 2 * $SpliceRatio)) * M_PI / 180) * $SpliceDistance;
<a name="l03295"></a>03295             $YOffset = sin(($Angle+($Value / 2 * $SpliceRatio)) * M_PI / 180) * $SpliceDistance;
<a name="l03296"></a>03296 
<a name="l03297"></a>03297             $TopPlots[$Key][] = round($XPos + $XOffset);
<a name="l03298"></a>03298             $TopPlots[$Key][] = round($YPos + $YOffset);
<a name="l03299"></a>03299 
<a name="l03300"></a>03300             <span class="keywordflow">if</span>($AllBlack) {
<a name="l03301"></a>03301                 $Rc = $this-&gt;ShadowRColor;
<a name="l03302"></a>03302                 $Gc = $this-&gt;ShadowGColor;
<a name="l03303"></a>03303                 $Bc = $this-&gt;ShadowBColor;
<a name="l03304"></a>03304             } <span class="keywordflow">else</span> {
<a name="l03305"></a>03305                 $Rc = $this-&gt;Palette[$Key][<span class="charliteral">'R'</span>];
<a name="l03306"></a>03306                 $Gc = $this-&gt;Palette[$Key][<span class="charliteral">'G'</span>];
<a name="l03307"></a>03307                 $Bc = $this-&gt;Palette[$Key][<span class="charliteral">'B'</span>];
<a name="l03308"></a>03308             }
<a name="l03309"></a>03309 
<a name="l03310"></a>03310             $XLineLast = array();
<a name="l03311"></a>03311             $YLineLast = array();
<a name="l03312"></a>03312 
<a name="l03313"></a>03313             <span class="comment">// Process labels and sizes</span>
<a name="l03314"></a>03314             $Caption = <span class="stringliteral">''</span>;
<a name="l03315"></a>03315 
<a name="l03316"></a>03316             <span class="keywordflow">switch</span>($DrawLabels) {
<a name="l03317"></a>03317                 <span class="keywordflow">default</span>: <span class="comment">// Break intentionally omitted</span>
<a name="l03318"></a>03318                 <span class="keywordflow">case</span> PIE_NOLABEL:
<a name="l03319"></a>03319                     <span class="keywordflow">break</span>;
<a name="l03320"></a>03320                 <span class="keywordflow">case</span> PIE_PERCENTAGE:
<a name="l03321"></a>03321                     $Caption  = (round($Value * pow(10, $Decimals) * $SplicePercent) / pow(10, $Decimals)) . <span class="charliteral">'%'</span>;
<a name="l03322"></a>03322                     <span class="keywordflow">break</span>;
<a name="l03323"></a>03323                 <span class="keywordflow">case</span> PIE_LABELS:
<a name="l03324"></a>03324                     $Caption  = $iLabels[$Key];
<a name="l03325"></a>03325                     <span class="keywordflow">break</span>;
<a name="l03326"></a>03326                 <span class="keywordflow">case</span> PIE_PERCENTAGE_LABEL:
<a name="l03327"></a>03327                     $Caption  = $iLabels[$Key] . <span class="stringliteral">"\n"</span> . (round($Value * pow(10, $Decimals) * $SplicePercent) / pow(10, $Decimals)) . <span class="charliteral">'%'</span>;
<a name="l03328"></a>03328                     <span class="keywordflow">break</span>;
<a name="l03329"></a>03329             }
<a name="l03330"></a>03330 
<a name="l03331"></a>03331             <span class="keywordflow">if</span>($Caption) {
<a name="l03332"></a>03332                 $TAngle     = $Angle + ($Value * $SpliceRatio / 2);
<a name="l03333"></a>03333                 $Position   = imageftbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Caption));
<a name="l03334"></a>03334                 $TextWidth  = $Position[2] - $Position[0];
<a name="l03335"></a>03335                 $TextHeight = abs($Position[1]) + abs($Position[3]);
<a name="l03336"></a>03336 
<a name="l03337"></a>03337                 $TX = cos(($TAngle) * M_PI / 180) * ($Radius + 10 + $SpliceDistance) + $XPos;
<a name="l03338"></a>03338 
<a name="l03339"></a>03339                 <span class="keywordflow">if</span>($TAngle &gt; 0 &amp;&amp; $TAngle &lt; 180) {
<a name="l03340"></a>03340                     $TY = sin(($TAngle) * M_PI / 180) * ($Radius + 10 + $SpliceDistance) + $YPos + 4;
<a name="l03341"></a>03341                 } <span class="keywordflow">else</span> {
<a name="l03342"></a>03342                     $TY = sin(($TAngle) * M_PI / 180) * ($Radius + 4 + $SpliceDistance) + $YPos - ($TextHeight / 2);
<a name="l03343"></a>03343                 }
<a name="l03344"></a>03344 
<a name="l03345"></a>03345                 <span class="keywordflow">if</span>($TAngle &gt; 90 &amp;&amp; $TAngle &lt; 270) {
<a name="l03346"></a>03346                     $TX -= $TextWidth;
<a name="l03347"></a>03347                 }
<a name="l03348"></a>03348 
<a name="l03349"></a>03349                 $C_TextColor = $this-&gt;AllocateColor($this-&gt;Picture, 70, 70, 70);
<a name="l03350"></a>03350                 imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $TX, $TY, $C_TextColor, $this-&gt;FontName, utf8_decode($Caption));
<a name="l03351"></a>03351             }
<a name="l03352"></a>03352 
<a name="l03353"></a>03353 
<a name="l03354"></a>03354             <span class="comment">// Process pie slices</span>
<a name="l03355"></a>03355             $LineColor = $this-&gt;AllocateColor($this-&gt;Picture, $Rc, $Gc, $Bc);
<a name="l03356"></a>03356             $XLineLast = NULL;
<a name="l03357"></a>03357             $YLineLast = NULL;
<a name="l03358"></a>03358             <span class="keywordflow">for</span>($iAngle = $Angle; $iAngle &lt;= $Angle + $Value * $SpliceRatio; $iAngle += 0.5) {
<a name="l03359"></a>03359                 $PosX = cos($iAngle * M_PI / 180) * $Radius + $XPos + $XOffset;
<a name="l03360"></a>03360                 $PosY = sin($iAngle * M_PI / 180) * $Radius + $YPos + $YOffset;
<a name="l03361"></a>03361 
<a name="l03362"></a>03362                 $TopPlots[$Key][] = round($PosX);
<a name="l03363"></a>03363                 $TopPlots[$Key][] = round($PosY);
<a name="l03364"></a>03364 
<a name="l03365"></a>03365                 <span class="keywordflow">if</span>($iAngle == $Angle || $iAngle == $Angle + $Value * $SpliceRatio || $iAngle + 0.5 &gt; $Angle + $Value * $SpliceRatio) {
<a name="l03366"></a>03366                     $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XPos+$XOffset, $YPos+$YOffset, $PosX, $PosY, $Rc, $Gc, $Bc);
<a name="l03367"></a>03367                 }
<a name="l03368"></a>03368 
<a name="l03369"></a>03369                 <span class="keywordflow">if</span>(isset($XLineLast)) {
<a name="l03370"></a>03370                     $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($XLineLast, $YLineLast, $PosX, $PosY, $Rc, $Gc, $Bc);
<a name="l03371"></a>03371                 }
<a name="l03372"></a>03372 
<a name="l03373"></a>03373                 $XLineLast = $PosX;
<a name="l03374"></a>03374                 $YLineLast = $PosY;
<a name="l03375"></a>03375             }
<a name="l03376"></a>03376 
<a name="l03377"></a>03377             $TopPlots[$Key][] = round($XPos + $XOffset);
<a name="l03378"></a>03378             $TopPlots[$Key][] = round($YPos + $YOffset);
<a name="l03379"></a>03379 
<a name="l03380"></a>03380             $Angle = $iAngle;
<a name="l03381"></a>03381         }
<a name="l03382"></a>03382         $PolyPlots = $TopPlots;
<a name="l03383"></a>03383 
<a name="l03384"></a>03384         <span class="comment">// Draw top polygons</span>
<a name="l03385"></a>03385         <span class="keywordflow">foreach</span> ($PolyPlots as $Key =&gt; $Value) {
<a name="l03386"></a>03386             <span class="keywordflow">if</span>(!$AllBlack) {
<a name="l03387"></a>03387                 $C_GraphLo = $this-&gt;AllocateColor($this-&gt;Picture, $this-&gt;Palette[$Key][<span class="charliteral">'R'</span>], $this-&gt;Palette[$Key][<span class="charliteral">'G'</span>], $this-&gt;Palette[$Key][<span class="charliteral">'B'</span>]);
<a name="l03388"></a>03388             } <span class="keywordflow">else</span> {
<a name="l03389"></a>03389                 $C_GraphLo = $this-&gt;AllocateColor($this-&gt;Picture, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor);
<a name="l03390"></a>03390             }
<a name="l03391"></a>03391 
<a name="l03392"></a>03392             imagefilledpolygon($this-&gt;Picture, $PolyPlots[$Key], (count($PolyPlots[$Key]) + 1) / 2, $C_GraphLo);
<a name="l03393"></a>03393         }
<a name="l03394"></a>03394         $this-&gt;ShadowActive = $ShadowStatus;
<a name="l03395"></a>03395     }
<a name="l03396"></a>03396 
<a name="l03418"></a><a class="code" href="classmt_chart.html#cc5e46ccb2b8e247853ee685f8effac6">03418</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#cc5e46ccb2b8e247853ee685f8effac6">drawPieGraph</a>($XPos, $YPos, $Radius = 100, $DrawLabels = PIE_NOLABEL, $EnhanceColors = TRUE, $Skew = 60, $SpliceHeight = 20, $SpliceDistance = 0, $Decimals = 0) {
<a name="l03419"></a>03419         $this-&gt;validateDataDescription(<span class="stringliteral">'drawPieGraph'</span>, FALSE);
<a name="l03420"></a>03420         $this-&gt;validateData(<span class="stringliteral">'drawPieGraph'</span>);
<a name="l03421"></a>03421 
<a name="l03422"></a>03422         <span class="comment">// Calculate pie sum</span>
<a name="l03423"></a>03423         $Series = 0;
<a name="l03424"></a>03424         $PieSum = 0;
<a name="l03425"></a>03425         $rPieSum = 0;
<a name="l03426"></a>03426         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l03427"></a>03427             <span class="keywordflow">if</span>($ColName != $this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]) {
<a name="l03428"></a>03428                 ++$Series;
<a name="l03429"></a>03429                 <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l03430"></a>03430                     <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l03431"></a>03431                         <span class="keywordflow">if</span>($this-&gt;Data[$Key][$ColName] == 0) {
<a name="l03432"></a>03432                             $iValues[] = 0;
<a name="l03433"></a>03433                             $rValues[] = 0;
<a name="l03434"></a>03434                             $iLabels[] = $this-&gt;Data[$Key][$this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]];
<a name="l03435"></a>03435                         }  <span class="keywordflow">else</span> {
<a name="l03436"></a>03436                             $PieSum += $this-&gt;Data[$Key][$ColName];
<a name="l03437"></a>03437                             $iValues[] = $this-&gt;Data[$Key][$ColName];
<a name="l03438"></a>03438                             $iLabels[] = $this-&gt;Data[$Key][$this-&gt;DataDescription[<span class="stringliteral">'Position'</span>]];
<a name="l03439"></a>03439                             $rValues[] = $this-&gt;Data[$Key][$ColName];
<a name="l03440"></a>03440                             $rPieSum += $this-&gt;Data[$Key][$ColName];
<a name="l03441"></a>03441                         }
<a name="l03442"></a>03442                     }
<a name="l03443"></a>03443                 }
<a name="l03444"></a>03444             }
<a name="l03445"></a>03445         }
<a name="l03446"></a>03446 
<a name="l03447"></a>03447         <span class="comment">// Validate number of series</span>
<a name="l03448"></a>03448         <span class="keywordflow">if</span>($Series != 1) {
<a name="l03449"></a>03449             $this-&gt;RaiseFatal(<span class="stringliteral">'Pie chart can only accept one serie of data.'</span>);
<a name="l03450"></a>03450         }
<a name="l03451"></a>03451 
<a name="l03452"></a>03452         $SpliceDistanceRatio = $SpliceDistance;
<a name="l03453"></a>03453         $SkewHeight          = ($Radius * $Skew) / 100;
<a name="l03454"></a>03454         $SpliceRatio         = (360 - $SpliceDistanceRatio * count($iValues)) / $PieSum;
<a name="l03455"></a>03455         $SplicePercent       = 100 / $PieSum;
<a name="l03456"></a>03456         $rSplicePercent      = 100 / $rPieSum;
<a name="l03457"></a>03457 
<a name="l03458"></a>03458         <span class="comment">// Calculate all polygons</span>
<a name="l03459"></a>03459         $Angle = 0;
<a name="l03460"></a>03460         $CDev = 5;
<a name="l03461"></a>03461         $TopPlots = array();
<a name="l03462"></a>03462         $BotPlots = array();
<a name="l03463"></a>03463         $aTopPlots = array();
<a name="l03464"></a>03464         $aBotPlots = array();
<a name="l03465"></a>03465         <span class="keywordflow">foreach</span>($iValues as $Key =&gt; $Value) {
<a name="l03466"></a>03466             $XCenterPos = cos(($Angle-$CDev+($Value*$SpliceRatio+$SpliceDistanceRatio)/2) * M_PI / 180) * $SpliceDistance + $XPos;
<a name="l03467"></a>03467             $YCenterPos = sin(($Angle-$CDev+($Value*$SpliceRatio+$SpliceDistanceRatio)/2) * M_PI / 180) * $SpliceDistance + $YPos;
<a name="l03468"></a>03468             $XCenterPos2 = cos(($Angle+$CDev+($Value*$SpliceRatio+$SpliceDistanceRatio)/2) * M_PI / 180) * $SpliceDistance + $XPos;
<a name="l03469"></a>03469             $YCenterPos2 = sin(($Angle+$CDev+($Value*$SpliceRatio+$SpliceDistanceRatio)/2) * M_PI / 180) * $SpliceDistance + $YPos;
<a name="l03470"></a>03470 
<a name="l03471"></a>03471             $TopPlots[$Key][] = round($XCenterPos);
<a name="l03472"></a>03472             $BotPlots[$Key][] = round($XCenterPos);
<a name="l03473"></a>03473             $TopPlots[$Key][] = round($YCenterPos);
<a name="l03474"></a>03474             $BotPlots[$Key][] = round($YCenterPos + $SpliceHeight);
<a name="l03475"></a>03475             $aTopPlots[$Key][] = $XCenterPos;
<a name="l03476"></a>03476             $aBotPlots[$Key][] = $XCenterPos;
<a name="l03477"></a>03477             $aTopPlots[$Key][] = $YCenterPos;
<a name="l03478"></a>03478             $aBotPlots[$Key][] = $YCenterPos + $SpliceHeight;
<a name="l03479"></a>03479 
<a name="l03480"></a>03480             <span class="comment">// Process labels and sizes</span>
<a name="l03481"></a>03481             $Caption = <span class="stringliteral">''</span>;
<a name="l03482"></a>03482 
<a name="l03483"></a>03483             <span class="keywordflow">switch</span>($DrawLabels) {
<a name="l03484"></a>03484                 <span class="keywordflow">default</span>: <span class="comment">// Break intentionally omitted</span>
<a name="l03485"></a>03485                 <span class="keywordflow">case</span> PIE_NOLABEL:
<a name="l03486"></a>03486                     <span class="keywordflow">break</span>;
<a name="l03487"></a>03487                 <span class="keywordflow">case</span> PIE_PERCENTAGE:
<a name="l03488"></a>03488                     $Caption  = (round($Value * pow(10, $Decimals) * $SplicePercent) / pow(10, $Decimals)) . <span class="charliteral">'%'</span>;
<a name="l03489"></a>03489                     <span class="keywordflow">break</span>;
<a name="l03490"></a>03490                 <span class="keywordflow">case</span> PIE_LABELS:
<a name="l03491"></a>03491                     $Caption  = $iLabels[$Key];
<a name="l03492"></a>03492                     <span class="keywordflow">break</span>;
<a name="l03493"></a>03493                 <span class="keywordflow">case</span> PIE_PERCENTAGE_LABEL:
<a name="l03494"></a>03494                     $Caption  = $iLabels[$Key] . <span class="stringliteral">"\n"</span> . (round($Value * pow(10, $Decimals) * $SplicePercent) / pow(10, $Decimals)) . <span class="charliteral">'%'</span>;
<a name="l03495"></a>03495                     <span class="keywordflow">break</span>;
<a name="l03496"></a>03496             }
<a name="l03497"></a>03497 
<a name="l03498"></a>03498             <span class="keywordflow">if</span>($Caption) {
<a name="l03499"></a>03499                 $TAngle = $Angle + ($Value * $SpliceRatio / 2);
<a name="l03500"></a>03500                 $Position = imageftbbox($this-&gt;FontSize, 0, $this-&gt;FontName, utf8_decode($Caption));
<a name="l03501"></a>03501                 $TextWidth = $Position[2] - $Position[0];
<a name="l03502"></a>03502                 $TextHeight = abs($Position[1]) + abs($Position[3]);
<a name="l03503"></a>03503 
<a name="l03504"></a>03504                 $TX = cos(($TAngle) * M_PI / 180) * ($Radius + 10) + $XPos;
<a name="l03505"></a>03505 
<a name="l03506"></a>03506                 <span class="keywordflow">if</span>($TAngle &gt; 0 &amp;&amp; $TAngle &lt; 180) {
<a name="l03507"></a>03507                     $TY = sin(($TAngle) * M_PI / 180) * ($SkewHeight + 10) + $YPos + $SpliceHeight + 4;
<a name="l03508"></a>03508                 } <span class="keywordflow">else</span> {
<a name="l03509"></a>03509                     $TY = sin(($TAngle) * M_PI / 180) * ($SkewHeight + 4) + $YPos - ($TextHeight/2);
<a name="l03510"></a>03510                 }
<a name="l03511"></a>03511 
<a name="l03512"></a>03512                 <span class="keywordflow">if</span>($TAngle &gt; 90 &amp;&amp; $TAngle &lt; 270) {
<a name="l03513"></a>03513                     $TX -= $TextWidth;
<a name="l03514"></a>03514                 }
<a name="l03515"></a>03515 
<a name="l03516"></a>03516                 $C_TextColor = $this-&gt;AllocateColor($this-&gt;Picture, 70, 70, 70);
<a name="l03517"></a>03517                 imagettftext($this-&gt;Picture, $this-&gt;FontSize, 0, $TX, $TY, $C_TextColor, $this-&gt;FontName, utf8_decode($Caption));
<a name="l03518"></a>03518             }
<a name="l03519"></a>03519 
<a name="l03520"></a>03520             <span class="comment">// Process pie slices</span>
<a name="l03521"></a>03521             <span class="keywordflow">for</span>($iAngle = $Angle; $iAngle &lt;= $Angle + $Value * $SpliceRatio; $iAngle += 0.5) {
<a name="l03522"></a>03522                 $TopX = cos($iAngle * M_PI / 180) * $Radius + $XPos;
<a name="l03523"></a>03523                 $TopY = sin($iAngle * M_PI / 180) * $SkewHeight + $YPos;
<a name="l03524"></a>03524 
<a name="l03525"></a>03525                 $TopPlots[$Key][] = round($TopX);
<a name="l03526"></a>03526                 $BotPlots[$Key][] = round($TopX);
<a name="l03527"></a>03527                 $TopPlots[$Key][] = round($TopY);
<a name="l03528"></a>03528                 $BotPlots[$Key][] = round($TopY + $SpliceHeight);
<a name="l03529"></a>03529                 $aTopPlots[$Key][] = $TopX;
<a name="l03530"></a>03530                 $aBotPlots[$Key][] = $TopX;
<a name="l03531"></a>03531                 $aTopPlots[$Key][] = $TopY;
<a name="l03532"></a>03532                 $aBotPlots[$Key][] = $TopY + $SpliceHeight;
<a name="l03533"></a>03533             }
<a name="l03534"></a>03534 
<a name="l03535"></a>03535             $TopPlots[$Key][] = round($XCenterPos2);
<a name="l03536"></a>03536             $BotPlots[$Key][] = round($XCenterPos2);
<a name="l03537"></a>03537             $TopPlots[$Key][] = round($YCenterPos2);
<a name="l03538"></a>03538             $BotPlots[$Key][] = round($YCenterPos2 + $SpliceHeight);
<a name="l03539"></a>03539             $aTopPlots[$Key][] = $XCenterPos2;
<a name="l03540"></a>03540             $aBotPlots[$Key][] = $XCenterPos2;
<a name="l03541"></a>03541             $aTopPlots[$Key][] = $YCenterPos2;
<a name="l03542"></a>03542             $aBotPlots[$Key][] = $YCenterPos2 + $SpliceHeight;
<a name="l03543"></a>03543 
<a name="l03544"></a>03544             $Angle = $iAngle + $SpliceDistanceRatio;
<a name="l03545"></a>03545         }
<a name="l03546"></a>03546 
<a name="l03547"></a>03547         <span class="comment">// Draw bottom polygons</span>
<a name="l03548"></a>03548         <span class="keywordflow">foreach</span>($iValues as $Key =&gt; $Value) {
<a name="l03549"></a>03549             $C_GraphLo = $this-&gt;AllocateColor($this-&gt;Picture, $this-&gt;Palette[$Key][<span class="charliteral">'R'</span>], $this-&gt;Palette[$Key][<span class="charliteral">'G'</span>], $this-&gt;Palette[$Key][<span class="charliteral">'B'</span>], -20);
<a name="l03550"></a>03550             imagefilledpolygon($this-&gt;Picture, $BotPlots[$Key], (count($BotPlots[$Key]) + 1) / 2, $C_GraphLo);
<a name="l03551"></a>03551 
<a name="l03552"></a>03552             <span class="keywordflow">if</span>($EnhanceColors) {
<a name="l03553"></a>03553                 $En = -10;
<a name="l03554"></a>03554             } <span class="keywordflow">else</span> {
<a name="l03555"></a>03555                 $En = 0;
<a name="l03556"></a>03556             }
<a name="l03557"></a>03557 
<a name="l03558"></a>03558             <span class="keywordflow">for</span>($j = 0; $j &lt;= count($aBotPlots[$Key]) -4 ; $j += 2) {
<a name="l03559"></a>03559                 $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($aBotPlots[$Key][$j], $aBotPlots[$Key][$j+1], $aBotPlots[$Key][$j+2], $aBotPlots[$Key][$j+3], $this-&gt;Palette[$Key][<span class="charliteral">'R'</span>]+$En, $this-&gt;Palette[$Key][<span class="charliteral">'G'</span>]+$En, $this-&gt;Palette[$Key][<span class="charliteral">'B'</span>]+$En);
<a name="l03560"></a>03560             }
<a name="l03561"></a>03561         }
<a name="l03562"></a>03562 
<a name="l03563"></a>03563         <span class="comment">// Draw pie layers</span>
<a name="l03564"></a>03564         <span class="keywordflow">if</span>($EnhanceColors) {
<a name="l03565"></a>03565             $ColorRatio = 30 / $SpliceHeight;
<a name="l03566"></a>03566         } <span class="keywordflow">else</span> {
<a name="l03567"></a>03567             $ColorRatio = 25 / $SpliceHeight;
<a name="l03568"></a>03568         }
<a name="l03569"></a>03569 
<a name="l03570"></a>03570         <span class="keywordflow">for</span>($i = $SpliceHeight - 1; $i &gt;= 1; --$i) {
<a name="l03571"></a>03571             <span class="keywordflow">foreach</span>($iValues as $Key =&gt; $Value) {
<a name="l03572"></a>03572                 $C_GraphLo = $this-&gt;AllocateColor($this-&gt;Picture, $this-&gt;Palette[$Key][<span class="charliteral">'R'</span>], $this-&gt;Palette[$Key][<span class="charliteral">'G'</span>], $this-&gt;Palette[$Key][<span class="charliteral">'B'</span>], -10);
<a name="l03573"></a>03573                 $Plots = array();
<a name="l03574"></a>03574                 $Plot = 0;
<a name="l03575"></a>03575                 <span class="keywordflow">foreach</span>($TopPlots[$Key] as $Key2 =&gt; $Value2) {
<a name="l03576"></a>03576                     ++$Plot;
<a name="l03577"></a>03577                     <span class="keywordflow">if</span>($Plot % 2 == 1) {
<a name="l03578"></a>03578                         $Plots[] = $Value2;
<a name="l03579"></a>03579                     } <span class="keywordflow">else</span> {
<a name="l03580"></a>03580                         $Plots[] = $Value2 + $i;
<a name="l03581"></a>03581                     }
<a name="l03582"></a>03582                 }
<a name="l03583"></a>03583                 imagefilledpolygon($this-&gt;Picture, $Plots, (count($Plots)+1)/2, $C_GraphLo);
<a name="l03584"></a>03584 
<a name="l03585"></a>03585                 $Index = count($Plots);
<a name="l03586"></a>03586                 <span class="keywordflow">if</span>($EnhanceColors) {
<a name="l03587"></a>03587                     $ColorFactor = -20 + ($SpliceHeight - $i) * $ColorRatio;
<a name="l03588"></a>03588                 } <span class="keywordflow">else</span> {
<a name="l03589"></a>03589                     $ColorFactor = 0;
<a name="l03590"></a>03590                 }
<a name="l03591"></a>03591 
<a name="l03592"></a>03592                 $this-&gt;drawAntialiasPixel($Plots[0], $Plots[1], $this-&gt;Palette[$Key][<span class="charliteral">'R'</span>]+$ColorFactor, $this-&gt;Palette[$Key][<span class="charliteral">'G'</span>]+$ColorFactor, $this-&gt;Palette[$Key][<span class="charliteral">'B'</span>]+$ColorFactor);
<a name="l03593"></a>03593                 $this-&gt;drawAntialiasPixel($Plots[2], $Plots[3], $this-&gt;Palette[$Key][<span class="charliteral">'R'</span>]+$ColorFactor, $this-&gt;Palette[$Key][<span class="charliteral">'G'</span>]+$ColorFactor, $this-&gt;Palette[$Key][<span class="charliteral">'B'</span>]+$ColorFactor);
<a name="l03594"></a>03594                 $this-&gt;drawAntialiasPixel($Plots[$Index-4], $Plots[$Index-3], $this-&gt;Palette[$Key][<span class="charliteral">'R'</span>]+$ColorFactor, $this-&gt;Palette[$Key][<span class="charliteral">'G'</span>]+$ColorFactor, $this-&gt;Palette[$Key][<span class="charliteral">'B'</span>]+$ColorFactor);
<a name="l03595"></a>03595             }
<a name="l03596"></a>03596         }
<a name="l03597"></a>03597 
<a name="l03598"></a>03598         <span class="comment">// Draw top polygons</span>
<a name="l03599"></a>03599         <span class="keywordflow">for</span>($Key = count($iValues) - 1; $Key &gt;= 0; --$Key) {
<a name="l03600"></a>03600             $C_GraphLo = $this-&gt;AllocateColor($this-&gt;Picture, $this-&gt;Palette[$Key][<span class="charliteral">'R'</span>], $this-&gt;Palette[$Key][<span class="charliteral">'G'</span>], $this-&gt;Palette[$Key][<span class="charliteral">'B'</span>]);
<a name="l03601"></a>03601             imagefilledpolygon($this-&gt;Picture, $TopPlots[$Key], (count($TopPlots[$Key]) + 1) / 2, $C_GraphLo);
<a name="l03602"></a>03602 
<a name="l03603"></a>03603             <span class="keywordflow">if</span>($EnhanceColors) {
<a name="l03604"></a>03604                 $En = 10;
<a name="l03605"></a>03605             } <span class="keywordflow">else</span> {
<a name="l03606"></a>03606                 $En = 0;
<a name="l03607"></a>03607             }
<a name="l03608"></a>03608 
<a name="l03609"></a>03609             <span class="keywordflow">for</span>($j = 0; $j &lt;= count($aTopPlots[$Key]) - 4; $j += 2) {
<a name="l03610"></a>03610                 $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($aTopPlots[$Key][$j], $aTopPlots[$Key][$j+1], $aTopPlots[$Key][$j+2], $aTopPlots[$Key][$j+3], $this-&gt;Palette[$Key][<span class="charliteral">'R'</span>]+$En, $this-&gt;Palette[$Key][<span class="charliteral">'G'</span>]+$En, $this-&gt;Palette[$Key][<span class="charliteral">'B'</span>]+$En);
<a name="l03611"></a>03611             }
<a name="l03612"></a>03612         }
<a name="l03613"></a>03613     }
<a name="l03614"></a>03614 
<a name="l03624"></a><a class="code" href="classmt_chart.html#61ee10d622bcdb2f7f6093a45374a134">03624</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#61ee10d622bcdb2f7f6093a45374a134">drawBackground</a>($R = 255, $G = 255, $B = 255) {
<a name="l03625"></a>03625         $C_Background = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l03626"></a>03626         imagefilledrectangle($this-&gt;Picture, 0, 0, $this-&gt;XSize, $this-&gt;YSize, $C_Background);
<a name="l03627"></a>03627     }
<a name="l03628"></a>03628 
<a name="l03654"></a><a class="code" href="classmt_chart.html#d022e7e14c1bfbdad4f4b13401e903c1">03654</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#d022e7e14c1bfbdad4f4b13401e903c1">drawGraphAreaGradient</a>($R, $G, $B, $Decay, $Target = TARGET_GRAPHAREA, $Direction = GRADIENT_VERTICAL) {
<a name="l03655"></a>03655         $this-&gt;<a class="code" href="classmt_chart.html#2f4b2c241834e423dbb1a1ca7ce69a4b">drawGraphAreaGradientToColor</a>($R, $G, $B, $R - $Decay, $G - $Decay, $B - $Decay, $Target, $Direction);
<a name="l03656"></a>03656     }
<a name="l03657"></a>03657 
<a name="l03681"></a><a class="code" href="classmt_chart.html#2f4b2c241834e423dbb1a1ca7ce69a4b">03681</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#2f4b2c241834e423dbb1a1ca7ce69a4b">drawGraphAreaGradientToColor</a>($Rs, $Gs, $Bs, $Rt, $Gt, $Bt, $Target = TARGET_GRAPHAREA, $Direction = GRADIENT_VERTICAL) {
<a name="l03682"></a>03682         <span class="keywordflow">switch</span>($Target) {
<a name="l03683"></a>03683             <span class="keywordflow">default</span>: <span class="comment">// Break intentionally omitted</span>
<a name="l03684"></a>03684             <span class="keywordflow">case</span> TARGET_GRAPHAREA:
<a name="l03685"></a>03685                 $X1 = $this-&gt;GArea_X1;
<a name="l03686"></a>03686                 $X2 = $this-&gt;GArea_X2;
<a name="l03687"></a>03687                 $Y1 = $this-&gt;GArea_Y1;
<a name="l03688"></a>03688                 $Y2 = $this-&gt;GArea_Y2;
<a name="l03689"></a>03689                 <span class="keywordflow">break</span>;
<a name="l03690"></a>03690             <span class="keywordflow">case</span> TARGET_BACKGROUND:
<a name="l03691"></a>03691                 $X1 = 0;
<a name="l03692"></a>03692                 $X2 = $this-&gt;XSize - 1;
<a name="l03693"></a>03693                 $Y1 = 0;
<a name="l03694"></a>03694                 $Y2 = $this-&gt;YSize - 1;
<a name="l03695"></a>03695                 <span class="keywordflow">break</span>;
<a name="l03696"></a>03696         }
<a name="l03697"></a>03697 
<a name="l03698"></a>03698         <span class="keywordflow">if</span>($Rs != $Rt || $Gs != $Gt || $Bs != $Bt) {
<a name="l03699"></a>03699             <span class="comment">// Save direction, includes some variable variables magic</span>
<a name="l03700"></a>03700             $C1 = NULL;
<a name="l03701"></a>03701             $C2 = NULL;
<a name="l03702"></a>03702             <span class="keywordflow">switch</span>($Direction) {
<a name="l03703"></a>03703                 <span class="keywordflow">default</span>: <span class="comment">// Break intentionally omitted</span>
<a name="l03704"></a>03704                 <span class="keywordflow">case</span> GRADIENT_VERTICAL:
<a name="l03705"></a>03705                     $C1 = <span class="stringliteral">'Y1'</span>;
<a name="l03706"></a>03706                     $C2 = <span class="stringliteral">'Y2'</span>;
<a name="l03707"></a>03707                     $XX2 = <span class="stringliteral">'X2'</span>;
<a name="l03708"></a>03708                     $YY2 = <span class="stringliteral">'Y1'</span>;
<a name="l03709"></a>03709                     <span class="keywordflow">break</span>;
<a name="l03710"></a>03710                 <span class="keywordflow">case</span> GRADIENT_HORIZONTAL:
<a name="l03711"></a>03711                     $C1 = <span class="stringliteral">'X1'</span>;
<a name="l03712"></a>03712                     $C2 = <span class="stringliteral">'X2'</span>;
<a name="l03713"></a>03713                     $XX2 = <span class="stringliteral">'X1'</span>;
<a name="l03714"></a>03714                     $YY2 = <span class="stringliteral">'Y2'</span>;
<a name="l03715"></a>03715                     <span class="keywordflow">break</span>;
<a name="l03716"></a>03716             }
<a name="l03717"></a>03717 
<a name="l03718"></a>03718             $gradientLength = $$C2 - $$C1 + 1;
<a name="l03719"></a>03719             $RDecay = ($Rt - $Rs) / $gradientLength;
<a name="l03720"></a>03720             $GDecay = ($Gt - $Gs) / $gradientLength;
<a name="l03721"></a>03721             $BDecay = ($Bt - $Bs) / $gradientLength;
<a name="l03722"></a>03722 
<a name="l03723"></a>03723             <span class="keywordflow">for</span>($i = 0; $i &lt; $gradientLength; ++$i) {
<a name="l03724"></a>03724                 $C_Background = $this-&gt;AllocateColor($this-&gt;Picture, $Rs + ($i * $RDecay), $Gs + ($i * $GDecay), $Bs +($i * $BDecay));
<a name="l03725"></a>03725                 imageline($this-&gt;Picture, $X1, $Y1, $$XX2, $$YY2, $C_Background);
<a name="l03726"></a>03726                 ++$$C1;
<a name="l03727"></a>03727             }
<a name="l03728"></a>03728         } <span class="keywordflow">else</span> {
<a name="l03729"></a>03729             <span class="comment">// No gradient required</span>
<a name="l03730"></a>03730             $this-&gt;<a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">drawFilledRectangle</a>($X1, $Y1, $X2, $Y2, $Rs, $Gs, $Bs, FALSE, 100);
<a name="l03731"></a>03731         }
<a name="l03732"></a>03732     }
<a name="l03733"></a>03733 
<a name="l03745"></a><a class="code" href="classmt_chart.html#616537ed8f9f5b76ce8cd7c19c07eecc">03745</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#616537ed8f9f5b76ce8cd7c19c07eecc">drawRectangle</a>($X1, $Y1, $X2, $Y2, $R, $G, $B) {
<a name="l03746"></a>03746         <span class="keywordflow">if</span>($X2 &lt; $X1) { list($X1, $X2) = array($X2, $X1); }
<a name="l03747"></a>03747         <span class="keywordflow">if</span>($Y2 &lt; $Y1) { list($Y1, $Y2) = array($Y2, $Y1); }
<a name="l03748"></a>03748 
<a name="l03749"></a>03749         $X1 -= 0.2;
<a name="l03750"></a>03750         $Y1 -= 0.2;
<a name="l03751"></a>03751         $X2 += 0.2;
<a name="l03752"></a>03752         $Y2 += 0.2;
<a name="l03753"></a>03753         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X1, $Y1, $X2, $Y1, $R, $G, $B);
<a name="l03754"></a>03754         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X2, $Y1, $X2, $Y2, $R, $G, $B);
<a name="l03755"></a>03755         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X2, $Y2, $X1, $Y2, $R, $G, $B);
<a name="l03756"></a>03756         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X1, $Y2, $X1, $Y1, $R, $G, $B);
<a name="l03757"></a>03757     }
<a name="l03758"></a>03758 
<a name="l03777"></a><a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">03777</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">drawFilledRectangle</a>($X1, $Y1, $X2, $Y2, $R, $G, $B, $DrawBorder = TRUE, $Alpha = 100, $NoFallBack = FALSE) {
<a name="l03778"></a>03778         <span class="keywordflow">if</span>($Alpha == 100) {
<a name="l03779"></a>03779             <span class="comment">// Solid rectangle, process shadows</span>
<a name="l03780"></a>03780             <span class="keywordflow">if</span>($this-&gt;ShadowActive &amp;&amp; !$NoFallBack) {
<a name="l03781"></a>03781                 $this-&gt;<a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">drawFilledRectangle</a>($X1 + $this-&gt;ShadowXDistance, $Y1 + $this-&gt;ShadowYDistance, $X2 + $this-&gt;ShadowXDistance, $Y2 + $this-&gt;ShadowYDistance, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor, FALSE, $this-&gt;ShadowAlpha, TRUE);
<a name="l03782"></a>03782                 <span class="keywordflow">if</span>($this-&gt;ShadowBlur != 0) {
<a name="l03783"></a>03783                     $AlphaDecay = ($this-&gt;ShadowAlpha / $this-&gt;ShadowBlur);
<a name="l03784"></a>03784 
<a name="l03785"></a>03785                     <span class="keywordflow">for</span>($i = 1; $i &lt;= $this-&gt;ShadowBlur; ++$i) {
<a name="l03786"></a>03786                         $this-&gt;<a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">drawFilledRectangle</a>($X1 + $this-&gt;ShadowXDistance - $i / 2, $Y1 + $this-&gt;ShadowYDistance - $i / 2, $X2 + $this-&gt;ShadowXDistance - $i / 2 , $Y2 + $this-&gt;ShadowYDistance - $i / 2, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor, FALSE, $this-&gt;ShadowAlpha - $AlphaDecay * $i,TRUE);
<a name="l03787"></a>03787                     }
<a name="l03788"></a>03788                     <span class="keywordflow">for</span>($i = 1; $i &lt;= $this-&gt;ShadowBlur; ++$i) {
<a name="l03789"></a>03789                         $this-&gt;<a class="code" href="classmt_chart.html#7d4fd9b6ad2642760cf242f487828d09">drawFilledRectangle</a>($X1 + $this-&gt;ShadowXDistance + $i / 2, $Y1 + $this-&gt;ShadowYDistance + $i / 2, $X2 + $this-&gt;ShadowXDistance + $i / 2, $Y2 + $this-&gt;ShadowYDistance + $i / 2, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor, FALSE, $this-&gt;ShadowAlpha - $AlphaDecay * $i, TRUE);
<a name="l03790"></a>03790                     }
<a name="l03791"></a>03791                 }
<a name="l03792"></a>03792             }
<a name="l03793"></a>03793 
<a name="l03794"></a>03794             $C_Rectangle = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l03795"></a>03795             imagefilledrectangle($this-&gt;Picture, round($X1), round($Y1), round($X2), round($Y2), $C_Rectangle);
<a name="l03796"></a>03796         } <span class="keywordflow">else</span> {
<a name="l03797"></a>03797             <span class="comment">// Transparent rectangle</span>
<a name="l03798"></a>03798             $LayerWidth  = abs($X2 - $X1) + 2;
<a name="l03799"></a>03799             $LayerHeight = abs($Y2 - $Y1) + 2;
<a name="l03800"></a>03800 
<a name="l03801"></a>03801             $this-&gt;Layers[0] = imagecreatetruecolor($LayerWidth, $LayerHeight);
<a name="l03802"></a>03802             $C_White         = $this-&gt;AllocateColor($this-&gt;Layers[0], 255, 255, 255);
<a name="l03803"></a>03803             imagefilledrectangle($this-&gt;Layers[0], 0, 0, $LayerWidth, $LayerHeight, $C_White);
<a name="l03804"></a>03804             imagecolortransparent($this-&gt;Layers[0], $C_White);
<a name="l03805"></a>03805 
<a name="l03806"></a>03806             $C_Rectangle = $this-&gt;AllocateColor($this-&gt;Layers[0], $R, $G, $B);
<a name="l03807"></a>03807             imagefilledrectangle($this-&gt;Layers[0], 1, 1, round($LayerWidth - 1), round($LayerHeight - 1), $C_Rectangle);
<a name="l03808"></a>03808 
<a name="l03809"></a>03809             imagecopymerge($this-&gt;Picture, $this-&gt;Layers[0], round(min($X1, $X2) - 1), round(min($Y1, $Y2) - 1), 0, 0, $LayerWidth, $LayerHeight, $Alpha);
<a name="l03810"></a>03810             imagedestroy($this-&gt;Layers[0]);
<a name="l03811"></a>03811         }
<a name="l03812"></a>03812 
<a name="l03813"></a>03813         <span class="keywordflow">if</span>($DrawBorder) {
<a name="l03814"></a>03814             <span class="comment">// Deactivate shadow and draw the border</span>
<a name="l03815"></a>03815             $ShadowSettings = $this-&gt;ShadowActive;
<a name="l03816"></a>03816             $this-&gt;ShadowActive = FALSE;
<a name="l03817"></a>03817             $this-&gt;<a class="code" href="classmt_chart.html#616537ed8f9f5b76ce8cd7c19c07eecc">drawRectangle</a>($X1, $Y1, $X2, $Y2, $R, $G, $B);
<a name="l03818"></a>03818             $this-&gt;ShadowActive = $ShadowSettings;
<a name="l03819"></a>03819         }
<a name="l03820"></a>03820     }
<a name="l03821"></a>03821 
<a name="l03822"></a>03822 
<a name="l03837"></a><a class="code" href="classmt_chart.html#9cab5346037ff8cb42012cdb937948e2">03837</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#9cab5346037ff8cb42012cdb937948e2">drawRoundedRectangle</a>($X1, $Y1, $X2, $Y2, $Radius = 5, $R, $G, $B) {
<a name="l03838"></a>03838         <span class="keywordflow">if</span>(! $Radius) {
<a name="l03839"></a>03839             $Radius = 5;
<a name="l03840"></a>03840         }
<a name="l03841"></a>03841 
<a name="l03842"></a>03842         <span class="comment">// Draw corners first</span>
<a name="l03843"></a>03843         $Step = 90 / ((M_PI * $Radius)/2);
<a name="l03844"></a>03844         <span class="keywordflow">for</span>($i = 0; $i &lt;= 90; $i += $Step) {
<a name="l03845"></a>03845             $X = cos(($i+180) * M_PI / 180) * $Radius + $X1 + $Radius;
<a name="l03846"></a>03846             $Y = sin(($i+180) * M_PI / 180) * $Radius + $Y1 + $Radius;
<a name="l03847"></a>03847             $this-&gt;drawAntialiasPixel($X, $Y, $R, $G, $B);
<a name="l03848"></a>03848 
<a name="l03849"></a>03849             $X = cos(($i-90) * M_PI / 180) * $Radius + $X2 - $Radius;
<a name="l03850"></a>03850             $Y = sin(($i-90) * M_PI / 180) * $Radius + $Y1 + $Radius;
<a name="l03851"></a>03851             $this-&gt;drawAntialiasPixel($X, $Y, $R, $G, $B);
<a name="l03852"></a>03852 
<a name="l03853"></a>03853             $X = cos(($i) * M_PI / 180) * $Radius + $X2 - $Radius;
<a name="l03854"></a>03854             $Y = sin(($i) * M_PI / 180) * $Radius + $Y2 - $Radius;
<a name="l03855"></a>03855             $this-&gt;drawAntialiasPixel($X, $Y, $R, $G, $B);
<a name="l03856"></a>03856 
<a name="l03857"></a>03857             $X = cos(($i+90) * M_PI / 180) * $Radius + $X1 + $Radius;
<a name="l03858"></a>03858             $Y = sin(($i+90) * M_PI / 180) * $Radius + $Y2 - $Radius;
<a name="l03859"></a>03859             $this-&gt;drawAntialiasPixel($X, $Y, $R, $G, $B);
<a name="l03860"></a>03860         }
<a name="l03861"></a>03861 
<a name="l03862"></a>03862         <span class="comment">// Draw antialiased lines between the corners</span>
<a name="l03863"></a>03863         $X1 -= 0.2;
<a name="l03864"></a>03864         $Y1 -= 0.2;
<a name="l03865"></a>03865         $X2 += 0.2;
<a name="l03866"></a>03866         $Y2 += 0.2;
<a name="l03867"></a>03867 
<a name="l03868"></a>03868         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X1 + $Radius, $Y1, $X2 - $Radius, $Y1, $R, $G, $B);
<a name="l03869"></a>03869         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X2, $Y1 + $Radius, $X2, $Y2 - $Radius, $R, $G, $B);
<a name="l03870"></a>03870         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X2 - $Radius, $Y2, $X1 + $Radius, $Y2, $R, $G, $B);
<a name="l03871"></a>03871         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X1, $Y2 - $Radius, $X1, $Y1 + $Radius, $R, $G, $B);
<a name="l03872"></a>03872     }
<a name="l03873"></a>03873 
<a name="l03888"></a><a class="code" href="classmt_chart.html#49ed36208b1734539834cf757f97adf2">03888</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#49ed36208b1734539834cf757f97adf2">drawFilledRoundedRectangle</a>($X1, $Y1, $X2, $Y2, $Radius = 5, $R, $G, $B) {
<a name="l03889"></a>03889         $C_Rectangle = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l03890"></a>03890 
<a name="l03891"></a>03891         <span class="comment">// Draw the corners first</span>
<a name="l03892"></a>03892         $Step = 90 / ((M_PI * $Radius)/2);
<a name="l03893"></a>03893 
<a name="l03894"></a>03894         <span class="keywordflow">for</span>($i = 0; $i &lt;= 90; $i += $Step) {
<a name="l03895"></a>03895             $Xi1 = cos(($i+180) * M_PI / 180) * $Radius + $X1 + $Radius;
<a name="l03896"></a>03896             $Yi1 = sin(($i+180) * M_PI / 180) * $Radius + $Y1 + $Radius;
<a name="l03897"></a>03897 
<a name="l03898"></a>03898             $Xi2 = cos(($i-90) * M_PI / 180) * $Radius + $X2 - $Radius;
<a name="l03899"></a>03899             $Yi2 = sin(($i-90) * M_PI / 180) * $Radius + $Y1 + $Radius;
<a name="l03900"></a>03900 
<a name="l03901"></a>03901             $Xi3 = cos(($i) * M_PI / 180) * $Radius + $X2 - $Radius;
<a name="l03902"></a>03902             $Yi3 = sin(($i) * M_PI / 180) * $Radius + $Y2 - $Radius;
<a name="l03903"></a>03903 
<a name="l03904"></a>03904             $Xi4 = cos(($i+90) * M_PI / 180) * $Radius + $X1 + $Radius;
<a name="l03905"></a>03905             $Yi4 = sin(($i+90) * M_PI / 180) * $Radius + $Y2 - $Radius;
<a name="l03906"></a>03906 
<a name="l03907"></a>03907             imageline($this-&gt;Picture, $Xi1, $Yi1, $X1+$Radius, $Yi1, $C_Rectangle);
<a name="l03908"></a>03908             imageline($this-&gt;Picture, $X2-$Radius, $Yi2, $Xi2, $Yi2, $C_Rectangle);
<a name="l03909"></a>03909             imageline($this-&gt;Picture, $X2-$Radius, $Yi3, $Xi3, $Yi3, $C_Rectangle);
<a name="l03910"></a>03910             imageline($this-&gt;Picture, $Xi4, $Yi4, $X1+$Radius, $Yi4, $C_Rectangle);
<a name="l03911"></a>03911 
<a name="l03912"></a>03912             $this-&gt;drawAntialiasPixel($Xi1, $Yi1, $R, $G, $B);
<a name="l03913"></a>03913             $this-&gt;drawAntialiasPixel($Xi2, $Yi2, $R, $G, $B);
<a name="l03914"></a>03914             $this-&gt;drawAntialiasPixel($Xi3, $Yi3, $R, $G, $B);
<a name="l03915"></a>03915             $this-&gt;drawAntialiasPixel($Xi4, $Yi4, $R, $G, $B);
<a name="l03916"></a>03916         }
<a name="l03917"></a>03917 
<a name="l03918"></a>03918         <span class="comment">// Fill the rectangle</span>
<a name="l03919"></a>03919         imagefilledrectangle($this-&gt;Picture, $X1, $Y1+$Radius, $X2, $Y2-$Radius, $C_Rectangle);
<a name="l03920"></a>03920         imagefilledrectangle($this-&gt;Picture, $X1+$Radius, $Y1, $X2-$Radius, $Y2, $C_Rectangle);
<a name="l03921"></a>03921 
<a name="l03922"></a>03922         <span class="comment">// Draw antialiased lines between the corners</span>
<a name="l03923"></a>03923         $X1 -= 0.2;
<a name="l03924"></a>03924         $Y1 -= 0.2;
<a name="l03925"></a>03925         $X2 += 0.2;
<a name="l03926"></a>03926         $Y2 += 0.2;
<a name="l03927"></a>03927 
<a name="l03928"></a>03928         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X1 + $Radius, $Y1, $X2 - $Radius, $Y1, $R, $G, $B);
<a name="l03929"></a>03929         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X2, $Y1 + $Radius, $X2, $Y2 - $Radius, $R, $G, $B);
<a name="l03930"></a>03930         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X2 - $Radius, $Y2, $X1 + $Radius, $Y2, $R, $G, $B);
<a name="l03931"></a>03931         $this-&gt;<a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X1, $Y2 - $Radius, $X1, $Y1 + $Radius, $R, $G, $B);
<a name="l03932"></a>03932     }
<a name="l03933"></a>03933 
<a name="l03947"></a><a class="code" href="classmt_chart.html#12b38cf986a753b078510cb68248a5fc">03947</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#12b38cf986a753b078510cb68248a5fc">drawCircle</a>($Xc, $Yc, $Height, $R, $G, $B, $Width = NULL) {
<a name="l03948"></a>03948         <span class="keywordflow">if</span>($Height == 0) {
<a name="l03949"></a>03949             <span class="keywordflow">return</span>;
<a name="l03950"></a>03950         }
<a name="l03951"></a>03951 
<a name="l03952"></a>03952         <span class="keywordflow">if</span>(is_null($Width)) {
<a name="l03953"></a>03953             $Width = $Height;
<a name="l03954"></a>03954         }
<a name="l03955"></a>03955 
<a name="l03956"></a>03956         $C_Circle = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l03957"></a>03957         $Step     = 360 / (2 * M_PI * max($Width, $Height));
<a name="l03958"></a>03958 
<a name="l03959"></a>03959         <span class="keywordflow">for</span>($i = 0; $i &lt;= 360; $i += $Step) {
<a name="l03960"></a>03960             $X = cos($i * M_PI / 180) * $Height + $Xc;
<a name="l03961"></a>03961             $Y = sin($i * M_PI / 180) * $Width + $Yc;
<a name="l03962"></a>03962             $this-&gt;drawAntialiasPixel($X, $Y, $R, $G, $B);
<a name="l03963"></a>03963         }
<a name="l03964"></a>03964     }
<a name="l03965"></a>03965 
<a name="l03979"></a><a class="code" href="classmt_chart.html#052b3ef7036ff7e4c830b69325372a08">03979</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#052b3ef7036ff7e4c830b69325372a08">drawFilledCircle</a>($Xc, $Yc, $Height, $R, $G, $B, $Width = NULL) {
<a name="l03980"></a>03980         <span class="keywordflow">if</span>($Height == 0) {
<a name="l03981"></a>03981             <span class="keywordflow">return</span>;
<a name="l03982"></a>03982         }
<a name="l03983"></a>03983 
<a name="l03984"></a>03984         <span class="keywordflow">if</span>(is_null($Width)) {
<a name="l03985"></a>03985             $Width = $Height;
<a name="l03986"></a>03986         }
<a name="l03987"></a>03987 
<a name="l03988"></a>03988         $C_Circle = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l03989"></a>03989         $Step     = 360 / (2 * M_PI * max($Width, $Height));
<a name="l03990"></a>03990 
<a name="l03991"></a>03991         <span class="keywordflow">for</span>($i = 90; $i &lt;= 270; $i += $Step) {
<a name="l03992"></a>03992             $X1 = cos($i * M_PI / 180) * $Height + $Xc;
<a name="l03993"></a>03993             $Y1 = sin($i * M_PI / 180) * $Width + $Yc;
<a name="l03994"></a>03994             $X2 = cos((180 - $i) * M_PI / 180) * $Height + $Xc;
<a name="l03995"></a>03995             $Y2 = sin((180 - $i) * M_PI / 180) * $Width + $Yc;
<a name="l03996"></a>03996 
<a name="l03997"></a>03997             $this-&gt;drawAntialiasPixel($X1 - 1, $Y1 - 1, $R, $G, $B);
<a name="l03998"></a>03998             $this-&gt;drawAntialiasPixel($X2 - 1, $Y2 - 1, $R, $G, $B);
<a name="l03999"></a>03999 
<a name="l04000"></a>04000             <span class="keywordflow">if</span>(($Y1 - 1) &gt; $Yc - max($Width, $Height)) {
<a name="l04001"></a>04001                 imageline($this-&gt;Picture, $X1, $Y1 - 1, $X2 - 1, $Y2 - 1, $C_Circle);
<a name="l04002"></a>04002             }
<a name="l04003"></a>04003         }
<a name="l04004"></a>04004     }
<a name="l04005"></a>04005 
<a name="l04019"></a><a class="code" href="classmt_chart.html#d68a24e9b5665d4c39df01eaa2ce7c26">04019</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#d68a24e9b5665d4c39df01eaa2ce7c26">drawEllipse</a>($Xc, $Yc, $Height, $Width, $R, $G, $B) {
<a name="l04020"></a>04020         $this-&gt;<a class="code" href="classmt_chart.html#12b38cf986a753b078510cb68248a5fc">drawCircle</a>($Xc, $Yc, $Height, $R, $G, $B, $Width);
<a name="l04021"></a>04021     }
<a name="l04022"></a>04022 
<a name="l04036"></a><a class="code" href="classmt_chart.html#c628cc2093cda477c430de92d1b45147">04036</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#c628cc2093cda477c430de92d1b45147">drawFilledEllipse</a>($Xc, $Yc, $Height, $Width, $R, $G, $B) {
<a name="l04037"></a>04037         $this-&gt;<a class="code" href="classmt_chart.html#052b3ef7036ff7e4c830b69325372a08">drawFilledCircle</a>($Xc, $Yc, $Height, $R, $G, $B, $Width);
<a name="l04038"></a>04038     }
<a name="l04039"></a>04039 
<a name="l04060"></a><a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">04060</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#ea3f2e0e8015d9c56c1e7b34bf319a4e">drawLine</a>($X1, $Y1, $X2, $Y2, $R, $G, $B, $GraphFunction = FALSE) {
<a name="l04061"></a>04061         <span class="keywordflow">if</span>($this-&gt;LineDotSize &gt; 1) {
<a name="l04062"></a>04062             $this-&gt;<a class="code" href="classmt_chart.html#108d0822c67fb29ab139b10bb58ffced">drawDottedLine</a>($X1, $Y1, $X2, $Y2, $this-&gt;LineDotSize, $R, $G, $B, $GraphFunction);
<a name="l04063"></a>04063             <span class="keywordflow">return</span>;
<a name="l04064"></a>04064         }
<a name="l04065"></a>04065 
<a name="l04066"></a>04066         $Distance = sqrt(($X2 - $X1) * ($X2 - $X1) + ($Y2 - $Y1) * ($Y2 - $Y1));
<a name="l04067"></a>04067         <span class="keywordflow">if</span>($Distance == 0) {
<a name="l04068"></a>04068             <span class="keywordflow">return</span>;
<a name="l04069"></a>04069         }
<a name="l04070"></a>04070 
<a name="l04071"></a>04071         $XStep = ($X2 - $X1) / $Distance;
<a name="l04072"></a>04072         $YStep = ($Y2 - $Y1) / $Distance;
<a name="l04073"></a>04073 
<a name="l04074"></a>04074         <span class="keywordflow">for</span>($i = 0; $i &lt;= $Distance; ++$i) {
<a name="l04075"></a>04075             $X = $i * $XStep + $X1;
<a name="l04076"></a>04076             $Y = $i * $YStep + $Y1;
<a name="l04077"></a>04077 
<a name="l04078"></a>04078             <span class="keywordflow">if</span>(($X &gt;= $this-&gt;GArea_X1 &amp;&amp; $X &lt;= $this-&gt;GArea_X2 &amp;&amp; $Y &gt;= $this-&gt;GArea_Y1 &amp;&amp; $Y &lt;= $this-&gt;GArea_Y2) || !$GraphFunction) {
<a name="l04079"></a>04079                 <span class="keywordflow">if</span>($this-&gt;LineWidth == 1) {
<a name="l04080"></a>04080                     $this-&gt;drawAntialiasPixel($X, $Y, $R, $G, $B);
<a name="l04081"></a>04081                 } <span class="keywordflow">else</span> {
<a name="l04082"></a>04082                     $StartOffset = - ($this-&gt;LineWidth / 2);
<a name="l04083"></a>04083                     $EndOffset = $this-&gt;LineWidth / 2;
<a name="l04084"></a>04084 
<a name="l04085"></a>04085                     <span class="keywordflow">for</span>($j = $StartOffset; $j &lt;= $EndOffset; ++$j) {
<a name="l04086"></a>04086                         $this-&gt;drawAntialiasPixel($X + $j, $Y + $j, $R, $G, $B);
<a name="l04087"></a>04087                     }
<a name="l04088"></a>04088                 }
<a name="l04089"></a>04089             }
<a name="l04090"></a>04090         }
<a name="l04091"></a>04091     }
<a name="l04092"></a>04092 
<a name="l04112"></a><a class="code" href="classmt_chart.html#108d0822c67fb29ab139b10bb58ffced">04112</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#108d0822c67fb29ab139b10bb58ffced">drawDottedLine</a>($X1, $Y1, $X2, $Y2, $DotSize, $R, $G, $B, $GraphFunction = FALSE) {
<a name="l04113"></a>04113         $Distance = sqrt(($X2 - $X1) * ($X2 - $X1) + ($Y2 - $Y1) * ($Y2 - $Y1));
<a name="l04114"></a>04114 
<a name="l04115"></a>04115         $XStep = ($X2 - $X1) / $Distance;
<a name="l04116"></a>04116         $YStep = ($Y2 - $Y1) / $Distance;
<a name="l04117"></a>04117 
<a name="l04118"></a>04118         $DotIndex = 0;
<a name="l04119"></a>04119         <span class="keywordflow">for</span>($i = 0; $i &lt;= $Distance; ++$i) {
<a name="l04120"></a>04120             $X = $i * $XStep + $X1;
<a name="l04121"></a>04121             $Y = $i * $YStep + $Y1;
<a name="l04122"></a>04122 
<a name="l04123"></a>04123             <span class="keywordflow">if</span>($DotIndex &lt;= $DotSize) {
<a name="l04124"></a>04124                 <span class="keywordflow">if</span>(($X &gt;= $this-&gt;GArea_X1 &amp;&amp; $X &lt;= $this-&gt;GArea_X2 &amp;&amp; $Y &gt;= $this-&gt;GArea_Y1 &amp;&amp; $Y &lt;= $this-&gt;GArea_Y2) || !$GraphFunction) {
<a name="l04125"></a>04125                     <span class="keywordflow">if</span>($this-&gt;LineWidth == 1) {
<a name="l04126"></a>04126                         $this-&gt;drawAntialiasPixel($X, $Y, $R, $G, $B);
<a name="l04127"></a>04127                     } <span class="keywordflow">else</span> {
<a name="l04128"></a>04128                         $StartOffset = - ($this-&gt;LineWidth / 2);
<a name="l04129"></a>04129                         $EndOffset = $this-&gt;LineWidth / 2;
<a name="l04130"></a>04130 
<a name="l04131"></a>04131                         <span class="keywordflow">for</span>($j = $StartOffset; $j &lt;= $EndOffset; ++$j) {
<a name="l04132"></a>04132                             $this-&gt;drawAntialiasPixel($X + $j, $Y + $j, $R, $G, $B);
<a name="l04133"></a>04133                         }
<a name="l04134"></a>04134                     }
<a name="l04135"></a>04135                 }
<a name="l04136"></a>04136             }
<a name="l04137"></a>04137 
<a name="l04138"></a>04138             ++$DotIndex;
<a name="l04139"></a>04139             <span class="keywordflow">if</span>($DotIndex == $DotSize * 2) {
<a name="l04140"></a>04140                 $DotIndex = 0;
<a name="l04141"></a>04141             }
<a name="l04142"></a>04142         }
<a name="l04143"></a>04143     }
<a name="l04144"></a>04144 
<a name="l04156"></a><a class="code" href="classmt_chart.html#af93fded8c15a707b95727e1ade60d9a">04156</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#af93fded8c15a707b95727e1ade60d9a">drawFromPNG</a>($FileName, $X, $Y, $Alpha = 100) {
<a name="l04157"></a>04157         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classmt_chart.html#8453f42b6f14e136d9d8b64a9e0bc2c2">drawFromPicture</a>(1, $FileName, $X, $Y, $Alpha);
<a name="l04158"></a>04158     }
<a name="l04159"></a>04159 
<a name="l04171"></a><a class="code" href="classmt_chart.html#3e93adab712580462c8847fba08c48d8">04171</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#3e93adab712580462c8847fba08c48d8">drawFromGIF</a>($FileName, $X, $Y, $Alpha = 100) {
<a name="l04172"></a>04172         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classmt_chart.html#8453f42b6f14e136d9d8b64a9e0bc2c2">drawFromPicture</a>(2, $FileName, $X, $Y, $Alpha);
<a name="l04173"></a>04173     }
<a name="l04174"></a>04174 
<a name="l04186"></a><a class="code" href="classmt_chart.html#ab353fe17bf121ffb22a522c11ce33db">04186</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#ab353fe17bf121ffb22a522c11ce33db">drawFromJPG</a>($FileName, $X, $Y, $Alpha = 100) {
<a name="l04187"></a>04187         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classmt_chart.html#8453f42b6f14e136d9d8b64a9e0bc2c2">drawFromPicture</a>(3, $FileName, $X, $Y, $Alpha);
<a name="l04188"></a>04188     }
<a name="l04189"></a>04189 
<a name="l04205"></a><a class="code" href="classmt_chart.html#8453f42b6f14e136d9d8b64a9e0bc2c2">04205</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#8453f42b6f14e136d9d8b64a9e0bc2c2">drawFromPicture</a>($PicType, $FileName, $X, $Y, $Alpha = 100) {
<a name="l04206"></a>04206         <span class="keywordflow">if</span>(file_exists($FileName)) {
<a name="l04207"></a>04207             $Infos  = getimagesize($FileName);
<a name="l04208"></a>04208             $Width  = $Infos[0];
<a name="l04209"></a>04209             $Height = $Infos[1];
<a name="l04210"></a>04210             <span class="keywordflow">switch</span>(strtolower($PicType)) {
<a name="l04211"></a>04211                 <span class="keywordflow">default</span>: <span class="comment">// Break intentionally omitted</span>
<a name="l04212"></a>04212                 <span class="keywordflow">case</span> 1:
<a name="l04213"></a>04213                 <span class="keywordflow">case</span> <span class="stringliteral">'png'</span>:
<a name="l04214"></a>04214                     $Raster = imagecreatefrompng($FileName);
<a name="l04215"></a>04215                     <span class="keywordflow">break</span>;
<a name="l04216"></a>04216                 <span class="keywordflow">case</span> 2:
<a name="l04217"></a>04217                 <span class="keywordflow">case</span> <span class="stringliteral">'gif'</span>:
<a name="l04218"></a>04218                     $Raster = imagecreatefromgif($FileName);
<a name="l04219"></a>04219                     <span class="keywordflow">break</span>;
<a name="l04220"></a>04220                 <span class="keywordflow">case</span> 3:
<a name="l04221"></a>04221                 <span class="keywordflow">case</span> <span class="stringliteral">'jpeg'</span>:
<a name="l04222"></a>04222                 <span class="keywordflow">case</span> <span class="stringliteral">'jpg'</span>:
<a name="l04223"></a>04223                     $Raster = imagecreatefromjpeg($FileName);
<a name="l04224"></a>04224                     <span class="keywordflow">break</span>;
<a name="l04225"></a>04225             }
<a name="l04226"></a>04226 
<a name="l04227"></a>04227             imagecopymerge($this-&gt;Picture, $Raster, $X, $Y, 0, 0, $Width, $Height, $Alpha);
<a name="l04228"></a>04228             imagedestroy($Raster);
<a name="l04229"></a>04229             <span class="keywordflow">return</span> TRUE;
<a name="l04230"></a>04230         } <span class="keywordflow">else</span> {
<a name="l04231"></a>04231             <span class="keywordflow">return</span> FALSE;
<a name="l04232"></a>04232         }
<a name="l04233"></a>04233     }
<a name="l04234"></a>04234 
<a name="l04245"></a><a class="code" href="classmt_chart.html#fe90ef916f13d3033ffaf544220305a1">04245</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#fe90ef916f13d3033ffaf544220305a1">drawAlphaPixel</a>($X, $Y, $Alpha, $R, $G, $B) {
<a name="l04246"></a>04246         <span class="keywordflow">if</span>($X &lt; 0 || $Y &lt; 0 || $X &gt;= $this-&gt;XSize || $Y &gt;= $this-&gt;YSize) {
<a name="l04247"></a>04247             <span class="keywordflow">return</span>;
<a name="l04248"></a>04248         }
<a name="l04249"></a>04249 
<a name="l04250"></a>04250         $RGB2 = imagecolorat($this-&gt;Picture, $X, $Y);
<a name="l04251"></a>04251         $R2   = ($RGB2 &gt;&gt; 16) &amp; 0xFF;
<a name="l04252"></a>04252         $G2   = ($RGB2 &gt;&gt; 8) &amp; 0xFF;
<a name="l04253"></a>04253         $B2   = $RGB2 &amp; 0xFF;
<a name="l04254"></a>04254 
<a name="l04255"></a>04255         $iAlpha = (100 - $Alpha)/100;
<a name="l04256"></a>04256         $Alpha  = $Alpha / 100;
<a name="l04257"></a>04257 
<a name="l04258"></a>04258         $Ra   = floor($R * $Alpha + $R2 * $iAlpha);
<a name="l04259"></a>04259         $Ga   = floor($G * $Alpha + $G2 * $iAlpha);
<a name="l04260"></a>04260         $Ba   = floor($B * $Alpha + $B2 * $iAlpha);
<a name="l04261"></a>04261 
<a name="l04262"></a>04262         $C_Aliased = $this-&gt;AllocateColor($this-&gt;Picture, $Ra, $Ga, $Ba);
<a name="l04263"></a>04263         imagesetpixel($this-&gt;Picture, $X, $Y, $C_Aliased);
<a name="l04264"></a>04264     }
<a name="l04265"></a>04265 
<a name="l04279"></a>04279     <span class="keyword">private</span> function AllocateColor($Picture, $R, $G, $B, $Factor = 0) {
<a name="l04280"></a>04280         $R = round($R + $Factor);
<a name="l04281"></a>04281         $G = round($G + $Factor);
<a name="l04282"></a>04282         $B = round($B + $Factor);
<a name="l04283"></a>04283         <span class="keywordflow">if</span>($R &lt; 0) { $R = 0; } <span class="keywordflow">if</span>($R &gt; 255) { $R = 255; }
<a name="l04284"></a>04284         <span class="keywordflow">if</span>($G &lt; 0) { $G = 0; } <span class="keywordflow">if</span>($G &gt; 255) { $G = 255; }
<a name="l04285"></a>04285         <span class="keywordflow">if</span>($B &lt; 0) { $B = 0; } <span class="keywordflow">if</span>($B &gt; 255) { $B = 255; }
<a name="l04286"></a>04286 
<a name="l04287"></a>04287         <span class="keywordflow">return</span> imagecolorallocate($Picture, $R, $G, $B);
<a name="l04288"></a>04288     }
<a name="l04289"></a>04289 
<a name="l04303"></a><a class="code" href="classmt_chart.html#0d48a23d23a782b48f7c952a18304607">04303</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#0d48a23d23a782b48f7c952a18304607">addBorder</a>($Size = 3, $R = 0, $G = 0, $B = 0) {
<a name="l04304"></a>04304         $Width  = $this-&gt;XSize + 2 * $Size;
<a name="l04305"></a>04305         $Height = $this-&gt;YSize + 2 * $Size;
<a name="l04306"></a>04306 
<a name="l04307"></a>04307         $Resampled    = imagecreatetruecolor($Width, $Height);
<a name="l04308"></a>04308         $C_Background = $this-&gt;AllocateColor($Resampled, $R, $G, $B);
<a name="l04309"></a>04309         imagefilledrectangle($Resampled, 0, 0, $Width, $Height, $C_Background);
<a name="l04310"></a>04310 
<a name="l04311"></a>04311         imagecopy($Resampled, $this-&gt;Picture, $Size, $Size, 0, 0, $this-&gt;XSize, $this-&gt;YSize);
<a name="l04312"></a>04312         imagedestroy($this-&gt;Picture);
<a name="l04313"></a>04313 
<a name="l04314"></a>04314         $this-&gt;XSize = $Width;
<a name="l04315"></a>04315         $this-&gt;YSize = $Height;
<a name="l04316"></a>04316 
<a name="l04317"></a>04317         $this-&gt;Picture = imagecreatetruecolor($this-&gt;XSize, $this-&gt;YSize);
<a name="l04318"></a>04318         $C_White = $this-&gt;AllocateColor($this-&gt;Picture, 255, 255, 255);
<a name="l04319"></a>04319         imagefilledrectangle($this-&gt;Picture, 0, 0, $this-&gt;XSize, $this-&gt;YSize, $C_White);
<a name="l04320"></a>04320         imagecolortransparent($this-&gt;Picture, $C_White);
<a name="l04321"></a>04321         imagecopy($this-&gt;Picture, $Resampled, 0, 0, 0, 0, $this-&gt;XSize, $this-&gt;YSize);
<a name="l04322"></a>04322     }
<a name="l04323"></a>04323 
<a name="l04329"></a><a class="code" href="classmt_chart.html#bfb3ced4d69984c88c65aab62cc3c9c9">04329</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#bfb3ced4d69984c88c65aab62cc3c9c9">setInterval</a>($XInterval = 1) {
<a name="l04330"></a>04330         $this-&gt;XInterval = $XInterval;
<a name="l04331"></a>04331     }
<a name="l04332"></a>04332 
<a name="l04341"></a><a class="code" href="classmt_chart.html#495303c9da5ad06cad6af44250045dd8">04341</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#495303c9da5ad06cad6af44250045dd8">setAntialiasQuality</a>($quality = 0) {
<a name="l04342"></a>04342         $this-&gt;AntialiasQuality = min(100, max(0, (<span class="keywordtype">int</span>) $quality));
<a name="l04343"></a>04343     }
<a name="l04344"></a>04344 
<a name="l04350"></a><a class="code" href="classmt_chart.html#eaf5836a89511083e3c6ecc484335356">04350</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#eaf5836a89511083e3c6ecc484335356">setMinDivHeight</a>($pixels = 25) {
<a name="l04351"></a>04351         $this-&gt;MinDivHeight = $pixels;
<a name="l04352"></a>04352     }
<a name="l04353"></a>04353 
<a name="l04360"></a><a class="code" href="classmt_chart.html#1d47c1bc94214594a36218a7dc2535fb">04360</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#1d47c1bc94214594a36218a7dc2535fb">render</a>($FileName) {
<a name="l04361"></a>04361         <span class="comment">// Spell out errors</span>
<a name="l04362"></a>04362         <span class="keywordflow">if</span>($this-&gt;ErrorReporting) {
<a name="l04363"></a>04363             $this-&gt;printErrors($this-&gt;ErrorInterface);
<a name="l04364"></a>04364         }
<a name="l04365"></a>04365 
<a name="l04366"></a>04366         <span class="comment">// Save image map</span>
<a name="l04367"></a>04367         <span class="keywordflow">if</span>($this-&gt;BuildMap) {
<a name="l04368"></a>04368             $this-&gt;SaveImageMap();
<a name="l04369"></a>04369         }
<a name="l04370"></a>04370 
<a name="l04371"></a>04371         <span class="comment">// Cache if necessary</span>
<a name="l04372"></a>04372         <span class="keywordflow">if</span>($this-&gt;CacheEnabled) {
<a name="l04373"></a>04373             $this-&gt;<a class="code" href="classmt_chart.html#222dd2bd1246890f48322895b0936699">writeToCache</a>();
<a name="l04374"></a>04374         }
<a name="l04375"></a>04375 
<a name="l04376"></a>04376 
<a name="l04377"></a>04377         <span class="comment">// Save image</span>
<a name="l04378"></a>04378         $success = imagepng($this-&gt;Picture, $FileName);
<a name="l04379"></a>04379 
<a name="l04380"></a>04380         <span class="keywordflow">return</span> $success;
<a name="l04381"></a>04381     }
<a name="l04382"></a>04382 
<a name="l04388"></a><a class="code" href="classmt_chart.html#1991a97282c68ad118b460031d1216e7">04388</a>     function <a class="code" href="classmt_chart.html#1991a97282c68ad118b460031d1216e7">stroke</a>() {
<a name="l04389"></a>04389         <span class="comment">// Draw errors</span>
<a name="l04390"></a>04390         <span class="keywordflow">if</span>($this-&gt;ErrorReporting) {
<a name="l04391"></a>04391             $this-&gt;printErrors(<span class="stringliteral">'GD'</span>);
<a name="l04392"></a>04392         }
<a name="l04393"></a>04393 
<a name="l04394"></a>04394         <span class="comment">// Save image map</span>
<a name="l04395"></a>04395         <span class="keywordflow">if</span>($this-&gt;BuildMap) {
<a name="l04396"></a>04396             $this-&gt;SaveImageMap();
<a name="l04397"></a>04397         }
<a name="l04398"></a>04398 
<a name="l04399"></a>04399         <span class="comment">// Cache if necessary</span>
<a name="l04400"></a>04400         <span class="keywordflow">if</span>($this-&gt;CacheEnabled) {
<a name="l04401"></a>04401             $this-&gt;<a class="code" href="classmt_chart.html#222dd2bd1246890f48322895b0936699">writeToCache</a>();
<a name="l04402"></a>04402         }
<a name="l04403"></a>04403 
<a name="l04404"></a>04404         <span class="comment">// Output picture</span>
<a name="l04405"></a>04405         header(<span class="stringliteral">'Content-type: image/png'</span>);
<a name="l04406"></a>04406         $success = imagepng($this-&gt;Picture);
<a name="l04407"></a>04407 
<a name="l04408"></a>04408         <span class="keywordflow">return</span> $success;
<a name="l04409"></a>04409     }
<a name="l04410"></a>04410 
<a name="l04424"></a>04424     <span class="keyword">private</span> function drawAntialiasPixel($X, $Y, $R, $G, $B, $Alpha = 100, $NoFallBack = FALSE) {
<a name="l04425"></a>04425         <span class="comment">// Shadow</span>
<a name="l04426"></a>04426         <span class="keywordflow">if</span>($this-&gt;ShadowActive &amp;&amp; !$NoFallBack) {
<a name="l04427"></a>04427             $this-&gt;drawAntialiasPixel($X + $this-&gt;ShadowXDistance, $Y + $this-&gt;ShadowYDistance, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor, $this-&gt;ShadowAlpha, TRUE);
<a name="l04428"></a>04428             <span class="keywordflow">if</span>($this-&gt;ShadowBlur) {
<a name="l04429"></a>04429                 $AlphaDecay = ($this-&gt;ShadowAlpha / $this-&gt;ShadowBlur);
<a name="l04430"></a>04430 
<a name="l04431"></a>04431                 <span class="keywordflow">for</span>($i = 1; $i &lt;= $this-&gt;ShadowBlur; ++$i) {
<a name="l04432"></a>04432                     $this-&gt;drawAntialiasPixel($X + $this-&gt;ShadowXDistance - $i / 2, $Y + $this-&gt;ShadowYDistance - $i / 2, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor, $this-&gt;ShadowAlpha - $AlphaDecay * $i, TRUE);
<a name="l04433"></a>04433                 }
<a name="l04434"></a>04434                 <span class="keywordflow">for</span>($i = 1; $i &lt;= $this-&gt;ShadowBlur; ++$i) {
<a name="l04435"></a>04435                     $this-&gt;drawAntialiasPixel($X + $this-&gt;ShadowXDistance + $i / 2, $Y + $this-&gt;ShadowYDistance + $i / 2, $this-&gt;ShadowRColor, $this-&gt;ShadowGColor, $this-&gt;ShadowBColor, $this-&gt;ShadowAlpha - $AlphaDecay * $i, TRUE);
<a name="l04436"></a>04436                 }
<a name="l04437"></a>04437             }
<a name="l04438"></a>04438         }
<a name="l04439"></a>04439 
<a name="l04440"></a>04440         $Plot = array();
<a name="l04441"></a>04441         $Xi   = floor($X);
<a name="l04442"></a>04442         $Yi   = floor($Y);
<a name="l04443"></a>04443 
<a name="l04444"></a>04444         <span class="keywordflow">if</span>($Xi == $X &amp;&amp; $Yi == $Y) {
<a name="l04445"></a>04445             <span class="keywordflow">if</span>($Alpha == 100) {
<a name="l04446"></a>04446                 $C_Aliased = $this-&gt;AllocateColor($this-&gt;Picture, $R, $G, $B);
<a name="l04447"></a>04447                 imagesetpixel($this-&gt;Picture, $X, $Y, $C_Aliased);
<a name="l04448"></a>04448             } <span class="keywordflow">else</span> {
<a name="l04449"></a>04449                 $this-&gt;<a class="code" href="classmt_chart.html#fe90ef916f13d3033ffaf544220305a1">drawAlphaPixel</a>($X, $Y, $Alpha, $R, $G, $B);
<a name="l04450"></a>04450             }
<a name="l04451"></a>04451         } <span class="keywordflow">else</span> {
<a name="l04452"></a>04452             $Alpha1 = (((1 - ($X - floor($X))) * (1 - ($Y - floor($Y))) * 100) / 100) * $Alpha;
<a name="l04453"></a>04453             <span class="keywordflow">if</span>($Alpha1 &gt; $this-&gt;AntialiasQuality) { $this-&gt;<a class="code" href="classmt_chart.html#fe90ef916f13d3033ffaf544220305a1">drawAlphaPixel</a>($Xi, $Yi, $Alpha1, $R, $G, $B); }
<a name="l04454"></a>04454 
<a name="l04455"></a>04455             $Alpha2 = ((($X - floor($X)) * (1 - ($Y - floor($Y))) * 100) / 100) * $Alpha;
<a name="l04456"></a>04456             <span class="keywordflow">if</span>($Alpha2 &gt; $this-&gt;AntialiasQuality) { $this-&gt;<a class="code" href="classmt_chart.html#fe90ef916f13d3033ffaf544220305a1">drawAlphaPixel</a>($Xi+1, $Yi, $Alpha2, $R, $G, $B); }
<a name="l04457"></a>04457 
<a name="l04458"></a>04458             $Alpha3 = (((1 - ($X - floor($X))) * ($Y - floor($Y)) * 100) / 100) * $Alpha;
<a name="l04459"></a>04459             <span class="keywordflow">if</span>($Alpha3 &gt; $this-&gt;AntialiasQuality) { $this-&gt;<a class="code" href="classmt_chart.html#fe90ef916f13d3033ffaf544220305a1">drawAlphaPixel</a>($Xi, $Yi+1, $Alpha3, $R, $G, $B); }
<a name="l04460"></a>04460 
<a name="l04461"></a>04461             $Alpha4 = ((($X - floor($X)) * ($Y - floor($Y)) * 100) / 100) * $Alpha;
<a name="l04462"></a>04462             <span class="keywordflow">if</span>($Alpha4 &gt; $this-&gt;AntialiasQuality) { $this-&gt;<a class="code" href="classmt_chart.html#fe90ef916f13d3033ffaf544220305a1">drawAlphaPixel</a>($Xi+1, $Yi+1, $Alpha4, $R, $G, $B); }
<a name="l04463"></a>04463         }
<a name="l04464"></a>04464     }
<a name="l04465"></a>04465 
<a name="l04478"></a>04478     <span class="keyword">private</span> function validateDataDescription($FunctionName, $DescriptionRequired= TRUE) {
<a name="l04479"></a>04479         <span class="keywordflow">if</span>(!isset($this-&gt;DataDescription[<span class="stringliteral">'Position'</span>])) {
<a name="l04480"></a>04480             $this-&gt;Errors[] = <span class="stringliteral">'[Warning] '</span>.$FunctionName.<span class="stringliteral">' - Y Labels are not set.'</span>;
<a name="l04481"></a>04481             $this-&gt;DataDescription[<span class="stringliteral">'Position'</span>] = <span class="stringliteral">'Name'</span>;
<a name="l04482"></a>04482         }
<a name="l04483"></a>04483 
<a name="l04484"></a>04484         <span class="keywordflow">if</span>($DescriptionRequired) {
<a name="l04485"></a>04485             <span class="keywordflow">if</span>(!isset($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>])) {
<a name="l04486"></a>04486                 $this-&gt;Errors[] = <span class="stringliteral">'[Warning] '</span>.$FunctionName.<span class="stringliteral">' - Series descriptions are not set.'</span>;
<a name="l04487"></a>04487                 <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $key =&gt; $Value) {
<a name="l04488"></a>04488                     $this-&gt;DataDescription[<span class="stringliteral">'Description'</span>][$Value] = $Value;
<a name="l04489"></a>04489                 }
<a name="l04490"></a>04490             }
<a name="l04491"></a>04491 
<a name="l04492"></a>04492             <span class="keywordflow">if</span>(count($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>]) &lt; count($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>])) {
<a name="l04493"></a>04493                 $this-&gt;Errors[] = <span class="stringliteral">'[Warning] '</span>.$FunctionName.<span class="stringliteral">' - Some series descriptions are not set.'</span>;
<a name="l04494"></a>04494                 <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $key =&gt; $Value) {
<a name="l04495"></a>04495                     <span class="keywordflow">if</span>(!isset($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>][$Value]))
<a name="l04496"></a>04496                     $this-&gt;DataDescription[<span class="stringliteral">'Description'</span>][$Value] = $Value;
<a name="l04497"></a>04497                 }
<a name="l04498"></a>04498             }
<a name="l04499"></a>04499         }
<a name="l04500"></a>04500     }
<a name="l04501"></a>04501 
<a name="l04509"></a>04509     <span class="keyword">private</span> function validateData($FunctionName) {
<a name="l04510"></a>04510         $this-&gt;DataSummary = array();
<a name="l04511"></a>04511 
<a name="l04512"></a>04512         <span class="keywordflow">foreach</span>($this-&gt;Data as $key =&gt; $Values) {
<a name="l04513"></a>04513             <span class="keywordflow">foreach</span>($Values as $key2 =&gt; $Value) {
<a name="l04514"></a>04514                 <span class="keywordflow">if</span>(!isset($this-&gt;DataSummary[$key2])) {
<a name="l04515"></a>04515                     $this-&gt;DataSummary[$key2] = 1;
<a name="l04516"></a>04516                 } <span class="keywordflow">else</span> {
<a name="l04517"></a>04517                     ++$this-&gt;DataSummary[$key2];
<a name="l04518"></a>04518                 }
<a name="l04519"></a>04519             }
<a name="l04520"></a>04520         }
<a name="l04521"></a>04521 
<a name="l04522"></a>04522         <span class="keywordflow">if</span>(max($this-&gt;DataSummary) == 0) {
<a name="l04523"></a>04523             $this-&gt;Errors[] = <span class="stringliteral">'[Warning] '</span>.$FunctionName.<span class="stringliteral">' - No data set.'</span>;
<a name="l04524"></a>04524         }
<a name="l04525"></a>04525 
<a name="l04526"></a>04526         <span class="keywordflow">foreach</span>($this-&gt;DataSummary as $key =&gt; $Value) {
<a name="l04527"></a>04527             <span class="keywordflow">if</span>($Value &lt; max($this-&gt;DataSummary)) {
<a name="l04528"></a>04528                 $this-&gt;Errors[] = <span class="stringliteral">'[Warning] '</span>.$FunctionName.<span class="stringliteral">' - Missing data in serie '</span>.$key.<span class="charliteral">'.'</span>;
<a name="l04529"></a>04529             }
<a name="l04530"></a>04530         }
<a name="l04531"></a>04531     }
<a name="l04532"></a>04532 
<a name="l04542"></a>04542     <span class="keyword">private</span> function printErrors($Mode = <span class="stringliteral">'CLI'</span>) {
<a name="l04543"></a>04543         <span class="comment">// No errors found? Nothing to display, so exit.</span>
<a name="l04544"></a>04544         <span class="keywordflow">if</span>(count($this-&gt;Errors) == 0) {
<a name="l04545"></a>04545             <span class="keywordflow">return</span>;
<a name="l04546"></a>04546         }
<a name="l04547"></a>04547 
<a name="l04548"></a>04548         <span class="keywordflow">switch</span>(strtoupper($Mode)) {
<a name="l04549"></a>04549             <span class="keywordflow">default</span>: <span class="comment">// Break intentionally omitted</span>
<a name="l04550"></a>04550             <span class="keywordflow">case</span> <span class="stringliteral">'CLI'</span>:
<a name="l04551"></a>04551                 <span class="keywordflow">foreach</span>($this-&gt;Errors as $key =&gt; $Value) {
<a name="l04552"></a>04552                     echo $Value . <span class="stringliteral">"\n"</span>;
<a name="l04553"></a>04553                 }
<a name="l04554"></a>04554                 <span class="keywordflow">break</span>;
<a name="l04555"></a>04555             <span class="keywordflow">case</span> <span class="stringliteral">'GD'</span>:
<a name="l04556"></a>04556                 $this-&gt;<a class="code" href="classmt_chart.html#071db8e7b915876b9840df3fe47a2ce2">setLineStyle</a>(1);
<a name="l04557"></a>04557                 $MaxWidth = 0;
<a name="l04558"></a>04558                 $errorFont = realpath(dirname(__FILE__) . <span class="charliteral">'/'</span> . $this-&gt;ErrorFontName);
<a name="l04559"></a>04559                 <span class="keywordflow">foreach</span>($this-&gt;Errors as $key =&gt; $Value) {
<a name="l04560"></a>04560                     $Position  = imageftbbox($this-&gt;ErrorFontSize, 0, $errorFont, utf8_decode($Value));
<a name="l04561"></a>04561                     $TextWidth = $Position[2] - $Position[0];
<a name="l04562"></a>04562                     $MaxWidth = max($MaxWidth, $TextWidth);
<a name="l04563"></a>04563                 }
<a name="l04564"></a>04564 
<a name="l04565"></a>04565                 $this-&gt;<a class="code" href="classmt_chart.html#49ed36208b1734539834cf757f97adf2">drawFilledRoundedRectangle</a>($this-&gt;XSize - ($MaxWidth + 20), $this-&gt;YSize - (20 + (($this-&gt;ErrorFontSize + 4) * count($this-&gt;Errors))), $this-&gt;XSize - 10, $this-&gt;YSize - 10, 6, 233, 185, 185);
<a name="l04566"></a>04566                 $this-&gt;<a class="code" href="classmt_chart.html#9cab5346037ff8cb42012cdb937948e2">drawRoundedRectangle</a>($this-&gt;XSize - ($MaxWidth + 20), $this-&gt;YSize - (20 + (($this-&gt;ErrorFontSize + 4) * count($this-&gt;Errors))), $this-&gt;XSize - 10, $this-&gt;YSize - 10, 6, 193, 145, 145);
<a name="l04567"></a>04567 
<a name="l04568"></a>04568                 $C_TextColor = $this-&gt;AllocateColor($this-&gt;Picture, 133, 85, 85);
<a name="l04569"></a>04569                 $YPos        = $this-&gt;YSize - (18 + (count($this-&gt;Errors) - 1) * ($this-&gt;ErrorFontSize + 4));
<a name="l04570"></a>04570                 <span class="keywordflow">foreach</span>($this-&gt;Errors as $key =&gt; $Value) {
<a name="l04571"></a>04571                     imagettftext($this-&gt;Picture, $this-&gt;ErrorFontSize, 0, $this-&gt;XSize - ($MaxWidth + 15), $YPos, $C_TextColor, $errorFont, utf8_decode($Value));
<a name="l04572"></a>04572                     $YPos += ($this-&gt;ErrorFontSize + 4);
<a name="l04573"></a>04573                 }
<a name="l04574"></a>04574                 <span class="keywordflow">break</span>;
<a name="l04575"></a>04575         }
<a name="l04576"></a>04576     }
<a name="l04577"></a>04577 
<a name="l04584"></a><a class="code" href="classmt_chart.html#844d1333176bf535f4defdf59ec5b08d">04584</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#844d1333176bf535f4defdf59ec5b08d">setImageMap</a>($BuildMap = TRUE, $GraphID = <span class="stringliteral">'MyGraph'</span>) {
<a name="l04585"></a>04585         $this-&gt;BuildMap = $BuildMap;
<a name="l04586"></a>04586         $this-&gt;MapID    = $GraphID;
<a name="l04587"></a>04587     }
<a name="l04588"></a>04588 
<a name="l04600"></a>04600     <span class="keyword">private</span> function addToImageMap($X1, $Y1, $X2, $Y2, $SerieName, $Value, $CallerFunction) {
<a name="l04601"></a>04601         <span class="keywordflow">if</span>(is_null($this-&gt;MapFunction) || $this-&gt;MapFunction == $CallerFunction) {
<a name="l04602"></a>04602             $this-&gt;ImageMap[]  = round($X1).<span class="charliteral">','</span>.round($Y1).<span class="charliteral">','</span>.round($X2).<span class="charliteral">','</span>.round($Y2).<span class="charliteral">','</span>.$SerieName.<span class="charliteral">','</span>.$Value;
<a name="l04603"></a>04603             $this-&gt;MapFunction = $CallerFunction;
<a name="l04604"></a>04604         }
<a name="l04605"></a>04605     }
<a name="l04606"></a>04606 
<a name="l04620"></a><a class="code" href="classmt_chart.html#c7d0757b98de72c0e6022acef8fb9877">04620</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#c7d0757b98de72c0e6022acef8fb9877">getImageMap</a>($MapName, $Flush = TRUE) {
<a name="l04621"></a>04621         <span class="comment">// Strip HTML query strings</span>
<a name="l04622"></a>04622         $Values   = $this-&gt;tmpFolder . $MapName;
<a name="l04623"></a>04623         $Value    = split(<span class="charliteral">'\?'</span>, $Values);
<a name="l04624"></a>04624         $FileName = $Value[0];
<a name="l04625"></a>04625 
<a name="l04626"></a>04626         <span class="keywordflow">if</span>(file_exists($FileName)) {
<a name="l04627"></a>04627             readfile($FileName);
<a name="l04628"></a>04628             <span class="keywordflow">if</span>($Flush) {
<a name="l04629"></a>04629                 unlink($FileName);
<a name="l04630"></a>04630             }
<a name="l04631"></a>04631         } <span class="keywordflow">else</span> {
<a name="l04632"></a>04632             header(<span class="stringliteral">'HTTP/1.0 404 Not Found'</span>);
<a name="l04633"></a>04633         }
<a name="l04634"></a>04634         exit();
<a name="l04635"></a>04635     }
<a name="l04636"></a>04636 
<a name="l04642"></a><a class="code" href="classmt_chart.html#1a5d1601fdb6b84cb37e64caf5103a8f">04642</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#1a5d1601fdb6b84cb37e64caf5103a8f">saveImageMap</a>() {
<a name="l04643"></a>04643         <span class="keywordflow">if</span>(!$this-&gt;BuildMap) {
<a name="l04644"></a>04644             <span class="keywordflow">return</span> FALSE;
<a name="l04645"></a>04645         }
<a name="l04646"></a>04646 
<a name="l04647"></a>04647         <span class="keywordflow">if</span>(is_null($this-&gt;ImageMap)) {
<a name="l04648"></a>04648             $this-&gt;Errors[] = <span class="stringliteral">'[Warning] SaveImageMap - Image map is empty.'</span>;
<a name="l04649"></a>04649             <span class="keywordflow">return</span> FALSE;
<a name="l04650"></a>04650         }
<a name="l04651"></a>04651 
<a name="l04652"></a>04652         $Handle = fopen($this-&gt;tmpFolder.$this-&gt;MapID, <span class="charliteral">'w'</span>);
<a name="l04653"></a>04653 
<a name="l04654"></a>04654         <span class="keywordflow">if</span>(!$Handle) {
<a name="l04655"></a>04655             $this-&gt;Errors[] = <span class="stringliteral">'[Warning] SaveImageMap - Cannot save the image map.'</span>;
<a name="l04656"></a>04656             <span class="keywordflow">return</span> FALSE;
<a name="l04657"></a>04657         } <span class="keywordflow">else</span> {
<a name="l04658"></a>04658             <span class="keywordflow">foreach</span>($this-&gt;ImageMap as $Value) {
<a name="l04659"></a>04659                 fwrite($Handle, htmlentities($Value) . <span class="stringliteral">"\n"</span>);
<a name="l04660"></a>04660             }
<a name="l04661"></a>04661         }
<a name="l04662"></a>04662         fclose ($Handle);
<a name="l04663"></a>04663         <span class="keywordflow">return</span> TRUE;
<a name="l04664"></a>04664     }
<a name="l04665"></a>04665 
<a name="l04672"></a><a class="code" href="classmt_chart.html#e0aa1f176e44a9a988e3f28dce721eed">04672</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#e0aa1f176e44a9a988e3f28dce721eed">setTempDir</a>($TempDir) {
<a name="l04673"></a>04673         <span class="keywordflow">if</span>(is_writable($TempDir)) {
<a name="l04674"></a>04674             $this-&gt;tmpFolder = realpath($TempDir) . DIRECTORY_SEPARATOR;
<a name="l04675"></a>04675             <span class="keywordflow">return</span> TRUE;
<a name="l04676"></a>04676         } <span class="keywordflow">else</span> {
<a name="l04677"></a>04677             $this-&gt;Errors[] = <span class="stringliteral">'[Warning] SetTempDir - Directory '</span> . $TempDir . <span class="stringliteral">' not writable.'</span>;
<a name="l04678"></a>04678             <span class="keywordflow">return</span> FALSE;
<a name="l04679"></a>04679         }
<a name="l04680"></a>04680     }
<a name="l04681"></a>04681 
<a name="l04691"></a>04691     <span class="keyword">private</span> function ToTime($Value) {
<a name="l04692"></a>04692         $Value -= date(<span class="charliteral">'Z'</span>); <span class="comment">// Timezone correction</span>
<a name="l04693"></a>04693         <span class="keywordflow">return</span> date($this-&gt;TimeFormat, $Value);
<a name="l04694"></a>04694     }
<a name="l04695"></a>04695 
<a name="l04704"></a>04704     <span class="keyword">private</span> function ToMetric($Value) {
<a name="l04705"></a>04705         $Go = floor($Value/1000000000);
<a name="l04706"></a>04706         $Mo = floor(($Value - $Go*1000000000)/1000000);
<a name="l04707"></a>04707         $Ko = floor(($Value - $Go*1000000000 - $Mo*1000000)/1000);
<a name="l04708"></a>04708         $o  = floor($Value - $Go*1000000000 - $Mo*1000000 - $Ko*1000);
<a name="l04709"></a>04709 
<a name="l04710"></a>04710         <span class="keywordflow">if</span>($Go != 0) {
<a name="l04711"></a>04711             <span class="keywordflow">return</span> $Go.<span class="charliteral">'.'</span>.$Mo.<span class="charliteral">'g'</span>;
<a name="l04712"></a>04712         }
<a name="l04713"></a>04713         <span class="keywordflow">if</span>($Mo != 0) {
<a name="l04714"></a>04714             <span class="keywordflow">return</span> $Mo.<span class="charliteral">'.'</span>.$ko.<span class="charliteral">'m'</span>;
<a name="l04715"></a>04715         }
<a name="l04716"></a>04716         <span class="keywordflow">if</span>($Ko != 0)  {
<a name="l04717"></a>04717             <span class="keywordflow">return</span> $Ko.<span class="charliteral">'.'</span>.$o.<span class="charliteral">'k'</span>;
<a name="l04718"></a>04718         }
<a name="l04719"></a>04719         <span class="keywordflow">return</span> $o;
<a name="l04720"></a>04720     }
<a name="l04721"></a>04721 
<a name="l04728"></a>04728     <span class="keyword">private</span> function ToCurrency($Value) {
<a name="l04729"></a>04729         $Go = floor($Value/1000000000);
<a name="l04730"></a>04730         $Mo = floor(($Value - $Go*1000000000)/1000000);
<a name="l04731"></a>04731         $Ko = floor(($Value - $Go*1000000000 - $Mo*1000000)/1000);
<a name="l04732"></a>04732         $o  = floor($Value - $Go*1000000000 - $Mo*1000000 - $Ko*1000);
<a name="l04733"></a>04733 
<a name="l04734"></a>04734         <span class="keywordflow">if</span>(strlen($o) == 1) { $o = <span class="stringliteral">'00'</span>.$o; }
<a name="l04735"></a>04735         <span class="keywordflow">if</span>(strlen($o) == 2) { $o = <span class="charliteral">'0'</span>.$o; }
<a name="l04736"></a>04736 
<a name="l04737"></a>04737         $ResultString = $o;
<a name="l04738"></a>04738         <span class="keywordflow">if</span>($Ko != 0) { $ResultString = $Ko.<span class="charliteral">'.'</span>.$ResultString; }
<a name="l04739"></a>04739         <span class="keywordflow">if</span>($Mo != 0) { $ResultString = $Mo.<span class="charliteral">'.'</span>.$ResultString; }
<a name="l04740"></a>04740         <span class="keywordflow">if</span>($Go != 0) { $ResultString = $Go.<span class="charliteral">'.'</span>.$ResultString; }
<a name="l04741"></a>04741 
<a name="l04742"></a>04742         $ResultString = $this-&gt;Currency . $ResultString;
<a name="l04743"></a>04743         <span class="keywordflow">return</span> $ResultString;
<a name="l04744"></a>04744     }
<a name="l04745"></a>04745 
<a name="l04752"></a>04752     <span class="keyword">private</span> function ToDate($Value) {
<a name="l04753"></a>04753         <span class="keywordflow">if</span>($this-&gt;UseStrftime) {
<a name="l04754"></a>04754             <span class="keywordflow">return</span>(strftime($this-&gt;DateFormat, $Value));
<a name="l04755"></a>04755         } <span class="keywordflow">else</span> {
<a name="l04756"></a>04756             <span class="keywordflow">return</span>(date($this-&gt;DateFormat, $Value));
<a name="l04757"></a>04757         }
<a name="l04758"></a>04758     }
<a name="l04759"></a>04759 
<a name="l04775"></a><a class="code" href="classmt_chart.html#6e310821dfa0a3f4219e1509f93a2648">04775</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#6e310821dfa0a3f4219e1509f93a2648">setDateFormat</a>($Format, $UseStrftime = FALSE) {
<a name="l04776"></a>04776         $this-&gt;DateFormat = $Format;
<a name="l04777"></a>04777         $this-&gt;UseStrftime = $UseStrftime;
<a name="l04778"></a>04778     }
<a name="l04779"></a>04779 
<a name="l04790"></a><a class="code" href="classmt_chart.html#625ad6ba3c35fb2ac709912216f606d8">04790</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#625ad6ba3c35fb2ac709912216f606d8">setTimeFormat</a>($TimeFormat) {
<a name="l04791"></a>04791         $this-&gt;TimeFormat = $TimeFormat;
<a name="l04792"></a>04792     }
<a name="l04793"></a>04793 
<a name="l04800"></a>04800     <span class="keyword">private</span> function isRealInt($Value) {
<a name="l04801"></a>04801         <span class="keywordflow">if</span>($Value == floor($Value)) {
<a name="l04802"></a>04802             <span class="keywordflow">return</span> TRUE;
<a name="l04803"></a>04803         } <span class="keywordflow">else</span> {
<a name="l04804"></a>04804             <span class="keywordflow">return</span>(FALSE);
<a name="l04805"></a>04805         }
<a name="l04806"></a>04806     }
<a name="l04807"></a>04807 
<a name="l04813"></a>04813     <span class="keyword">private</span> function RaiseFatal($Message) {
<a name="l04814"></a>04814         echo <span class="stringliteral">"[FATAL] $Message\n"</span>;
<a name="l04815"></a>04815         exit();
<a name="l04816"></a>04816     }
<a name="l04817"></a>04817 
<a name="l04823"></a><a class="code" href="classmt_chart.html#7d6232da57907fcee2dc1a5091143d2b">04823</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#7d6232da57907fcee2dc1a5091143d2b">maximumValue</a>() {
<a name="l04824"></a>04824         $MaximumValue = NULL;
<a name="l04825"></a>04825 
<a name="l04826"></a>04826         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Key2 =&gt; $ColName) {
<a name="l04827"></a>04827             <span class="keywordflow">foreach</span>($this-&gt;Data as $Key =&gt; $Values) {
<a name="l04828"></a>04828                 <span class="keywordflow">if</span>(isset($this-&gt;Data[$Key][$ColName])) {
<a name="l04829"></a>04829                     $MaximumValue = max($MaximumValue, $this-&gt;Data[$Key][$ColName]);
<a name="l04830"></a>04830                 }
<a name="l04831"></a>04831             }
<a name="l04832"></a>04832         }
<a name="l04833"></a>04833 
<a name="l04834"></a>04834         <span class="keywordflow">return</span> $MaximumValue;
<a name="l04835"></a>04835     }
<a name="l04836"></a>04836 
<a name="l04854"></a><a class="code" href="classmt_chart.html#13bcfe6bcf67d95d06b94e0275b08158">04854</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#13bcfe6bcf67d95d06b94e0275b08158">importFromCSV</a>($FileName, $Delimiter = <span class="charliteral">';'</span>, $DataColumns = NULL, $HasHeader = FALSE, $DataName = NULL, $MaxLineLength = 4096) {
<a name="l04855"></a>04855         $success = FALSE;
<a name="l04856"></a>04856         $handle = @fopen($FileName, <span class="charliteral">'r'</span>);
<a name="l04857"></a>04857 
<a name="l04858"></a>04858         <span class="keywordflow">if</span>($handle) {
<a name="l04859"></a>04859             $success = TRUE;
<a name="l04860"></a>04860             $HeaderParsed = FALSE;
<a name="l04861"></a>04861             <span class="keywordflow">while</span>(!feof($handle)) {
<a name="l04862"></a>04862                 $buffer = fgets($handle, $MaxLineLength);
<a name="l04863"></a>04863                 $Values = explode($Delimiter, trim($buffer));
<a name="l04864"></a>04864 
<a name="l04865"></a>04865                 <span class="keywordflow">if</span>($buffer) {
<a name="l04866"></a>04866                     <span class="keywordflow">if</span>($HasHeader == TRUE &amp;&amp; $HeaderParsed == FALSE) {
<a name="l04867"></a>04867                         <span class="comment">// Parse header first</span>
<a name="l04868"></a>04868                         <span class="keywordflow">if</span>(is_null($DataColumns)) {
<a name="l04869"></a>04869                             $ID = 1;
<a name="l04870"></a>04870                             <span class="keywordflow">foreach</span>($Values as $Value) {
<a name="l04871"></a>04871                                 $this-&gt;SetSerieName($Value, <span class="stringliteral">'Serie'</span>.$ID);
<a name="l04872"></a>04872                                 ++$ID;
<a name="l04873"></a>04873                             }
<a name="l04874"></a>04874                         } <span class="keywordflow">else</span> {
<a name="l04875"></a>04875                             <span class="keywordflow">foreach</span>($DataColumns as $Value) {
<a name="l04876"></a>04876                                 $this-&gt;SetSerieName($Values[$Value], <span class="stringliteral">'Serie'</span>.$Value);
<a name="l04877"></a>04877                             }
<a name="l04878"></a>04878                         }
<a name="l04879"></a>04879                         $HeaderParsed = TRUE;
<a name="l04880"></a>04880                     } <span class="keywordflow">else</span> {
<a name="l04881"></a>04881                         <span class="comment">// Normal data row</span>
<a name="l04882"></a>04882                         <span class="keywordflow">if</span>(is_null($DataColumns)) {
<a name="l04883"></a>04883                             $ID = 1;
<a name="l04884"></a>04884                             <span class="keywordflow">foreach</span>($Values as $Value) {
<a name="l04885"></a>04885                                 $this-&gt;AddPoint(floatval($Value), <span class="stringliteral">'Serie'</span>.$ID);
<a name="l04886"></a>04886                                 ++$ID;
<a name="l04887"></a>04887                             }
<a name="l04888"></a>04888                         } <span class="keywordflow">else</span> {
<a name="l04889"></a>04889                             $SerieName = <span class="stringliteral">''</span>;
<a name="l04890"></a>04890                             <span class="keywordflow">if</span>(isset($DataName)) {
<a name="l04891"></a>04891                                 $SerieName = $Values[$DataName];
<a name="l04892"></a>04892                             }
<a name="l04893"></a>04893 
<a name="l04894"></a>04894                             <span class="keywordflow">foreach</span>($DataColumns as $Value) {
<a name="l04895"></a>04895                                 $this-&gt;AddPoint(floatval($Values[$Value]), <span class="stringliteral">'Serie'</span>.$Value, $SerieName);
<a name="l04896"></a>04896                             }
<a name="l04897"></a>04897                         }
<a name="l04898"></a>04898                     }
<a name="l04899"></a>04899                 }
<a name="l04900"></a>04900             }
<a name="l04901"></a>04901             fclose($handle);
<a name="l04902"></a>04902         }
<a name="l04903"></a>04903         <span class="keywordflow">return</span> $success;
<a name="l04904"></a>04904     }
<a name="l04905"></a>04905 
<a name="l04915"></a><a class="code" href="classmt_chart.html#4f20f91ac84a4bbb198eda53a3b447b8">04915</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#4f20f91ac84a4bbb198eda53a3b447b8">addPoint</a>($Value, $Serie = <span class="stringliteral">'Serie1'</span>, $Description = NULL) {
<a name="l04916"></a>04916         <span class="keywordflow">if</span>(is_array($Value) &amp;&amp; count($Value) == 1) {
<a name="l04917"></a>04917             $Value = $Value[0];
<a name="l04918"></a>04918         }
<a name="l04919"></a>04919 
<a name="l04920"></a>04920         $ID = 0;
<a name="l04921"></a>04921         <span class="keywordflow">for</span>($i=0; $i&lt;=count($this-&gt;Data); ++$i) {
<a name="l04922"></a>04922             <span class="keywordflow">if</span>(isset($this-&gt;Data[$i][$Serie])) {
<a name="l04923"></a>04923                 $ID = $i+1;
<a name="l04924"></a>04924             }
<a name="l04925"></a>04925         }
<a name="l04926"></a>04926 
<a name="l04927"></a>04927         <span class="keywordflow">if</span>(count($Value) == 1) {
<a name="l04928"></a>04928             $this-&gt;Data[$ID][$Serie] = $Value;
<a name="l04929"></a>04929             <span class="keywordflow">if</span>(isset($Description)) {
<a name="l04930"></a>04930                 $this-&gt;Data[$ID][<span class="stringliteral">'Name'</span>] = $Description;
<a name="l04931"></a>04931             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!isset($this-&gt;Data[$ID][<span class="stringliteral">'Name'</span>])) {
<a name="l04932"></a>04932                 $this-&gt;Data[$ID][<span class="stringliteral">'Name'</span>] = $ID;
<a name="l04933"></a>04933             }
<a name="l04934"></a>04934         } <span class="keywordflow">else</span> {
<a name="l04935"></a>04935             <span class="keywordflow">foreach</span>($Value as $Val) {
<a name="l04936"></a>04936                 $this-&gt;Data[$ID][$Serie] = $Val;
<a name="l04937"></a>04937                 <span class="keywordflow">if</span>(!isset($this-&gt;Data[$ID][<span class="stringliteral">'Name'</span>])) {
<a name="l04938"></a>04938                     $this-&gt;Data[$ID][<span class="stringliteral">'Name'</span>] = $ID;
<a name="l04939"></a>04939                 }
<a name="l04940"></a>04940                 ++$ID;
<a name="l04941"></a>04941             }
<a name="l04942"></a>04942         }
<a name="l04943"></a>04943     }
<a name="l04944"></a>04944 
<a name="l04952"></a><a class="code" href="classmt_chart.html#b5d95374857805e0fc58c456e748e4f6">04952</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#b5d95374857805e0fc58c456e748e4f6">addSerie</a>($SerieName = <span class="stringliteral">'Serie1'</span>) {
<a name="l04953"></a>04953         <span class="keywordflow">if</span>(!isset($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>])) {
<a name="l04954"></a>04954             $this-&gt;DataDescription[<span class="stringliteral">'Values'</span>][] = $SerieName;
<a name="l04955"></a>04955         } <span class="keywordflow">else</span> {
<a name="l04956"></a>04956             $Found = FALSE;
<a name="l04957"></a>04957             <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $Value) {
<a name="l04958"></a>04958                 <span class="keywordflow">if</span>($Value == $SerieName) {
<a name="l04959"></a>04959                     $Found = TRUE;
<a name="l04960"></a>04960                     <span class="keywordflow">break</span>;
<a name="l04961"></a>04961                 }
<a name="l04962"></a>04962             }
<a name="l04963"></a>04963 
<a name="l04964"></a>04964             <span class="keywordflow">if</span>(! $Found) {
<a name="l04965"></a>04965                 $this-&gt;DataDescription[<span class="stringliteral">'Values'</span>][] = $SerieName;
<a name="l04966"></a>04966             }
<a name="l04967"></a>04967         }
<a name="l04968"></a>04968     }
<a name="l04969"></a>04969 
<a name="l04974"></a><a class="code" href="classmt_chart.html#9baa628b4e0b044494715cf28407b2a3">04974</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#9baa628b4e0b044494715cf28407b2a3">addAllSeries</a>() {
<a name="l04975"></a>04975         unset($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>]);
<a name="l04976"></a>04976 
<a name="l04977"></a>04977         <span class="keywordflow">if</span>(isset($this-&gt;Data[0])) {
<a name="l04978"></a>04978             <span class="keywordflow">foreach</span>($this-&gt;Data[0] as $Key =&gt; $Value) {
<a name="l04979"></a>04979                 <span class="keywordflow">if</span>($Key != <span class="stringliteral">'Name'</span>) {
<a name="l04980"></a>04980                     $this-&gt;DataDescription[<span class="stringliteral">'Values'</span>][] = $Key;
<a name="l04981"></a>04981                 }
<a name="l04982"></a>04982             }
<a name="l04983"></a>04983         }
<a name="l04984"></a>04984     }
<a name="l04985"></a>04985 
<a name="l04994"></a><a class="code" href="classmt_chart.html#7cf69a41ccba2dbcd7259fbd70845bed">04994</a>     function <a class="code" href="classmt_chart.html#7cf69a41ccba2dbcd7259fbd70845bed">removeSerie</a>($SerieName = <span class="stringliteral">'Serie1'</span>) {
<a name="l04995"></a>04995         $Found = FALSE;
<a name="l04996"></a>04996 
<a name="l04997"></a>04997         <span class="keywordflow">if</span>(is_null($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>])) {
<a name="l04998"></a>04998             <span class="keywordflow">return</span> $Found;
<a name="l04999"></a>04999         }
<a name="l05000"></a>05000 
<a name="l05001"></a>05001         <span class="keywordflow">foreach</span>($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] as $key =&gt; $Value) {
<a name="l05002"></a>05002             <span class="keywordflow">if</span>($Value == $SerieName) {
<a name="l05003"></a>05003                 unset($this-&gt;DataDescription[<span class="stringliteral">'Values'</span>][$key]);
<a name="l05004"></a>05004                 $Found = TRUE;
<a name="l05005"></a>05005                 <span class="keywordflow">break</span>;
<a name="l05006"></a>05006             }
<a name="l05007"></a>05007         }
<a name="l05008"></a>05008 
<a name="l05009"></a>05009         <span class="keywordflow">return</span> $Found;
<a name="l05010"></a>05010     }
<a name="l05011"></a>05011 
<a name="l05017"></a><a class="code" href="classmt_chart.html#96c054e6d8093e5f22b71b09aadae893">05017</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#96c054e6d8093e5f22b71b09aadae893">setAbsciseLabelSerie</a>($SerieName = <span class="stringliteral">'Name'</span>) {
<a name="l05018"></a>05018         $this-&gt;DataDescription[<span class="stringliteral">'Position'</span>] = $SerieName;
<a name="l05019"></a>05019     }
<a name="l05020"></a>05020 
<a name="l05021"></a>05021 
<a name="l05030"></a><a class="code" href="classmt_chart.html#11b3dc81c3d2d705ba4de58bb88b3473">05030</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#11b3dc81c3d2d705ba4de58bb88b3473">setSerieName</a>($Name, $SerieName = <span class="stringliteral">'Serie1'</span>) {
<a name="l05031"></a>05031         $this-&gt;DataDescription[<span class="stringliteral">'Description'</span>][$SerieName] = $Name;
<a name="l05032"></a>05032     }
<a name="l05033"></a>05033 
<a name="l05039"></a><a class="code" href="classmt_chart.html#954dcdeeaf65bded817a1b010e859124">05039</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#954dcdeeaf65bded817a1b010e859124">setXAxisName</a>($Name=<span class="stringliteral">'X Axis'</span>) {
<a name="l05040"></a>05040         $this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'X'</span>] = $Name;
<a name="l05041"></a>05041     }
<a name="l05042"></a>05042 
<a name="l05048"></a><a class="code" href="classmt_chart.html#56905c40f8cad96da130d452e052efe3">05048</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#56905c40f8cad96da130d452e052efe3">setYAxisName</a>($Name = <span class="stringliteral">'Y Axis'</span>) {
<a name="l05049"></a>05049         $this-&gt;DataDescription[<span class="stringliteral">'Axis'</span>][<span class="charliteral">'Y'</span>] = $Name;
<a name="l05050"></a>05050     }
<a name="l05051"></a>05051 
<a name="l05064"></a><a class="code" href="classmt_chart.html#c6675ea2b2f000a1dc5c1aec90793493">05064</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#c6675ea2b2f000a1dc5c1aec90793493">setXAxisFormat</a>($Format = <span class="stringliteral">'number'</span>) {
<a name="l05065"></a>05065         $this-&gt;DataDescription[<span class="stringliteral">'Format'</span>][<span class="charliteral">'X'</span>] = $Format;
<a name="l05066"></a>05066     }
<a name="l05067"></a>05067 
<a name="l05080"></a><a class="code" href="classmt_chart.html#fb49ba4e723030eb6f69cd4a4ba551fa">05080</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#fb49ba4e723030eb6f69cd4a4ba551fa">setYAxisFormat</a>($Format = <span class="stringliteral">'number'</span>) {
<a name="l05081"></a>05081         $this-&gt;DataDescription[<span class="stringliteral">'Format'</span>][<span class="charliteral">'Y'</span>] = $Format;
<a name="l05082"></a>05082     }
<a name="l05083"></a>05083 
<a name="l05092"></a><a class="code" href="classmt_chart.html#ac1fe6216a70bde8df901bb94806cbb7">05092</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#ac1fe6216a70bde8df901bb94806cbb7">setXAxisUnit</a>($Unit = NULL) {
<a name="l05093"></a>05093         $this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'X'</span>] = $Unit;
<a name="l05094"></a>05094     }
<a name="l05095"></a>05095 
<a name="l05104"></a><a class="code" href="classmt_chart.html#3b73fab565fbec521f73c320ac9023e6">05104</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#3b73fab565fbec521f73c320ac9023e6">setYAxisUnit</a>($Unit = NULL) {
<a name="l05105"></a>05105         $this-&gt;DataDescription[<span class="stringliteral">'Unit'</span>][<span class="charliteral">'Y'</span>] = $Unit;
<a name="l05106"></a>05106     }
<a name="l05107"></a>05107 
<a name="l05114"></a><a class="code" href="classmt_chart.html#26641d7f3f6c5794d3eeb8ffb6fa5b5c">05114</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#26641d7f3f6c5794d3eeb8ffb6fa5b5c">setSerieSymbol</a>($Name, $Symbol) {
<a name="l05115"></a>05115         $this-&gt;DataDescription[<span class="stringliteral">'Symbol'</span>][$Name] = $Symbol;
<a name="l05116"></a>05116     }
<a name="l05117"></a>05117 
<a name="l05123"></a><a class="code" href="classmt_chart.html#0d92599fe566760023491241ccd3c198">05123</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#0d92599fe566760023491241ccd3c198">removeSerieName</a>($SerieName) {
<a name="l05124"></a>05124         <span class="keywordflow">if</span>(isset($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>][$SerieName])) {
<a name="l05125"></a>05125             unset($this-&gt;DataDescription[<span class="stringliteral">'Description'</span>][$SerieName]);
<a name="l05126"></a>05126         }
<a name="l05127"></a>05127     }
<a name="l05128"></a>05128 
<a name="l05133"></a><a class="code" href="classmt_chart.html#750906be5ee0fc78811a7117468976a9">05133</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#750906be5ee0fc78811a7117468976a9">removeAllSeries</a>() {
<a name="l05134"></a>05134         $this-&gt;DataDescription[<span class="stringliteral">'Values'</span>] = NULL;
<a name="l05135"></a>05135     }
<a name="l05136"></a>05136 
<a name="l05142"></a><a class="code" href="classmt_chart.html#81a67162a6288d78fc4c55283325f0b4">05142</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#81a67162a6288d78fc4c55283325f0b4">getData</a>() {
<a name="l05143"></a>05143         <span class="keywordflow">return</span>($this-&gt;Data);
<a name="l05144"></a>05144     }
<a name="l05145"></a>05145 
<a name="l05151"></a><a class="code" href="classmt_chart.html#f11297f0aaf528103dba2707381de4d9">05151</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#f11297f0aaf528103dba2707381de4d9">getDataDescription</a>() {
<a name="l05152"></a>05152         <span class="keywordflow">return</span>($this-&gt;DataDescription);
<a name="l05153"></a>05153     }
<a name="l05154"></a>05154 
<a name="l05160"></a><a class="code" href="classmt_chart.html#2f5b8308b66f52e764392e5890ae4997">05160</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#2f5b8308b66f52e764392e5890ae4997">setData</a>($Data) {
<a name="l05161"></a>05161         $this-&gt;Data = $Data;
<a name="l05162"></a>05162     }
<a name="l05163"></a>05163 
<a name="l05169"></a><a class="code" href="classmt_chart.html#daf7c6cd966315ae4ec76330b982bbf2">05169</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#daf7c6cd966315ae4ec76330b982bbf2">setDataDescription</a>($DataDescription) {
<a name="l05170"></a>05170         $this-&gt;DataDescription = $DataDescription;
<a name="l05171"></a>05171     }
<a name="l05172"></a>05172 
<a name="l05173"></a>05173 
<a name="l05174"></a>05174 
<a name="l05195"></a><a class="code" href="classmt_chart.html#76a5670d8db32d742975a429479e8fa4">05195</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#76a5670d8db32d742975a429479e8fa4">enableCaching</a>($ScriptID = NULL, $CacheFolder = <span class="stringliteral">'Cache/'</span>) {
<a name="l05196"></a>05196         $folderpath = realpath($CacheFolder);
<a name="l05197"></a>05197         <span class="keywordflow">if</span>(is_writable($folderpath)) {
<a name="l05198"></a>05198             $this-&gt;CacheFolder = $folderpath . DIRECTORY_SEPARATOR;
<a name="l05199"></a>05199             $this-&gt;ScriptID = $ScriptID;
<a name="l05200"></a>05200             $this-&gt;CacheEnabled = TRUE;
<a name="l05201"></a>05201         } <span class="keywordflow">else</span> {
<a name="l05202"></a>05202             $this-&gt;Errors[] = <span class="stringliteral">'[WARNING] Cache folder '</span> . $CacheFolder . <span class="stringliteral">' not found or not writable. Caching remains disabled.'</span>;
<a name="l05203"></a>05203         }
<a name="l05204"></a>05204 
<a name="l05205"></a>05205         <span class="keywordflow">return</span> $this-&gt;CacheEnabled;
<a name="l05206"></a>05206     }
<a name="l05207"></a>05207 
<a name="l05215"></a><a class="code" href="classmt_chart.html#c01828cae86291d0bc8a78b24de6089f">05215</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#c01828cae86291d0bc8a78b24de6089f">clearCache</a>() {
<a name="l05216"></a>05216         $success = FALSE;
<a name="l05217"></a>05217         <span class="keywordflow">if</span>($handle = opendir($this-&gt;CacheFolder)) {
<a name="l05218"></a>05218             <span class="keywordflow">while</span> ($file = readdir($handle)) {
<a name="l05219"></a>05219                 <span class="keywordflow">if</span>(preg_match(<span class="stringliteral">'/^mtChart\.[a-f0-9]{32}\.png$/'</span>, $file)) {
<a name="l05220"></a>05220                     unlink($this-&gt;CacheFolder.$file);
<a name="l05221"></a>05221                 }
<a name="l05222"></a>05222             }
<a name="l05223"></a>05223             closedir($handle);
<a name="l05224"></a>05224             $success = TRUE;
<a name="l05225"></a>05225         }
<a name="l05226"></a>05226 
<a name="l05227"></a>05227         <span class="keywordflow">return</span> $success;
<a name="l05228"></a>05228     }
<a name="l05229"></a>05229 
<a name="l05237"></a><a class="code" href="classmt_chart.html#e6a750e36469de4a3e4a03918b6ef705">05237</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#e6a750e36469de4a3e4a03918b6ef705">isInCache</a>() {
<a name="l05238"></a>05238         $cached = FALSE;
<a name="l05239"></a>05239 
<a name="l05240"></a>05240         <span class="keywordflow">if</span>(file_exists($filename = $this-&gt;<a class="code" href="classmt_chart.html#ae850ca0cd085a5d68361dd46ca1a36e">getCacheFilename</a>())) {
<a name="l05241"></a>05241             $cached = $filename;
<a name="l05242"></a>05242         }
<a name="l05243"></a>05243 
<a name="l05244"></a>05244         <span class="keywordflow">return</span> $cached;
<a name="l05245"></a>05245     }
<a name="l05246"></a>05246 
<a name="l05252"></a><a class="code" href="classmt_chart.html#ae850ca0cd085a5d68361dd46ca1a36e">05252</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#ae850ca0cd085a5d68361dd46ca1a36e">getCacheFilename</a>() {
<a name="l05253"></a>05253         <span class="keywordflow">if</span>(is_null($this-&gt;Hash)) {
<a name="l05254"></a>05254             $this-&gt;getHash();
<a name="l05255"></a>05255         }
<a name="l05256"></a>05256 
<a name="l05257"></a>05257         <span class="keywordflow">return</span> $this-&gt;CacheFolder . <span class="stringliteral">'mtChart.'</span> . $this-&gt;Hash . <span class="stringliteral">'.png'</span>;
<a name="l05258"></a>05258     }
<a name="l05259"></a>05259 
<a name="l05265"></a><a class="code" href="classmt_chart.html#222dd2bd1246890f48322895b0936699">05265</a>     function <a class="code" href="classmt_chart.html#222dd2bd1246890f48322895b0936699">writeToCache</a>() {
<a name="l05266"></a>05266         $success = imagepng($this-&gt;Picture, $this-&gt;<a class="code" href="classmt_chart.html#ae850ca0cd085a5d68361dd46ca1a36e">getCacheFilename</a>());
<a name="l05267"></a>05267 
<a name="l05268"></a>05268         <span class="keywordflow">if</span>(! $success) {
<a name="l05269"></a>05269             $this-&gt;Errors[] = <span class="stringliteral">'[WARNING] Could not write current file to cache.'</span>;
<a name="l05270"></a>05270         }
<a name="l05271"></a>05271 
<a name="l05272"></a>05272         <span class="keywordflow">return</span> $success;
<a name="l05273"></a>05273     }
<a name="l05274"></a>05274 
<a name="l05280"></a><a class="code" href="classmt_chart.html#022031a03b64ef7ea8fcf2cbb6c43c35">05280</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#022031a03b64ef7ea8fcf2cbb6c43c35">deleteFromCache</a>() {
<a name="l05281"></a>05281         $sucess = TRUE;
<a name="l05282"></a>05282 
<a name="l05283"></a>05283         <span class="keywordflow">if</span>($FileName = $this-&gt;<a class="code" href="classmt_chart.html#e6a750e36469de4a3e4a03918b6ef705">isInCache</a>()) {
<a name="l05284"></a>05284             $success = unlink($FileName);
<a name="l05285"></a>05285         }
<a name="l05286"></a>05286 
<a name="l05287"></a>05287         <span class="keywordflow">return</span> $sucess;
<a name="l05288"></a>05288     }
<a name="l05289"></a>05289 
<a name="l05299"></a><a class="code" href="classmt_chart.html#83629a8cd9ac4120f4903d82ae0541bf">05299</a>     <span class="keyword">public</span> function <a class="code" href="classmt_chart.html#83629a8cd9ac4120f4903d82ae0541bf">getFromCache</a>($Exit = TRUE) {
<a name="l05300"></a>05300         $success = FALSE;
<a name="l05301"></a>05301 
<a name="l05302"></a>05302         <span class="keywordflow">if</span>($FileName = $this-&gt;<a class="code" href="classmt_chart.html#e6a750e36469de4a3e4a03918b6ef705">isInCache</a>()) {
<a name="l05303"></a>05303 
<a name="l05304"></a>05304             header(<span class="stringliteral">'Content-type: image/png'</span>);
<a name="l05305"></a>05305             $success = @readfile($FileName);
<a name="l05306"></a>05306 
<a name="l05307"></a>05307             <span class="keywordflow">if</span>($success &amp;&amp; $Exit) {
<a name="l05308"></a>05308                 exit();
<a name="l05309"></a>05309             }
<a name="l05310"></a>05310         }
<a name="l05311"></a>05311 
<a name="l05312"></a>05312         <span class="keywordflow">return</span> $success;
<a name="l05313"></a>05313     }
<a name="l05314"></a>05314 
<a name="l05320"></a>05320     <span class="keyword">private</span> function getHash() {
<a name="l05321"></a>05321         <span class="keywordflow">if</span>(is_null($this-&gt;Hash)) {
<a name="l05322"></a>05322             $mKey = (string) $this-&gt;ScriptID;
<a name="l05323"></a>05323             $mKey .= serialize($this-&gt;Data);
<a name="l05324"></a>05324             $mKey .= serialize($this-&gt;DataDescription);
<a name="l05325"></a>05325 
<a name="l05326"></a>05326             $this-&gt;Hash = md5($mKey);
<a name="l05327"></a>05327         }
<a name="l05328"></a>05328 
<a name="l05329"></a>05329         <span class="keywordflow">return</span> $this-&gt;Hash;
<a name="l05330"></a>05330     }
<a name="l05331"></a>05331 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Jul 1 16:49:08 2009 for mtChart by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
